<!doctype html><html lang=zh dir=ltr><head><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>一周时间使用Vue+Koa全栈开发论坛项目 | Wilson's Blog</title>
<meta name=keywords content="Web"><meta name=description content="使用 vue-cli3 脚手架初始化前端项目"><meta name=author content><link rel=canonical href=https://barnett617.github.io/wilson-blog/posts/2018-08-27-koa-vue-forum/><meta name=google-site-verification content="XYZabc"><meta name=yandex-verification content="XYZabc"><meta name=msvalidate.01 content="XYZabc"><link crossorigin=anonymous href=/wilson-blog/assets/css/stylesheet.12fa5455234223898c7ed6a6a9d432e5a19d6a2254249418807687ee1ef72101.css integrity="sha256-EvpUVSNCI4mMftamqdQy5aGdaiJUJJQYgHaH7h73IQE=" rel="preload stylesheet" as=style><link rel=icon href=https://barnett617.github.io/wilson-blog/favicon_io/favicon.ico><link rel=icon type=image/png sizes=16x16 href=https://barnett617.github.io/wilson-blog/favicon_io/favicon16x16.png><link rel=icon type=image/png sizes=32x32 href=https://barnett617.github.io/wilson-blog/favicon_io/favicon32x32.png><link rel=apple-touch-icon href=https://barnett617.github.io/wilson-blog/favicon_io/apple-touch-icon.png><link rel=mask-icon href=https://barnett617.github.io/wilson-blog/favicon_io/apple-touch-icon.png><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><link rel=alternate hreflang=zh href=https://barnett617.github.io/wilson-blog/posts/2018-08-27-koa-vue-forum/><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--hljs-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><meta property="og:title" content="一周时间使用Vue+Koa全栈开发论坛项目"><meta property="og:description" content="使用 vue-cli3 脚手架初始化前端项目"><meta property="og:type" content="article"><meta property="og:url" content="https://barnett617.github.io/wilson-blog/posts/2018-08-27-koa-vue-forum/"><meta property="article:section" content="posts"><meta property="article:published_time" content="2018-08-27T09:30:00+00:00"><meta property="article:modified_time" content="2018-08-27T09:30:00+00:00"><meta property="og:site_name" content="Wilson's Blog"><meta name=twitter:card content="summary"><meta name=twitter:title content="一周时间使用Vue+Koa全栈开发论坛项目"><meta name=twitter:description content="使用 vue-cli3 脚手架初始化前端项目"><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Posts","item":"https://barnett617.github.io/wilson-blog/posts/"},{"@type":"ListItem","position":2,"name":"一周时间使用Vue+Koa全栈开发论坛项目","item":"https://barnett617.github.io/wilson-blog/posts/2018-08-27-koa-vue-forum/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"一周时间使用Vue+Koa全栈开发论坛项目","name":"一周时间使用Vue\u002bKoa全栈开发论坛项目","description":"使用 vue-cli3 脚手架初始化前端项目\n","keywords":["Web"],"articleBody":"使用 vue-cli3 脚手架初始化前端项目\n1. 安装 vue-cli3 npm install -g @vue/cli 2. 创建项目 vue create code-monkeys-fe-vue 3. 核心配置文件 vue-cli3 采用约定优于配置的思想，去除了很多配置项，转而都由项目根目录下的vue.config.js中既定的格式进行配置\n4. 示例配置 const express = require(\"express\"); const app = express(); const fs = require(\"fs\"); const path = require(\"path\"); var apiRoutes = express.Router(); app.use(\"/mock\", apiRoutes); const responseFunction = (req, res) =\u003e { const fileName = req.params.fileName; let obj = null; try { // require 有缓存问题 let objStr = fs .readFileSync(path.join(__dirname, \"/mock/data/\" + fileName)) .toString(); if (objStr) { obj = JSON.parse(objStr); } } catch (e) { // console.log('无法打开 =\u003e ' + fileName + ' 文件'); } if (!obj || obj == undefined) { res.json({ err: \"json文件无数据\", }); } else { res.json(obj); } }; module.exports = { devServer: { // 中间加一道代理，根据识别到的路由规则拦截请求（此函数相当于拦截器） before(app) { app.get(\"/mock/data/:fileName\", responseFunction); app.post(\"/mock/data/:fileName\", responseFunction); }, // 解决跨域问题，对`/api`请求代理跨域 proxy: { \"/api\": { // target: 'http://127.0.0.1:3000/',//设置你调用的接口域名和端口号 target: \"http://xx.xx.xx.xx:3000/\", //设置你调用的接口域名和端口号 changeOrigin: true, //跨域 // pathRewrite: { // '^/api': '/' //这里理解成用‘/api’代替target里面的地址，后面组件中我们掉接口时直接用api代替 比如我要调用'http://10.1.5.11:8080/xxx/duty?time=2017-07-07 14:57:22'，直接写‘/api/xxx/duty?time=2017-07-07 14:57:22’即可 // } }, }, }, configureWebpack: { devtool: \"source-map\", }, }; 5. package.json { \"name\": \"code-monkeys-fe-vue\", \"version\": \"0.1.0\", \"private\": true, \"scripts\": { \"dev\": \"cross-env NODE_ENV=dev vue-cli-service serve --inspect --open\", \"build\": \"cross-env NODE_ENV=prod vue-cli-service build\", \"lint\": \"vue-cli-service lint\" }, \"dependencies\": { \"axios\": \"^0.18.0\", \"vue\": \"^2.5.17\", \"vue-router\": \"^3.0.1\" }, \"devDependencies\": { \"@vue/cli-plugin-babel\": \"^3.0.0\", \"@vue/cli-plugin-eslint\": \"^3.0.0\", \"@vue/cli-service\": \"^3.0.0\", \"cross-env\": \"^5.2.0\", \"vue-template-compiler\": \"^2.5.17\" }, \"eslintConfig\": { \"root\": true, \"env\": { \"node\": true }, \"extends\": [\"plugin:vue/essential\", \"eslint:recommended\"], \"rules\": {}, \"parserOptions\": { \"parser\": \"babel-eslint\" } }, \"postcss\": { \"plugins\": { \"autoprefixer\": {} } }, \"browserslist\": [\"\u003e 1%\", \"last 2 versions\", \"not ie \u003c= 8\"] } 6. 加入 router 修改入口文件\nimport Vue from \"vue\"; import App from \"./App.vue\"; import \"./utils/global\"; import router from \"./router\"; Vue.config.productionTip = false; new Vue({ router, render: (h) =\u003e h(App), }).$mount(\"#app\"); router.push(\"/\"); // 相当于以下完整写法，见：https://segmentfault.com/a/1190000014254740 // const app=new Vue({ // el:'#app', // router, // compoments:{ // App // }, // template:\"\" // }); 增加路由配置\nimport Vue from \"vue\"; import Router from \"vue-router\"; import HomeContent from \"@/views/HomeContent\"; import SinglePostContent from \"@/components/ForumPost/SinglePostContent.vue\"; Vue.use(Router); export default new Router({ mode: \"history\", routes: [ { path: \"/\", name: \"homeContent\", component: HomeContent, }, { path: \"/single-post/:id\", name: \"single-post-content\", component: SinglePostContent, }, ], }); 7. 开发主页面 \u003ctemplate\u003e \u003cdiv id=\"app\"\u003e \u003cForumHome /\u003e \u003c/div\u003e \u003c/template\u003e \u003cscript\u003e import ForumHome from './components/ForumHome.vue' export default { name: 'app', components: { ForumHome } } \u003c/script\u003e \u003cstyle\u003e #app { font-family: 'Avenir', Helvetica, Arial, sans-serif; -webkit-font-smoothing: antialiased; -moz-osx-font-smoothing: grayscale; color: #2c3e50; height: 100%; /* margin-top: 60px; */ } html, body { height: 100%; } a { text-decoration: none; cursor: pointer; } \u003c/style\u003e 8. 封装 ajax 请求对象 // export 时使用default，则import时不需要加大括号，否则需要加大括号引入export导出的变量 import apiConfig from \"./apiConfig\"; import axios from \"axios\"; /** * 使用立即执行函数表达式（IIFE）声明一些全局性（window对象的）方法或属性 */ (function (win) { /** * 为 String 添加 endsWith 方法，此方法在ES6中实现，以下为向下兼容处理（Polyfill） */ if (!String.prototype.endsWith) { String.prototype.endsWith = function (search, this_len) { if (this_len === undefined || this_len \u003e this.length) { this_len = this.length; } return this.substring(this_len - search.length, this_len) === search; }; } /** * 判断是否是字符串 * @param {*} obj */ function isStr(obj) { return typeof obj === \"string\"; } /** * ajax请求 * @param {*} obj */ const ajax = function (obj) { // 最终ajax请求的地址 let url; const ajaxUrl = obj.url; // 如果地址以Api结尾 if (isStr(ajaxUrl) \u0026\u0026 ajaxUrl.endsWith(\"Api\")) { // 判断环境是否为开发环境 const env = process.env.NODE_ENV; // 存在环境变量设置并且在枚举范围内 if (env \u0026\u0026 apiConfig[ajaxUrl] \u0026\u0026 apiConfig[ajaxUrl][env]) { url = apiConfig[ajaxUrl][env]; } } else { url = ajaxUrl; } /* eslint-disable */ console.log(obj); console.log(url); if (obj.type == \"get\") { axios .get(url) .then(function (response) { obj.callback(response); }) .catch(function (error) { obj.err(error); }); } else { console.log(url, obj.params); axios .post(url, obj.params) .then(function (response) { obj.callback(response); }) .catch(function (error) { obj.err(error); }); } }; win.ajax = ajax; win.isStr = isStr; })(window); 9. 路由使用 \u003ctemplate\u003e \u003cdiv class=\"home-center\"\u003e \u003cdiv class=\"home-center-nav\"\u003e \u003crouter-link class=\"home-router\" to=\"/\"\u003e {{ page_title }} \u003c/router-link\u003e \u003c/div\u003e \u003crouter-view\u003e\u003c/router-view\u003e \u003c/div\u003e \u003c/template\u003e \u003cscript\u003e export default { name: 'HomeCenter', data() { return { page_title: 'Home', } }, components: { }, props: { msg: String }, methods: { }, created() { } } \u003c/script\u003e \u003cstyle scoped\u003e body { height: 100%; } .home-router { color: rgb(119, 119, 119); } .home-center { display: flex; flex-direction: column; height: 100%; background-color: #EEEEEE; padding: 0 143px; } .home-center-nav { padding: 15px 0; } .home-center-content { display: flex; justify-content: flex-start; } \u003c/style\u003e 10. jenkins 自动化打包发布 拉取指定 git 仓库指定分支或指定 tag 代码并执行以下脚本完成编译打包\nnpm config set registry http://registry.npm.taobao.org/ \u0026\u0026 npm install \u0026\u0026 npm run build \u0026\u0026 cd dist \u0026\u0026 tar -zcvf dist.tar.gz * 指定服务器地址，通过 ssh 方式发送项目包并解压到指定目录\ncd /opt/www/codemonkeys-fe tar -zxvf dist.tar.gz rm -rf dist.tar.gz 11. 配置 Nginx server { listen 80; server_name xxx.com; #charset koi8-r; access_log /var/log/nginx/xxx.com.access.log main; location / { root /opt/www/xxx; index index.html index.htm; } # redirect server error pages to the static page /50x.html # error_page 500 502 503 504 /50x.html; location = /50x.html { root /usr/share/nginx/html; } } 12. 使用 Koa 开发后端服务器提供接口 初始化 package.json\nnpm init 配置 package.json\n{ \"name\": \"code-monkeys-fe-node\", \"version\": \"1.0.0\", \"description\": \"#### 项目介绍 前段项目node代理服务\", \"main\": \"index.js\", \"scripts\": { \"dev\": \"export NODE_ENV=development \u0026\u0026 nodemon --harmony ./app.js\", \"test\": \"echo \\\"Error: no test specified\\\" \u0026\u0026 exit 1\", \"deploy_setup\": \"pm2 deploy ecosystem.config.js production setup\", \"deploy\": \"pm2 deploy ecosystem.config.js production\", \"start\": \"export NODE_ENV=production \u0026\u0026 pm2 start ./app.js --max-memory-restart 300M -n codemonkeys-node --watch\", \"stop\": \"export NODE_ENV=production \u0026\u0026 pm2 stop ./app.js -n codemonkeys-node\" }, \"repository\": { \"type\": \"git\", \"url\": \"git@xxx.git\" }, \"author\": \"codemonkeys@wangxin\", \"license\": \"ISC\", \"dependencies\": { \"babel-preset-es2015\": \"^6.24.1\", \"babel-preset-stage-0\": \"^6.24.1\", \"koa\": \"^2.5.3\", \"koa-bodyparser\": \"^4.2.1\", \"koa-logger\": \"^3.2.0\", \"koa-mysql-session\": \"0.0.2\", \"koa-redis\": \"^3.1.2\", \"koa-router\": \"^7.4.0\", \"koa-session-minimal\": \"^3.0.4\", \"koa2-cors\": \"^2.0.6\", \"mysql\": \"^2.16.0\" }, \"devDependencies\": { \"nodemon\": \"^1.18.4\", \"pm2\": \"^3.2.2\" } } 入口主文件app.js\nconst Koa = require(\"koa\"); const app = new Koa(); const routers = require(\"./router/index\"); const koaLogger = require(\"koa-logger\"); const session = require(\"koa-session-minimal\"); const redisStore = require(\"koa-redis\"); const cors = require(\"koa2-cors\"); const bodyParser = require(\"koa-bodyparser\"); const { HOST, PORT } = require(\"./config/server-info\"); const env = process.env.NODE_ENV; // cookie // 存放sessionId的cookie配置 /* session cookie */ let cookieConfig = { maxAge: 86400000, // cookie有效时长 expires: \"\", // cookie失效时间 path: \"\", // 写cookie所在的路径 domain: HOST, // 写cookie所在的域名 httpOnly: true, // 是否只用于http请求中获取 overwrite: true, // 是否允许重写 secure: \"\", sameSite: \"\", signed: \"\", }; // 使用koa2-cors中间件解决跨域请求 app.use(cors()); app.use(bodyParser()); // 配置session中间件 app.use( session({ key: \"USER_SID\", store: redisStore(), cookie: cookieConfig, }) ); app.use(koaLogger()); // 初始化路由中间件 app.use(routers.routes()).use(routers.allowedMethods()); app.use(async (ctx) =\u003e { if (ctx.status === 404) { ctx.redirect(\"/not-found\"); } }); // 监听启动端口 app.listen(PORT); console.log(`the server is start at port ${PORT}`); 13. 使用 pm2 部署启动后端项目 核心配置文件\nmodule.exports = { apps: [ { script: \"app.js\", interpreter: \"node@10.0.0\", // Options reference: https://pm2.io/doc/en/runtime/reference/ecosystem-file/ // args: 'one two', instances: 1, autorestart: true, watch: false, max_memory_restart: \"300M\", env: { NODE_ENV: \"development\", }, env_production: { NODE_ENV: \"production\", }, }, ], deploy: { production: { user: \"root\", host: \"xx.xx.xx.xx\", ref: \"origin/master\", repo: \"git@xx.git\", path: \"/opt/www/xxx\", ssh_options: \"StrictHostKeyChecking=no\", \"post-deploy\": \"npm install \u0026\u0026 pm2 reload ecosystem.config.js --env production\", }, }, }; 14. 增加后端请求路由配置 const router = require(\"koa-router\")(); const api = require(\"../controller/api\"); module.exports = router .get(\"/\", api.homepage) .get(\"/api/forum-post/list\", api.getPosts) .post(\"/api/forum-post/getById\", api.getPostById); 15. 接收请求并处理 const forumPost = require(\"../models/forum-post\"); const timeFormat = require(\"../utils/time-format\"); module.exports = { async homepage(ctx) { return (ctx.body = \"server running\"); }, /** * 分页查询列表 * @param {*} ctx */ async getPosts(ctx) { const currentPage = ctx.request.query.currentPage || 1; let pageSize = ctx.request.query.pageSize || 10; const page = { currentPage: currentPage, pageSize: pageSize, }; let result = await forumPost.getPostList(page); result = result.map((item) =\u003e { item.create_time = timeFormat(item.create_time); return item; }); return (ctx.body = { status: 200, data: { result, }, }); }, /** * 根据ID查询 * @param {*} ctx */ async getPostById(ctx) { const postId = ctx.request.body.postId; let result = await forumPost.getPostById(postId); return (ctx.body = { status: 200, data: { result, }, }); }, }; 16. 操纵数据库做数据获取 const dbUtils = require(\"../utils/db-utils\"); const ForumPost = { /** * 分页查询文章列表 * @param {*} page */ async getPostList(page) { const _sql = ` SELECT * FROM forum_post WHERE is_delete = 0 AND is_publish = 1 ORDER BY forum_post.create_time DESC LIMIT ${page.pageSize} OFFSET ${page.currentPage - 1}`; const result = await dbUtils.query(_sql); return result; }, /** * 获取指定文章 * @param {string} id 文章id */ async getPostById(id) { const _sql = ` SELECT forum_post.* FROM forum_post WHERE forum_post.id = ${id}`; const result = await dbUtils.query(_sql); if (result.length) { return result[0]; } return null; }, }; module.exports = ForumPost; 17. 新建数据库 /** 建库 **/ CREATE DATABASE IF NOT EXISTS `codemonkeys-node` DEFAULT CHARSET utf8 COLLATE utf8_general_ci; /** 建帖子表 **/ CREATE TABLE IF NOT EXISTS `forum_post`( `id` INT NOT NULL AUTO_INCREMENT, `avatar` VARCHAR(100) NULL, `title` VARCHAR(40) NOT NULL, `author` VARCHAR(40) NOT NULL, `date` datetime, `create_time` datetime DEFAULT CURRENT_TIMESTAMP, `category` VARCHAR(40) NULL, `content` VARCHAR(20000) NOT NULL, `commentNum` INT NULL, `is_delete` INT DEFAULT 0, `is_publish` INT DEFAULT 1, PRIMARY KEY ( `id` ) )ENGINE=InnoDB DEFAULT CHARSET=utf8; /** 原始数据 **/ INSERT INTO forum_post (avatar, title, author, date, category, content, commentNum) VALUES ('http://ourcia6f4.bkt.clouddn.com/avatar3.jpg','基于Spring Cloud的微服务设计','wangzhenzhong','2018-08-27','微服务','微服务这个词大家应该都不陌生，是最近几年技术发展的热门词汇之一。在当前系统需求越来越复杂，实现和维护成本越来越高的背景下，微服务确实是未来的发展趋势之一。由于工作的需要，最近花了半个月左右的时间研究了基于Spring Cloud的微服务设计与实现，颇有收获，本文就来对这半个月的成果进行一个总结，并聊一聊在我对微服务的一些思考。','64' ), ('http://ourcia6f4.bkt.clouddn.com/avatar4.jpg','再品Git, 深度解读','Taikoo','2018-08-23','git','和一个长期使用IDE(eclipse)集成git进行代码版本管理的人交流项目，博文内容将采用类似《大话设计模式》的对话体进行，场景真实，有代入感，正文部门前面是对方参照我写的readme搭建基于vue-cli的demo项目，安装node并通过npm安装项目依赖并本地启动项目等等，由于对方为后端Java开发，对新前端技术栈了解比较少，在搭建环境和启动项目过程中滋生一些趣事，比如使用npm启动项目后如何在浏览器访问项目，我为了让其醒目意识到我们的项目首页就是未经改动的Vue-cli首页，于是我将首页改动并推到远程master分支，后面便是我们的搞笑对话。','60' ); 18. 后端接口服务 nginx 配置 server { listen 80; server_name xxx.com; access_log /var/log/nginx/xxx.com-access.log; error_log /var/log/nginx/xxx.com-error.log; location / { proxy_set_header X-Real-IP $remote_addr; proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for; proxy_set_header Host $http_host; proxy_set_header X-NginX-Proxy true; proxy_pass http://xx.xx.xx.xx:3000/; proxy_redirect off; } } 19. 发布后端服务到服务器指定目录 npm run deploy_setup 会在指定目录生成三个目录\nnpm run deploy 会将后端项目部署到指定目录\n20. 启动后端项目在服务器后端运行 进入服务器，在后端项目目录执行\nnpm run start 21. 完成 即可通过浏览器访问前端项目，调用后端接口返回数据进行显示\n","wordCount":"1472","inLanguage":"zh","datePublished":"2018-08-27T09:30:00Z","dateModified":"2018-08-27T09:30:00Z","mainEntityOfPage":{"@type":"WebPage","@id":"https://barnett617.github.io/wilson-blog/posts/2018-08-27-koa-vue-forum/"},"publisher":{"@type":"Organization","name":"Wilson's Blog","logo":{"@type":"ImageObject","url":"https://barnett617.github.io/wilson-blog/favicon_io/favicon.ico"}}}</script></head><body id=top><script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add("dark"):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove("dark"):window.matchMedia("(prefers-color-scheme: dark)").matches&&document.body.classList.add("dark")</script><header class=header><nav class=nav><div class=logo><a href=https://barnett617.github.io/wilson-blog/ accesskey=h title="Wilson's Blog (Alt + H)"><img src=https://barnett617.github.io/wilson-blog/favicon_io/apple-touch-icon.png alt aria-label=logo height=35>Wilson's Blog</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button><ul class=lang-switch><li>|</li><li><a href=https://barnett617.github.io/wilson-blog/en/ title=English aria-label=English>En</a></li></ul></div></div><ul id=menu><li><a href=https://barnett617.github.io/wilson-blog/archives title=时间线><span>时间线</span></a></li><li><a href=https://barnett617.github.io/wilson-blog/search/ title=搜索><span>搜索</span></a></li><li><a href=https://barnett617.github.io/wilson-blog/tags/ title=标签分类><span>标签分类</span></a></li><li><a href=https://barnett617.github.io/wilson-blog/about/ title=关于我><span>关于我</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><h1 class=post-title>一周时间使用Vue+Koa全栈开发论坛项目</h1><div class=post-meta><span title='2018-08-27 09:30:00 +0000 UTC'>2018-08-27 09:30:00</span>&nbsp;·&nbsp;7 分钟&nbsp;·&nbsp;1472 字&nbsp;|&nbsp;<a href=https://github.com/barnett617/wilson-blog/tree/main/content//posts/2018-08-27-koa-vue-forum.md rel="noopener noreferrer" target=_blank>修改建议</a></div></header><div class=toc><details><summary accesskey=c title="(Alt + C)"><span class=details>目录</span></summary><div class=inner><nav id=TableOfContents><ul><li><a href=#1-安装-vue-cli3>1. 安装 vue-cli3</a></li><li><a href=#2-创建项目>2. 创建项目</a></li><li><a href=#3-核心配置文件>3. 核心配置文件</a></li><li><a href=#4-示例配置>4. 示例配置</a></li><li><a href=#5-packagejson>5. package.json</a></li><li><a href=#6-加入-router>6. 加入 router</a></li><li><a href=#7-开发主页面>7. 开发主页面</a></li><li><a href=#8-封装-ajax-请求对象>8. 封装 ajax 请求对象</a></li><li><a href=#9-路由使用>9. 路由使用</a></li><li><a href=#10-jenkins-自动化打包发布>10. jenkins 自动化打包发布</a></li><li><a href=#11-配置-nginx>11. 配置 Nginx</a></li><li><a href=#12-使用-koa-开发后端服务器提供接口>12. 使用 Koa 开发后端服务器提供接口</a></li><li><a href=#13-使用-pm2-部署启动后端项目>13. 使用 pm2 部署启动后端项目</a></li><li><a href=#14-增加后端请求路由配置>14. 增加后端请求路由配置</a></li><li><a href=#15-接收请求并处理>15. 接收请求并处理</a></li><li><a href=#16-操纵数据库做数据获取>16. 操纵数据库做数据获取</a></li><li><a href=#17-新建数据库>17. 新建数据库</a></li><li><a href=#18-后端接口服务-nginx-配置>18. 后端接口服务 nginx 配置</a></li><li><a href=#19-发布后端服务到服务器指定目录>19. 发布后端服务到服务器指定目录</a></li><li><a href=#20-启动后端项目在服务器后端运行>20. 启动后端项目在服务器后端运行</a></li><li><a href=#21-完成>21. 完成</a></li></ul></nav></div></details></div><div class=post-content><p>使用 vue-cli3 脚手架初始化前端项目</p><h2 id=1-安装-vue-cli3>1. 安装 vue-cli3<a hidden class=anchor aria-hidden=true href=#1-安装-vue-cli3>#</a></h2><div class=highlight><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>npm install -g @vue/cli
</span></span></code></pre></div><h2 id=2-创建项目>2. 创建项目<a hidden class=anchor aria-hidden=true href=#2-创建项目>#</a></h2><div class=highlight><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>vue create code-monkeys-fe-vue
</span></span></code></pre></div><h2 id=3-核心配置文件>3. 核心配置文件<a hidden class=anchor aria-hidden=true href=#3-核心配置文件>#</a></h2><blockquote><p>vue-cli3 采用<code>约定优于配置</code>的思想，去除了很多配置项，转而都由项目根目录下的<code>vue.config.js</code>中既定的格式进行配置</p></blockquote><h2 id=4-示例配置>4. 示例配置<a hidden class=anchor aria-hidden=true href=#4-示例配置>#</a></h2><div class=highlight><pre tabindex=0 class=chroma><code class=language-js data-lang=js><span class=line><span class=cl><span class=kr>const</span> <span class=nx>express</span> <span class=o>=</span> <span class=nx>require</span><span class=p>(</span><span class=s2>&#34;express&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=kr>const</span> <span class=nx>app</span> <span class=o>=</span> <span class=nx>express</span><span class=p>();</span>
</span></span><span class=line><span class=cl><span class=kr>const</span> <span class=nx>fs</span> <span class=o>=</span> <span class=nx>require</span><span class=p>(</span><span class=s2>&#34;fs&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=kr>const</span> <span class=nx>path</span> <span class=o>=</span> <span class=nx>require</span><span class=p>(</span><span class=s2>&#34;path&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>var</span> <span class=nx>apiRoutes</span> <span class=o>=</span> <span class=nx>express</span><span class=p>.</span><span class=nx>Router</span><span class=p>();</span>
</span></span><span class=line><span class=cl><span class=nx>app</span><span class=p>.</span><span class=nx>use</span><span class=p>(</span><span class=s2>&#34;/mock&#34;</span><span class=p>,</span> <span class=nx>apiRoutes</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kr>const</span> <span class=nx>responseFunction</span> <span class=o>=</span> <span class=p>(</span><span class=nx>req</span><span class=p>,</span> <span class=nx>res</span><span class=p>)</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=kr>const</span> <span class=nx>fileName</span> <span class=o>=</span> <span class=nx>req</span><span class=p>.</span><span class=nx>params</span><span class=p>.</span><span class=nx>fileName</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=kd>let</span> <span class=nx>obj</span> <span class=o>=</span> <span class=kc>null</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=k>try</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=c1>// require 有缓存问题
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=kd>let</span> <span class=nx>objStr</span> <span class=o>=</span> <span class=nx>fs</span>
</span></span><span class=line><span class=cl>      <span class=p>.</span><span class=nx>readFileSync</span><span class=p>(</span><span class=nx>path</span><span class=p>.</span><span class=nx>join</span><span class=p>(</span><span class=nx>__dirname</span><span class=p>,</span> <span class=s2>&#34;/mock/data/&#34;</span> <span class=o>+</span> <span class=nx>fileName</span><span class=p>))</span>
</span></span><span class=line><span class=cl>      <span class=p>.</span><span class=nx>toString</span><span class=p>();</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=p>(</span><span class=nx>objStr</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=nx>obj</span> <span class=o>=</span> <span class=nx>JSON</span><span class=p>.</span><span class=nx>parse</span><span class=p>(</span><span class=nx>objStr</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span> <span class=k>catch</span> <span class=p>(</span><span class=nx>e</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=c1>// console.log(&#39;无法打开 =&gt; &#39; + fileName + &#39; 文件&#39;);
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=k>if</span> <span class=p>(</span><span class=o>!</span><span class=nx>obj</span> <span class=o>||</span> <span class=nx>obj</span> <span class=o>==</span> <span class=kc>undefined</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>res</span><span class=p>.</span><span class=nx>json</span><span class=p>({</span>
</span></span><span class=line><span class=cl>      <span class=nx>err</span><span class=o>:</span> <span class=s2>&#34;json文件无数据&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=p>});</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span> <span class=k>else</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>res</span><span class=p>.</span><span class=nx>json</span><span class=p>(</span><span class=nx>obj</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>};</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nx>module</span><span class=p>.</span><span class=nx>exports</span> <span class=o>=</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nx>devServer</span><span class=o>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=c1>// 中间加一道代理，根据识别到的路由规则拦截请求（此函数相当于拦截器）
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=nx>before</span><span class=p>(</span><span class=nx>app</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=nx>app</span><span class=p>.</span><span class=nx>get</span><span class=p>(</span><span class=s2>&#34;/mock/data/:fileName&#34;</span><span class=p>,</span> <span class=nx>responseFunction</span><span class=p>);</span>
</span></span><span class=line><span class=cl>      <span class=nx>app</span><span class=p>.</span><span class=nx>post</span><span class=p>(</span><span class=s2>&#34;/mock/data/:fileName&#34;</span><span class=p>,</span> <span class=nx>responseFunction</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=p>},</span>
</span></span><span class=line><span class=cl>    <span class=c1>// 解决跨域问题，对`/api`请求代理跨域
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=nx>proxy</span><span class=o>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=s2>&#34;/api&#34;</span><span class=o>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=c1>// target: &#39;http://127.0.0.1:3000/&#39;,//设置你调用的接口域名和端口号
</span></span></span><span class=line><span class=cl><span class=c1></span>        <span class=nx>target</span><span class=o>:</span> <span class=s2>&#34;http://xx.xx.xx.xx:3000/&#34;</span><span class=p>,</span> <span class=c1>//设置你调用的接口域名和端口号
</span></span></span><span class=line><span class=cl><span class=c1></span>        <span class=nx>changeOrigin</span><span class=o>:</span> <span class=kc>true</span><span class=p>,</span> <span class=c1>//跨域
</span></span></span><span class=line><span class=cl><span class=c1></span>        <span class=c1>// pathRewrite: {
</span></span></span><span class=line><span class=cl><span class=c1></span>        <span class=c1>//   &#39;^/api&#39;: &#39;/&#39;          //这里理解成用‘/api’代替target里面的地址，后面组件中我们掉接口时直接用api代替 比如我要调用&#39;http://10.1.5.11:8080/xxx/duty?time=2017-07-07 14:57:22&#39;，直接写‘/api/xxx/duty?time=2017-07-07 14:57:22’即可
</span></span></span><span class=line><span class=cl><span class=c1></span>        <span class=c1>// }
</span></span></span><span class=line><span class=cl><span class=c1></span>      <span class=p>},</span>
</span></span><span class=line><span class=cl>    <span class=p>},</span>
</span></span><span class=line><span class=cl>  <span class=p>},</span>
</span></span><span class=line><span class=cl>  <span class=nx>configureWebpack</span><span class=o>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>devtool</span><span class=o>:</span> <span class=s2>&#34;source-map&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=p>},</span>
</span></span><span class=line><span class=cl><span class=p>};</span>
</span></span></code></pre></div><h2 id=5-packagejson>5. package.json<a hidden class=anchor aria-hidden=true href=#5-packagejson>#</a></h2><div class=highlight><pre tabindex=0 class=chroma><code class=language-json data-lang=json><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;name&#34;</span><span class=p>:</span> <span class=s2>&#34;code-monkeys-fe-vue&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;version&#34;</span><span class=p>:</span> <span class=s2>&#34;0.1.0&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;private&#34;</span><span class=p>:</span> <span class=kc>true</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;scripts&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;dev&#34;</span><span class=p>:</span> <span class=s2>&#34;cross-env NODE_ENV=dev vue-cli-service serve --inspect --open&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;build&#34;</span><span class=p>:</span> <span class=s2>&#34;cross-env NODE_ENV=prod vue-cli-service build&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;lint&#34;</span><span class=p>:</span> <span class=s2>&#34;vue-cli-service lint&#34;</span>
</span></span><span class=line><span class=cl>  <span class=p>},</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;dependencies&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;axios&#34;</span><span class=p>:</span> <span class=s2>&#34;^0.18.0&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;vue&#34;</span><span class=p>:</span> <span class=s2>&#34;^2.5.17&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;vue-router&#34;</span><span class=p>:</span> <span class=s2>&#34;^3.0.1&#34;</span>
</span></span><span class=line><span class=cl>  <span class=p>},</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;devDependencies&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;@vue/cli-plugin-babel&#34;</span><span class=p>:</span> <span class=s2>&#34;^3.0.0&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;@vue/cli-plugin-eslint&#34;</span><span class=p>:</span> <span class=s2>&#34;^3.0.0&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;@vue/cli-service&#34;</span><span class=p>:</span> <span class=s2>&#34;^3.0.0&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;cross-env&#34;</span><span class=p>:</span> <span class=s2>&#34;^5.2.0&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;vue-template-compiler&#34;</span><span class=p>:</span> <span class=s2>&#34;^2.5.17&#34;</span>
</span></span><span class=line><span class=cl>  <span class=p>},</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;eslintConfig&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;root&#34;</span><span class=p>:</span> <span class=kc>true</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;env&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=nt>&#34;node&#34;</span><span class=p>:</span> <span class=kc>true</span>
</span></span><span class=line><span class=cl>    <span class=p>},</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;extends&#34;</span><span class=p>:</span> <span class=p>[</span><span class=s2>&#34;plugin:vue/essential&#34;</span><span class=p>,</span> <span class=s2>&#34;eslint:recommended&#34;</span><span class=p>],</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;rules&#34;</span><span class=p>:</span> <span class=p>{},</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;parserOptions&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=nt>&#34;parser&#34;</span><span class=p>:</span> <span class=s2>&#34;babel-eslint&#34;</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=p>},</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;postcss&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;plugins&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=nt>&#34;autoprefixer&#34;</span><span class=p>:</span> <span class=p>{}</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=p>},</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;browserslist&#34;</span><span class=p>:</span> <span class=p>[</span><span class=s2>&#34;&gt; 1%&#34;</span><span class=p>,</span> <span class=s2>&#34;last 2 versions&#34;</span><span class=p>,</span> <span class=s2>&#34;not ie &lt;= 8&#34;</span><span class=p>]</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><h2 id=6-加入-router>6. 加入 router<a hidden class=anchor aria-hidden=true href=#6-加入-router>#</a></h2><blockquote><p>修改入口文件</p></blockquote><div class=highlight><pre tabindex=0 class=chroma><code class=language-js data-lang=js><span class=line><span class=cl><span class=kr>import</span> <span class=nx>Vue</span> <span class=nx>from</span> <span class=s2>&#34;vue&#34;</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=kr>import</span> <span class=nx>App</span> <span class=nx>from</span> <span class=s2>&#34;./App.vue&#34;</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=kr>import</span> <span class=s2>&#34;./utils/global&#34;</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=kr>import</span> <span class=nx>router</span> <span class=nx>from</span> <span class=s2>&#34;./router&#34;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nx>Vue</span><span class=p>.</span><span class=nx>config</span><span class=p>.</span><span class=nx>productionTip</span> <span class=o>=</span> <span class=kc>false</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>new</span> <span class=nx>Vue</span><span class=p>({</span>
</span></span><span class=line><span class=cl>  <span class=nx>router</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nx>render</span><span class=o>:</span> <span class=p>(</span><span class=nx>h</span><span class=p>)</span> <span class=p>=&gt;</span> <span class=nx>h</span><span class=p>(</span><span class=nx>App</span><span class=p>),</span>
</span></span><span class=line><span class=cl><span class=p>}).</span><span class=nx>$mount</span><span class=p>(</span><span class=s2>&#34;#app&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nx>router</span><span class=p>.</span><span class=nx>push</span><span class=p>(</span><span class=s2>&#34;/&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// 相当于以下完整写法，见：https://segmentfault.com/a/1190000014254740
</span></span></span><span class=line><span class=cl><span class=c1>// const app=new Vue({
</span></span></span><span class=line><span class=cl><span class=c1>//   el:&#39;#app&#39;,
</span></span></span><span class=line><span class=cl><span class=c1>//   router,
</span></span></span><span class=line><span class=cl><span class=c1>//   compoments:{
</span></span></span><span class=line><span class=cl><span class=c1>//       App
</span></span></span><span class=line><span class=cl><span class=c1>//   },
</span></span></span><span class=line><span class=cl><span class=c1>//   template:&#34;&lt;App/&gt;&#34;
</span></span></span><span class=line><span class=cl><span class=c1>// });
</span></span></span></code></pre></div><blockquote><p>增加路由配置</p></blockquote><div class=highlight><pre tabindex=0 class=chroma><code class=language-js data-lang=js><span class=line><span class=cl><span class=kr>import</span> <span class=nx>Vue</span> <span class=nx>from</span> <span class=s2>&#34;vue&#34;</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=kr>import</span> <span class=nx>Router</span> <span class=nx>from</span> <span class=s2>&#34;vue-router&#34;</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=kr>import</span> <span class=nx>HomeContent</span> <span class=nx>from</span> <span class=s2>&#34;@/views/HomeContent&#34;</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=kr>import</span> <span class=nx>SinglePostContent</span> <span class=nx>from</span> <span class=s2>&#34;@/components/ForumPost/SinglePostContent.vue&#34;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nx>Vue</span><span class=p>.</span><span class=nx>use</span><span class=p>(</span><span class=nx>Router</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kr>export</span> <span class=k>default</span> <span class=k>new</span> <span class=nx>Router</span><span class=p>({</span>
</span></span><span class=line><span class=cl>  <span class=nx>mode</span><span class=o>:</span> <span class=s2>&#34;history&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nx>routes</span><span class=o>:</span> <span class=p>[</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=nx>path</span><span class=o>:</span> <span class=s2>&#34;/&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=nx>name</span><span class=o>:</span> <span class=s2>&#34;homeContent&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=nx>component</span><span class=o>:</span> <span class=nx>HomeContent</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=p>},</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=nx>path</span><span class=o>:</span> <span class=s2>&#34;/single-post/:id&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=nx>name</span><span class=o>:</span> <span class=s2>&#34;single-post-content&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=nx>component</span><span class=o>:</span> <span class=nx>SinglePostContent</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=p>},</span>
</span></span><span class=line><span class=cl>  <span class=p>],</span>
</span></span><span class=line><span class=cl><span class=p>});</span>
</span></span></code></pre></div><h2 id=7-开发主页面>7. 开发主页面<a hidden class=anchor aria-hidden=true href=#7-开发主页面>#</a></h2><div class=highlight><pre tabindex=0 class=chroma><code class=language-css data-lang=css><span class=line><span class=cl><span class=o>&lt;</span><span class=nt>template</span><span class=o>&gt;</span>
</span></span><span class=line><span class=cl>  <span class=o>&lt;</span><span class=nt>div</span> <span class=nt>id</span><span class=o>=</span><span class=s2>&#34;app&#34;</span><span class=o>&gt;</span>
</span></span><span class=line><span class=cl>    <span class=o>&lt;</span><span class=nt>ForumHome</span> <span class=o>/&gt;</span>
</span></span><span class=line><span class=cl>  <span class=o>&lt;/</span><span class=nt>div</span><span class=o>&gt;</span>
</span></span><span class=line><span class=cl><span class=o>&lt;/</span><span class=nt>template</span><span class=o>&gt;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=o>&lt;</span><span class=nt>script</span><span class=o>&gt;</span>
</span></span><span class=line><span class=cl><span class=nt>import</span> <span class=nt>ForumHome</span> <span class=nt>from</span> <span class=s1>&#39;./components/ForumHome.vue&#39;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nt>export</span> <span class=nt>default</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=n>name</span><span class=p>:</span> <span class=s1>&#39;app&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=n>components</span><span class=o>:</span> <span class=err>{</span>
</span></span><span class=line><span class=cl>    <span class=n>ForumHome</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=err>}</span>
</span></span><span class=line><span class=cl><span class=o>&lt;/</span><span class=nt>script</span><span class=o>&gt;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=o>&lt;</span><span class=nt>style</span><span class=o>&gt;</span>
</span></span><span class=line><span class=cl><span class=p>#</span><span class=nn>app</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=k>font-family</span><span class=p>:</span> <span class=s1>&#39;Avenir&#39;</span><span class=p>,</span> <span class=n>Helvetica</span><span class=p>,</span> <span class=n>Arial</span><span class=p>,</span> <span class=kc>sans-serif</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=kp>-webkit-</span><span class=n>font-smoothing</span><span class=p>:</span> <span class=n>antialiased</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=kp>-moz-</span><span class=n>osx-font-smoothing</span><span class=p>:</span> <span class=n>grayscale</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=k>color</span><span class=p>:</span> <span class=mh>#2c3e50</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=k>height</span><span class=p>:</span> <span class=mi>100</span><span class=kt>%</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=c>/* margin-top: 60px; */</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl><span class=nt>html</span><span class=o>,</span> <span class=nt>body</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=k>height</span><span class=p>:</span> <span class=mi>100</span><span class=kt>%</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl><span class=nt>a</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=k>text-decoration</span><span class=p>:</span> <span class=kc>none</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=k>cursor</span><span class=p>:</span> <span class=kc>pointer</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl><span class=o>&lt;/</span><span class=nt>style</span><span class=o>&gt;</span>
</span></span></code></pre></div><h2 id=8-封装-ajax-请求对象>8. 封装 ajax 请求对象<a hidden class=anchor aria-hidden=true href=#8-封装-ajax-请求对象>#</a></h2><div class=highlight><pre tabindex=0 class=chroma><code class=language-js data-lang=js><span class=line><span class=cl><span class=c1>// export 时使用default，则import时不需要加大括号，否则需要加大括号引入export导出的变量
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kr>import</span> <span class=nx>apiConfig</span> <span class=nx>from</span> <span class=s2>&#34;./apiConfig&#34;</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=kr>import</span> <span class=nx>axios</span> <span class=nx>from</span> <span class=s2>&#34;axios&#34;</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=cm>/**
</span></span></span><span class=line><span class=cl><span class=cm> * 使用立即执行函数表达式（IIFE）声明一些全局性（window对象的）方法或属性
</span></span></span><span class=line><span class=cl><span class=cm> */</span>
</span></span><span class=line><span class=cl><span class=p>(</span><span class=kd>function</span> <span class=p>(</span><span class=nx>win</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=cm>/**
</span></span></span><span class=line><span class=cl><span class=cm>   * 为 String 添加 endsWith 方法，此方法在ES6中实现，以下为向下兼容处理（Polyfill）
</span></span></span><span class=line><span class=cl><span class=cm>   */</span>
</span></span><span class=line><span class=cl>  <span class=k>if</span> <span class=p>(</span><span class=o>!</span><span class=nb>String</span><span class=p>.</span><span class=nx>prototype</span><span class=p>.</span><span class=nx>endsWith</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nb>String</span><span class=p>.</span><span class=nx>prototype</span><span class=p>.</span><span class=nx>endsWith</span> <span class=o>=</span> <span class=kd>function</span> <span class=p>(</span><span class=nx>search</span><span class=p>,</span> <span class=nx>this_len</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=k>if</span> <span class=p>(</span><span class=nx>this_len</span> <span class=o>===</span> <span class=kc>undefined</span> <span class=o>||</span> <span class=nx>this_len</span> <span class=o>&gt;</span> <span class=k>this</span><span class=p>.</span><span class=nx>length</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nx>this_len</span> <span class=o>=</span> <span class=k>this</span><span class=p>.</span><span class=nx>length</span><span class=p>;</span>
</span></span><span class=line><span class=cl>      <span class=p>}</span>
</span></span><span class=line><span class=cl>      <span class=k>return</span> <span class=k>this</span><span class=p>.</span><span class=nx>substring</span><span class=p>(</span><span class=nx>this_len</span> <span class=o>-</span> <span class=nx>search</span><span class=p>.</span><span class=nx>length</span><span class=p>,</span> <span class=nx>this_len</span><span class=p>)</span> <span class=o>===</span> <span class=nx>search</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=p>};</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=cm>/**
</span></span></span><span class=line><span class=cl><span class=cm>   * 判断是否是字符串
</span></span></span><span class=line><span class=cl><span class=cm>   * @param {*} obj
</span></span></span><span class=line><span class=cl><span class=cm>   */</span>
</span></span><span class=line><span class=cl>  <span class=kd>function</span> <span class=nx>isStr</span><span class=p>(</span><span class=nx>obj</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=k>typeof</span> <span class=nx>obj</span> <span class=o>===</span> <span class=s2>&#34;string&#34;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=cm>/**
</span></span></span><span class=line><span class=cl><span class=cm>   * ajax请求
</span></span></span><span class=line><span class=cl><span class=cm>   * @param {*} obj
</span></span></span><span class=line><span class=cl><span class=cm>   */</span>
</span></span><span class=line><span class=cl>  <span class=kr>const</span> <span class=nx>ajax</span> <span class=o>=</span> <span class=kd>function</span> <span class=p>(</span><span class=nx>obj</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=c1>// 最终ajax请求的地址
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=kd>let</span> <span class=nx>url</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=kr>const</span> <span class=nx>ajaxUrl</span> <span class=o>=</span> <span class=nx>obj</span><span class=p>.</span><span class=nx>url</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=c1>// 如果地址以Api结尾
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=k>if</span> <span class=p>(</span><span class=nx>isStr</span><span class=p>(</span><span class=nx>ajaxUrl</span><span class=p>)</span> <span class=o>&amp;&amp;</span> <span class=nx>ajaxUrl</span><span class=p>.</span><span class=nx>endsWith</span><span class=p>(</span><span class=s2>&#34;Api&#34;</span><span class=p>))</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=c1>// 判断环境是否为开发环境
</span></span></span><span class=line><span class=cl><span class=c1></span>      <span class=kr>const</span> <span class=nx>env</span> <span class=o>=</span> <span class=nx>process</span><span class=p>.</span><span class=nx>env</span><span class=p>.</span><span class=nx>NODE_ENV</span><span class=p>;</span>
</span></span><span class=line><span class=cl>      <span class=c1>// 存在环境变量设置并且在枚举范围内
</span></span></span><span class=line><span class=cl><span class=c1></span>      <span class=k>if</span> <span class=p>(</span><span class=nx>env</span> <span class=o>&amp;&amp;</span> <span class=nx>apiConfig</span><span class=p>[</span><span class=nx>ajaxUrl</span><span class=p>]</span> <span class=o>&amp;&amp;</span> <span class=nx>apiConfig</span><span class=p>[</span><span class=nx>ajaxUrl</span><span class=p>][</span><span class=nx>env</span><span class=p>])</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nx>url</span> <span class=o>=</span> <span class=nx>apiConfig</span><span class=p>[</span><span class=nx>ajaxUrl</span><span class=p>][</span><span class=nx>env</span><span class=p>];</span>
</span></span><span class=line><span class=cl>      <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span> <span class=k>else</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=nx>url</span> <span class=o>=</span> <span class=nx>ajaxUrl</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=cm>/* eslint-disable */</span>
</span></span><span class=line><span class=cl>    <span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=nx>obj</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=nx>url</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=p>(</span><span class=nx>obj</span><span class=p>.</span><span class=nx>type</span> <span class=o>==</span> <span class=s2>&#34;get&#34;</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=nx>axios</span>
</span></span><span class=line><span class=cl>        <span class=p>.</span><span class=nx>get</span><span class=p>(</span><span class=nx>url</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=p>.</span><span class=nx>then</span><span class=p>(</span><span class=kd>function</span> <span class=p>(</span><span class=nx>response</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>          <span class=nx>obj</span><span class=p>.</span><span class=nx>callback</span><span class=p>(</span><span class=nx>response</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=p>})</span>
</span></span><span class=line><span class=cl>        <span class=p>.</span><span class=k>catch</span><span class=p>(</span><span class=kd>function</span> <span class=p>(</span><span class=nx>error</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>          <span class=nx>obj</span><span class=p>.</span><span class=nx>err</span><span class=p>(</span><span class=nx>error</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=p>});</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span> <span class=k>else</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=nx>url</span><span class=p>,</span> <span class=nx>obj</span><span class=p>.</span><span class=nx>params</span><span class=p>);</span>
</span></span><span class=line><span class=cl>      <span class=nx>axios</span>
</span></span><span class=line><span class=cl>        <span class=p>.</span><span class=nx>post</span><span class=p>(</span><span class=nx>url</span><span class=p>,</span> <span class=nx>obj</span><span class=p>.</span><span class=nx>params</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=p>.</span><span class=nx>then</span><span class=p>(</span><span class=kd>function</span> <span class=p>(</span><span class=nx>response</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>          <span class=nx>obj</span><span class=p>.</span><span class=nx>callback</span><span class=p>(</span><span class=nx>response</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=p>})</span>
</span></span><span class=line><span class=cl>        <span class=p>.</span><span class=k>catch</span><span class=p>(</span><span class=kd>function</span> <span class=p>(</span><span class=nx>error</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>          <span class=nx>obj</span><span class=p>.</span><span class=nx>err</span><span class=p>(</span><span class=nx>error</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=p>});</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=p>};</span>
</span></span><span class=line><span class=cl>  <span class=nx>win</span><span class=p>.</span><span class=nx>ajax</span> <span class=o>=</span> <span class=nx>ajax</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=nx>win</span><span class=p>.</span><span class=nx>isStr</span> <span class=o>=</span> <span class=nx>isStr</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>})(</span><span class=nb>window</span><span class=p>);</span>
</span></span></code></pre></div><h2 id=9-路由使用>9. 路由使用<a hidden class=anchor aria-hidden=true href=#9-路由使用>#</a></h2><div class=highlight><pre tabindex=0 class=chroma><code class=language-vue data-lang=vue><span class=line><span class=cl><span class=p>&lt;</span><span class=nt>template</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>  <span class=p>&lt;</span><span class=nt>div</span> <span class=na>class</span><span class=o>=</span><span class=s>&#34;home-center&#34;</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>    <span class=p>&lt;</span><span class=nt>div</span> <span class=na>class</span><span class=o>=</span><span class=s>&#34;home-center-nav&#34;</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>      <span class=p>&lt;</span><span class=nt>router-link</span> <span class=na>class</span><span class=o>=</span><span class=s>&#34;home-router&#34;</span> <span class=na>to</span><span class=o>=</span><span class=s>&#34;/&#34;</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>        <span class=p>{{</span> <span class=nx>page_title</span> <span class=p>}}</span>
</span></span><span class=line><span class=cl>      <span class=o>&lt;</span><span class=err>/router-link&gt;</span>
</span></span><span class=line><span class=cl>    <span class=p>&lt;/</span><span class=nt>div</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>    <span class=c>&lt;!--</span> <span class=nx>以下为路由所决定显示的部分</span> <span class=o>--&gt;</span>
</span></span><span class=line><span class=cl>    <span class=p>&lt;</span><span class=nt>router-view</span><span class=p>&gt;</span><span class=o>&lt;</span><span class=err>/router-view&gt;</span>
</span></span><span class=line><span class=cl>  <span class=p>&lt;/</span><span class=nt>div</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl><span class=p>&lt;/</span><span class=nt>template</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=p>&lt;</span><span class=nt>script</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl><span class=kr>export</span> <span class=k>default</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nx>name</span><span class=o>:</span> <span class=s1>&#39;HomeCenter&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nx>data</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=nx>page_title</span><span class=o>:</span> <span class=s1>&#39;Home&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=p>},</span>
</span></span><span class=line><span class=cl>  <span class=nx>components</span><span class=o>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=p>},</span>
</span></span><span class=line><span class=cl>  <span class=nx>props</span><span class=o>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>msg</span><span class=o>:</span> <span class=nb>String</span>
</span></span><span class=line><span class=cl>  <span class=p>},</span>
</span></span><span class=line><span class=cl>  <span class=nx>methods</span><span class=o>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=p>},</span>
</span></span><span class=line><span class=cl>  <span class=nx>created</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>&lt;/</span><span class=nt>script</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c>&lt;!--</span> <span class=nx>Add</span> <span class=s2>&#34;scoped&#34;</span> <span class=nx>attribute</span> <span class=nx>to</span> <span class=nx>limit</span> <span class=nx>CSS</span> <span class=nx>to</span> <span class=k>this</span> <span class=nx>component</span> <span class=nx>only</span> <span class=o>--&gt;</span>
</span></span><span class=line><span class=cl><span class=p>&lt;</span><span class=nt>style</span> <span class=na>scoped</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl><span class=nx>body</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nx>height</span><span class=o>:</span> <span class=mi>100</span><span class=o>%</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>.</span><span class=nx>home</span><span class=o>-</span><span class=nx>router</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nx>color</span><span class=o>:</span> <span class=nx>rgb</span><span class=p>(</span><span class=mi>119</span><span class=p>,</span> <span class=mi>119</span><span class=p>,</span> <span class=mi>119</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>.</span><span class=nx>home</span><span class=o>-</span><span class=nx>center</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nx>display</span><span class=o>:</span> <span class=nx>flex</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=nx>flex</span><span class=o>-</span><span class=nx>direction</span><span class=o>:</span> <span class=nx>column</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=nx>height</span><span class=o>:</span> <span class=mi>100</span><span class=o>%</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=nx>background</span><span class=o>-</span><span class=nx>color</span><span class=o>:</span> <span class=err>#</span><span class=nx>EEEEEE</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=nx>padding</span><span class=o>:</span> <span class=mi>0</span> <span class=mi>143</span><span class=nx>px</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>.</span><span class=nx>home</span><span class=o>-</span><span class=nx>center</span><span class=o>-</span><span class=nx>nav</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nx>padding</span><span class=o>:</span> <span class=mi>15</span><span class=nx>px</span> <span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>.</span><span class=nx>home</span><span class=o>-</span><span class=nx>center</span><span class=o>-</span><span class=nx>content</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nx>display</span><span class=o>:</span> <span class=nx>flex</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=nx>justify</span><span class=o>-</span><span class=nx>content</span><span class=o>:</span> <span class=nx>flex</span><span class=o>-</span><span class=nx>start</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>&lt;/</span><span class=nt>style</span><span class=p>&gt;</span>
</span></span></code></pre></div><h2 id=10-jenkins-自动化打包发布>10. jenkins 自动化打包发布<a hidden class=anchor aria-hidden=true href=#10-jenkins-自动化打包发布>#</a></h2><blockquote><p>拉取指定 git 仓库指定分支或指定 tag 代码并执行以下脚本完成编译打包</p></blockquote><div class=highlight><pre tabindex=0 class=chroma><code class=language-sh data-lang=sh><span class=line><span class=cl>npm config <span class=nb>set</span> registry http://registry.npm.taobao.org/ <span class=o>&amp;&amp;</span>
</span></span><span class=line><span class=cl>npm install <span class=o>&amp;&amp;</span>
</span></span><span class=line><span class=cl>npm run build <span class=o>&amp;&amp;</span>
</span></span><span class=line><span class=cl><span class=nb>cd</span> dist <span class=o>&amp;&amp;</span>
</span></span><span class=line><span class=cl>tar -zcvf dist.tar.gz *
</span></span></code></pre></div><blockquote><p>指定服务器地址，通过 ssh 方式发送项目包并解压到指定目录</p></blockquote><div class=highlight><pre tabindex=0 class=chroma><code class=language-sh data-lang=sh><span class=line><span class=cl><span class=nb>cd</span> /opt/www/codemonkeys-fe
</span></span><span class=line><span class=cl>tar -zxvf dist.tar.gz
</span></span><span class=line><span class=cl>rm -rf dist.tar.gz
</span></span></code></pre></div><h2 id=11-配置-nginx>11. 配置 Nginx<a hidden class=anchor aria-hidden=true href=#11-配置-nginx>#</a></h2><div class=highlight><pre tabindex=0 class=chroma><code class=language-gdscript3 data-lang=gdscript3><span class=line><span class=cl><span class=n>server</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=n>listen</span>       <span class=mi>80</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=n>server_name</span>  <span class=n>xxx</span><span class=o>.</span><span class=n>com</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1>#charset koi8-r;</span>
</span></span><span class=line><span class=cl>    <span class=n>access_log</span>  <span class=o>/</span><span class=k>var</span><span class=o>/</span><span class=nb>log</span><span class=o>/</span><span class=n>nginx</span><span class=o>/</span><span class=n>xxx</span><span class=o>.</span><span class=n>com</span><span class=o>.</span><span class=n>access</span><span class=o>.</span><span class=n>log</span>  <span class=n>main</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>location</span> <span class=o>/</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=n>root</span>    <span class=o>/</span><span class=n>opt</span><span class=o>/</span><span class=n>www</span><span class=o>/</span><span class=n>xxx</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=n>index</span>   <span class=n>index</span><span class=o>.</span><span class=n>html</span> <span class=n>index</span><span class=o>.</span><span class=n>htm</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1># redirect server error pages to the static page /50x.html</span>
</span></span><span class=line><span class=cl>    <span class=c1>#</span>
</span></span><span class=line><span class=cl>    <span class=n>error_page</span>   <span class=mi>500</span> <span class=mi>502</span> <span class=mi>503</span> <span class=mi>504</span>  <span class=o>/</span><span class=mi>50</span><span class=n>x</span><span class=o>.</span><span class=n>html</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=n>location</span> <span class=o>=</span> <span class=o>/</span><span class=mi>50</span><span class=n>x</span><span class=o>.</span><span class=n>html</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=n>root</span>   <span class=o>/</span><span class=n>usr</span><span class=o>/</span><span class=n>share</span><span class=o>/</span><span class=n>nginx</span><span class=o>/</span><span class=n>html</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><h2 id=12-使用-koa-开发后端服务器提供接口>12. 使用 Koa 开发后端服务器提供接口<a hidden class=anchor aria-hidden=true href=#12-使用-koa-开发后端服务器提供接口>#</a></h2><blockquote><p>初始化 package.json</p></blockquote><div class=highlight><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>npm init
</span></span></code></pre></div><blockquote><p>配置 package.json</p></blockquote><div class=highlight><pre tabindex=0 class=chroma><code class=language-json data-lang=json><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;name&#34;</span><span class=p>:</span> <span class=s2>&#34;code-monkeys-fe-node&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;version&#34;</span><span class=p>:</span> <span class=s2>&#34;1.0.0&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;description&#34;</span><span class=p>:</span> <span class=s2>&#34;#### 项目介绍 前段项目node代理服务&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;main&#34;</span><span class=p>:</span> <span class=s2>&#34;index.js&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;scripts&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;dev&#34;</span><span class=p>:</span> <span class=s2>&#34;export NODE_ENV=development &amp;&amp; nodemon --harmony ./app.js&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;test&#34;</span><span class=p>:</span> <span class=s2>&#34;echo \&#34;Error: no test specified\&#34; &amp;&amp; exit 1&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;deploy_setup&#34;</span><span class=p>:</span> <span class=s2>&#34;pm2 deploy ecosystem.config.js production setup&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;deploy&#34;</span><span class=p>:</span> <span class=s2>&#34;pm2 deploy ecosystem.config.js production&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;start&#34;</span><span class=p>:</span> <span class=s2>&#34;export NODE_ENV=production &amp;&amp; pm2 start ./app.js --max-memory-restart 300M -n codemonkeys-node --watch&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;stop&#34;</span><span class=p>:</span> <span class=s2>&#34;export NODE_ENV=production &amp;&amp; pm2 stop ./app.js -n codemonkeys-node&#34;</span>
</span></span><span class=line><span class=cl>  <span class=p>},</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;repository&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;type&#34;</span><span class=p>:</span> <span class=s2>&#34;git&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;url&#34;</span><span class=p>:</span> <span class=s2>&#34;git@xxx.git&#34;</span>
</span></span><span class=line><span class=cl>  <span class=p>},</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;author&#34;</span><span class=p>:</span> <span class=s2>&#34;codemonkeys@wangxin&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;license&#34;</span><span class=p>:</span> <span class=s2>&#34;ISC&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;dependencies&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;babel-preset-es2015&#34;</span><span class=p>:</span> <span class=s2>&#34;^6.24.1&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;babel-preset-stage-0&#34;</span><span class=p>:</span> <span class=s2>&#34;^6.24.1&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;koa&#34;</span><span class=p>:</span> <span class=s2>&#34;^2.5.3&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;koa-bodyparser&#34;</span><span class=p>:</span> <span class=s2>&#34;^4.2.1&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;koa-logger&#34;</span><span class=p>:</span> <span class=s2>&#34;^3.2.0&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;koa-mysql-session&#34;</span><span class=p>:</span> <span class=s2>&#34;0.0.2&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;koa-redis&#34;</span><span class=p>:</span> <span class=s2>&#34;^3.1.2&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;koa-router&#34;</span><span class=p>:</span> <span class=s2>&#34;^7.4.0&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;koa-session-minimal&#34;</span><span class=p>:</span> <span class=s2>&#34;^3.0.4&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;koa2-cors&#34;</span><span class=p>:</span> <span class=s2>&#34;^2.0.6&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;mysql&#34;</span><span class=p>:</span> <span class=s2>&#34;^2.16.0&#34;</span>
</span></span><span class=line><span class=cl>  <span class=p>},</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;devDependencies&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;nodemon&#34;</span><span class=p>:</span> <span class=s2>&#34;^1.18.4&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;pm2&#34;</span><span class=p>:</span> <span class=s2>&#34;^3.2.2&#34;</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><blockquote><p>入口主文件<code>app.js</code></p></blockquote><div class=highlight><pre tabindex=0 class=chroma><code class=language-js data-lang=js><span class=line><span class=cl><span class=kr>const</span> <span class=nx>Koa</span> <span class=o>=</span> <span class=nx>require</span><span class=p>(</span><span class=s2>&#34;koa&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=kr>const</span> <span class=nx>app</span> <span class=o>=</span> <span class=k>new</span> <span class=nx>Koa</span><span class=p>();</span>
</span></span><span class=line><span class=cl><span class=kr>const</span> <span class=nx>routers</span> <span class=o>=</span> <span class=nx>require</span><span class=p>(</span><span class=s2>&#34;./router/index&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=kr>const</span> <span class=nx>koaLogger</span> <span class=o>=</span> <span class=nx>require</span><span class=p>(</span><span class=s2>&#34;koa-logger&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=kr>const</span> <span class=nx>session</span> <span class=o>=</span> <span class=nx>require</span><span class=p>(</span><span class=s2>&#34;koa-session-minimal&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=kr>const</span> <span class=nx>redisStore</span> <span class=o>=</span> <span class=nx>require</span><span class=p>(</span><span class=s2>&#34;koa-redis&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=kr>const</span> <span class=nx>cors</span> <span class=o>=</span> <span class=nx>require</span><span class=p>(</span><span class=s2>&#34;koa2-cors&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=kr>const</span> <span class=nx>bodyParser</span> <span class=o>=</span> <span class=nx>require</span><span class=p>(</span><span class=s2>&#34;koa-bodyparser&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kr>const</span> <span class=p>{</span> <span class=nx>HOST</span><span class=p>,</span> <span class=nx>PORT</span> <span class=p>}</span> <span class=o>=</span> <span class=nx>require</span><span class=p>(</span><span class=s2>&#34;./config/server-info&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kr>const</span> <span class=nx>env</span> <span class=o>=</span> <span class=nx>process</span><span class=p>.</span><span class=nx>env</span><span class=p>.</span><span class=nx>NODE_ENV</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// cookie
</span></span></span><span class=line><span class=cl><span class=c1>// 存放sessionId的cookie配置
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=cm>/* session cookie */</span>
</span></span><span class=line><span class=cl><span class=kd>let</span> <span class=nx>cookieConfig</span> <span class=o>=</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nx>maxAge</span><span class=o>:</span> <span class=mi>86400000</span><span class=p>,</span> <span class=c1>// cookie有效时长
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=nx>expires</span><span class=o>:</span> <span class=s2>&#34;&#34;</span><span class=p>,</span> <span class=c1>// cookie失效时间
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=nx>path</span><span class=o>:</span> <span class=s2>&#34;&#34;</span><span class=p>,</span> <span class=c1>// 写cookie所在的路径
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=nx>domain</span><span class=o>:</span> <span class=nx>HOST</span><span class=p>,</span> <span class=c1>// 写cookie所在的域名
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=nx>httpOnly</span><span class=o>:</span> <span class=kc>true</span><span class=p>,</span> <span class=c1>// 是否只用于http请求中获取
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=nx>overwrite</span><span class=o>:</span> <span class=kc>true</span><span class=p>,</span> <span class=c1>// 是否允许重写
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=nx>secure</span><span class=o>:</span> <span class=s2>&#34;&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nx>sameSite</span><span class=o>:</span> <span class=s2>&#34;&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nx>signed</span><span class=o>:</span> <span class=s2>&#34;&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl><span class=p>};</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// 使用koa2-cors中间件解决跨域请求
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=nx>app</span><span class=p>.</span><span class=nx>use</span><span class=p>(</span><span class=nx>cors</span><span class=p>());</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nx>app</span><span class=p>.</span><span class=nx>use</span><span class=p>(</span><span class=nx>bodyParser</span><span class=p>());</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// 配置session中间件
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=nx>app</span><span class=p>.</span><span class=nx>use</span><span class=p>(</span>
</span></span><span class=line><span class=cl>  <span class=nx>session</span><span class=p>({</span>
</span></span><span class=line><span class=cl>    <span class=nx>key</span><span class=o>:</span> <span class=s2>&#34;USER_SID&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nx>store</span><span class=o>:</span> <span class=nx>redisStore</span><span class=p>(),</span>
</span></span><span class=line><span class=cl>    <span class=nx>cookie</span><span class=o>:</span> <span class=nx>cookieConfig</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=p>})</span>
</span></span><span class=line><span class=cl><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nx>app</span><span class=p>.</span><span class=nx>use</span><span class=p>(</span><span class=nx>koaLogger</span><span class=p>());</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// 初始化路由中间件
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=nx>app</span><span class=p>.</span><span class=nx>use</span><span class=p>(</span><span class=nx>routers</span><span class=p>.</span><span class=nx>routes</span><span class=p>()).</span><span class=nx>use</span><span class=p>(</span><span class=nx>routers</span><span class=p>.</span><span class=nx>allowedMethods</span><span class=p>());</span>
</span></span><span class=line><span class=cl><span class=nx>app</span><span class=p>.</span><span class=nx>use</span><span class=p>(</span><span class=kr>async</span> <span class=p>(</span><span class=nx>ctx</span><span class=p>)</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=k>if</span> <span class=p>(</span><span class=nx>ctx</span><span class=p>.</span><span class=nx>status</span> <span class=o>===</span> <span class=mi>404</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>ctx</span><span class=p>.</span><span class=nx>redirect</span><span class=p>(</span><span class=s2>&#34;/not-found&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>});</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// 监听启动端口
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=nx>app</span><span class=p>.</span><span class=nx>listen</span><span class=p>(</span><span class=nx>PORT</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=sb>`the server is start at port </span><span class=si>${</span><span class=nx>PORT</span><span class=si>}</span><span class=sb>`</span><span class=p>);</span>
</span></span></code></pre></div><h2 id=13-使用-pm2-部署启动后端项目>13. 使用 pm2 部署启动后端项目<a hidden class=anchor aria-hidden=true href=#13-使用-pm2-部署启动后端项目>#</a></h2><p>核心配置文件</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-js data-lang=js><span class=line><span class=cl><span class=nx>module</span><span class=p>.</span><span class=nx>exports</span> <span class=o>=</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nx>apps</span><span class=o>:</span> <span class=p>[</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=nx>script</span><span class=o>:</span> <span class=s2>&#34;app.js&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=nx>interpreter</span><span class=o>:</span> <span class=s2>&#34;node@10.0.0&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=c1>// Options reference: https://pm2.io/doc/en/runtime/reference/ecosystem-file/
</span></span></span><span class=line><span class=cl><span class=c1></span>      <span class=c1>// args: &#39;one two&#39;,
</span></span></span><span class=line><span class=cl><span class=c1></span>      <span class=nx>instances</span><span class=o>:</span> <span class=mi>1</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=nx>autorestart</span><span class=o>:</span> <span class=kc>true</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=nx>watch</span><span class=o>:</span> <span class=kc>false</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=nx>max_memory_restart</span><span class=o>:</span> <span class=s2>&#34;300M&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=nx>env</span><span class=o>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nx>NODE_ENV</span><span class=o>:</span> <span class=s2>&#34;development&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=p>},</span>
</span></span><span class=line><span class=cl>      <span class=nx>env_production</span><span class=o>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nx>NODE_ENV</span><span class=o>:</span> <span class=s2>&#34;production&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=p>},</span>
</span></span><span class=line><span class=cl>    <span class=p>},</span>
</span></span><span class=line><span class=cl>  <span class=p>],</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=nx>deploy</span><span class=o>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>production</span><span class=o>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=nx>user</span><span class=o>:</span> <span class=s2>&#34;root&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=nx>host</span><span class=o>:</span> <span class=s2>&#34;xx.xx.xx.xx&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=nx>ref</span><span class=o>:</span> <span class=s2>&#34;origin/master&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=nx>repo</span><span class=o>:</span> <span class=s2>&#34;git@xx.git&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=nx>path</span><span class=o>:</span> <span class=s2>&#34;/opt/www/xxx&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=nx>ssh_options</span><span class=o>:</span> <span class=s2>&#34;StrictHostKeyChecking=no&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=s2>&#34;post-deploy&#34;</span><span class=o>:</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;npm install &amp;&amp; pm2 reload ecosystem.config.js --env production&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=p>},</span>
</span></span><span class=line><span class=cl>  <span class=p>},</span>
</span></span><span class=line><span class=cl><span class=p>};</span>
</span></span></code></pre></div><h2 id=14-增加后端请求路由配置>14. 增加后端请求路由配置<a hidden class=anchor aria-hidden=true href=#14-增加后端请求路由配置>#</a></h2><div class=highlight><pre tabindex=0 class=chroma><code class=language-js data-lang=js><span class=line><span class=cl><span class=kr>const</span> <span class=nx>router</span> <span class=o>=</span> <span class=nx>require</span><span class=p>(</span><span class=s2>&#34;koa-router&#34;</span><span class=p>)();</span>
</span></span><span class=line><span class=cl><span class=kr>const</span> <span class=nx>api</span> <span class=o>=</span> <span class=nx>require</span><span class=p>(</span><span class=s2>&#34;../controller/api&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nx>module</span><span class=p>.</span><span class=nx>exports</span> <span class=o>=</span> <span class=nx>router</span>
</span></span><span class=line><span class=cl>  <span class=p>.</span><span class=nx>get</span><span class=p>(</span><span class=s2>&#34;/&#34;</span><span class=p>,</span> <span class=nx>api</span><span class=p>.</span><span class=nx>homepage</span><span class=p>)</span>
</span></span><span class=line><span class=cl>  <span class=p>.</span><span class=nx>get</span><span class=p>(</span><span class=s2>&#34;/api/forum-post/list&#34;</span><span class=p>,</span> <span class=nx>api</span><span class=p>.</span><span class=nx>getPosts</span><span class=p>)</span>
</span></span><span class=line><span class=cl>  <span class=p>.</span><span class=nx>post</span><span class=p>(</span><span class=s2>&#34;/api/forum-post/getById&#34;</span><span class=p>,</span> <span class=nx>api</span><span class=p>.</span><span class=nx>getPostById</span><span class=p>);</span>
</span></span></code></pre></div><h2 id=15-接收请求并处理>15. 接收请求并处理<a hidden class=anchor aria-hidden=true href=#15-接收请求并处理>#</a></h2><div class=highlight><pre tabindex=0 class=chroma><code class=language-js data-lang=js><span class=line><span class=cl><span class=kr>const</span> <span class=nx>forumPost</span> <span class=o>=</span> <span class=nx>require</span><span class=p>(</span><span class=s2>&#34;../models/forum-post&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=kr>const</span> <span class=nx>timeFormat</span> <span class=o>=</span> <span class=nx>require</span><span class=p>(</span><span class=s2>&#34;../utils/time-format&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nx>module</span><span class=p>.</span><span class=nx>exports</span> <span class=o>=</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=kr>async</span> <span class=nx>homepage</span><span class=p>(</span><span class=nx>ctx</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=p>(</span><span class=nx>ctx</span><span class=p>.</span><span class=nx>body</span> <span class=o>=</span> <span class=s2>&#34;server running&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=p>},</span>
</span></span><span class=line><span class=cl>  <span class=cm>/**
</span></span></span><span class=line><span class=cl><span class=cm>   * 分页查询列表
</span></span></span><span class=line><span class=cl><span class=cm>   * @param {*} ctx
</span></span></span><span class=line><span class=cl><span class=cm>   */</span>
</span></span><span class=line><span class=cl>  <span class=kr>async</span> <span class=nx>getPosts</span><span class=p>(</span><span class=nx>ctx</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=kr>const</span> <span class=nx>currentPage</span> <span class=o>=</span> <span class=nx>ctx</span><span class=p>.</span><span class=nx>request</span><span class=p>.</span><span class=nx>query</span><span class=p>.</span><span class=nx>currentPage</span> <span class=o>||</span> <span class=mi>1</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=kd>let</span> <span class=nx>pageSize</span> <span class=o>=</span> <span class=nx>ctx</span><span class=p>.</span><span class=nx>request</span><span class=p>.</span><span class=nx>query</span><span class=p>.</span><span class=nx>pageSize</span> <span class=o>||</span> <span class=mi>10</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=kr>const</span> <span class=nx>page</span> <span class=o>=</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=nx>currentPage</span><span class=o>:</span> <span class=nx>currentPage</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=nx>pageSize</span><span class=o>:</span> <span class=nx>pageSize</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=p>};</span>
</span></span><span class=line><span class=cl>    <span class=kd>let</span> <span class=nx>result</span> <span class=o>=</span> <span class=kr>await</span> <span class=nx>forumPost</span><span class=p>.</span><span class=nx>getPostList</span><span class=p>(</span><span class=nx>page</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=nx>result</span> <span class=o>=</span> <span class=nx>result</span><span class=p>.</span><span class=nx>map</span><span class=p>((</span><span class=nx>item</span><span class=p>)</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=nx>item</span><span class=p>.</span><span class=nx>create_time</span> <span class=o>=</span> <span class=nx>timeFormat</span><span class=p>(</span><span class=nx>item</span><span class=p>.</span><span class=nx>create_time</span><span class=p>);</span>
</span></span><span class=line><span class=cl>      <span class=k>return</span> <span class=nx>item</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=p>});</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=p>(</span><span class=nx>ctx</span><span class=p>.</span><span class=nx>body</span> <span class=o>=</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=nx>status</span><span class=o>:</span> <span class=mi>200</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=nx>data</span><span class=o>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nx>result</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=p>},</span>
</span></span><span class=line><span class=cl>    <span class=p>});</span>
</span></span><span class=line><span class=cl>  <span class=p>},</span>
</span></span><span class=line><span class=cl>  <span class=cm>/**
</span></span></span><span class=line><span class=cl><span class=cm>   * 根据ID查询
</span></span></span><span class=line><span class=cl><span class=cm>   * @param {*} ctx
</span></span></span><span class=line><span class=cl><span class=cm>   */</span>
</span></span><span class=line><span class=cl>  <span class=kr>async</span> <span class=nx>getPostById</span><span class=p>(</span><span class=nx>ctx</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=kr>const</span> <span class=nx>postId</span> <span class=o>=</span> <span class=nx>ctx</span><span class=p>.</span><span class=nx>request</span><span class=p>.</span><span class=nx>body</span><span class=p>.</span><span class=nx>postId</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=kd>let</span> <span class=nx>result</span> <span class=o>=</span> <span class=kr>await</span> <span class=nx>forumPost</span><span class=p>.</span><span class=nx>getPostById</span><span class=p>(</span><span class=nx>postId</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=p>(</span><span class=nx>ctx</span><span class=p>.</span><span class=nx>body</span> <span class=o>=</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=nx>status</span><span class=o>:</span> <span class=mi>200</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=nx>data</span><span class=o>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nx>result</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=p>},</span>
</span></span><span class=line><span class=cl>    <span class=p>});</span>
</span></span><span class=line><span class=cl>  <span class=p>},</span>
</span></span><span class=line><span class=cl><span class=p>};</span>
</span></span></code></pre></div><h2 id=16-操纵数据库做数据获取>16. 操纵数据库做数据获取<a hidden class=anchor aria-hidden=true href=#16-操纵数据库做数据获取>#</a></h2><div class=highlight><pre tabindex=0 class=chroma><code class=language-js data-lang=js><span class=line><span class=cl><span class=kr>const</span> <span class=nx>dbUtils</span> <span class=o>=</span> <span class=nx>require</span><span class=p>(</span><span class=s2>&#34;../utils/db-utils&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kr>const</span> <span class=nx>ForumPost</span> <span class=o>=</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=cm>/**
</span></span></span><span class=line><span class=cl><span class=cm>   * 分页查询文章列表
</span></span></span><span class=line><span class=cl><span class=cm>   * @param {*} page
</span></span></span><span class=line><span class=cl><span class=cm>   */</span>
</span></span><span class=line><span class=cl>  <span class=kr>async</span> <span class=nx>getPostList</span><span class=p>(</span><span class=nx>page</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=kr>const</span> <span class=nx>_sql</span> <span class=o>=</span> <span class=sb>`
</span></span></span><span class=line><span class=cl><span class=sb>      SELECT * FROM forum_post
</span></span></span><span class=line><span class=cl><span class=sb>      WHERE is_delete = 0 AND is_publish = 1
</span></span></span><span class=line><span class=cl><span class=sb>      ORDER BY forum_post.create_time DESC
</span></span></span><span class=line><span class=cl><span class=sb>      LIMIT </span><span class=si>${</span><span class=nx>page</span><span class=p>.</span><span class=nx>pageSize</span><span class=si>}</span><span class=sb> OFFSET </span><span class=si>${</span><span class=nx>page</span><span class=p>.</span><span class=nx>currentPage</span> <span class=o>-</span> <span class=mi>1</span><span class=si>}</span><span class=sb>`</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=kr>const</span> <span class=nx>result</span> <span class=o>=</span> <span class=kr>await</span> <span class=nx>dbUtils</span><span class=p>.</span><span class=nx>query</span><span class=p>(</span><span class=nx>_sql</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=nx>result</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=p>},</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=cm>/**
</span></span></span><span class=line><span class=cl><span class=cm>   * 获取指定文章
</span></span></span><span class=line><span class=cl><span class=cm>   * @param {string} id 文章id
</span></span></span><span class=line><span class=cl><span class=cm>   */</span>
</span></span><span class=line><span class=cl>  <span class=kr>async</span> <span class=nx>getPostById</span><span class=p>(</span><span class=nx>id</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=kr>const</span> <span class=nx>_sql</span> <span class=o>=</span> <span class=sb>`
</span></span></span><span class=line><span class=cl><span class=sb>      SELECT forum_post.*
</span></span></span><span class=line><span class=cl><span class=sb>      FROM forum_post
</span></span></span><span class=line><span class=cl><span class=sb>      WHERE forum_post.id = </span><span class=si>${</span><span class=nx>id</span><span class=si>}</span><span class=sb>`</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=kr>const</span> <span class=nx>result</span> <span class=o>=</span> <span class=kr>await</span> <span class=nx>dbUtils</span><span class=p>.</span><span class=nx>query</span><span class=p>(</span><span class=nx>_sql</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=p>(</span><span class=nx>result</span><span class=p>.</span><span class=nx>length</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=k>return</span> <span class=nx>result</span><span class=p>[</span><span class=mi>0</span><span class=p>];</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=kc>null</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=p>},</span>
</span></span><span class=line><span class=cl><span class=p>};</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nx>module</span><span class=p>.</span><span class=nx>exports</span> <span class=o>=</span> <span class=nx>ForumPost</span><span class=p>;</span>
</span></span></code></pre></div><h2 id=17-新建数据库>17. 新建数据库<a hidden class=anchor aria-hidden=true href=#17-新建数据库>#</a></h2><div class=highlight><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=cm>/** 建库 **/</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>CREATE</span><span class=w> </span><span class=k>DATABASE</span><span class=w> </span><span class=k>IF</span><span class=w> </span><span class=k>NOT</span><span class=w> </span><span class=k>EXISTS</span><span class=w> </span><span class=o>`</span><span class=n>codemonkeys</span><span class=o>-</span><span class=n>node</span><span class=o>`</span><span class=w> </span><span class=k>DEFAULT</span><span class=w> </span><span class=n>CHARSET</span><span class=w> </span><span class=n>utf8</span><span class=w> </span><span class=k>COLLATE</span><span class=w> </span><span class=n>utf8_general_ci</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=cm>/** 建帖子表 **/</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>CREATE</span><span class=w> </span><span class=k>TABLE</span><span class=w> </span><span class=k>IF</span><span class=w> </span><span class=k>NOT</span><span class=w> </span><span class=k>EXISTS</span><span class=w> </span><span class=o>`</span><span class=n>forum_post</span><span class=o>`</span><span class=p>(</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>   </span><span class=o>`</span><span class=n>id</span><span class=o>`</span><span class=w> </span><span class=nb>INT</span><span class=w> </span><span class=k>NOT</span><span class=w> </span><span class=k>NULL</span><span class=w> </span><span class=n>AUTO_INCREMENT</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>   </span><span class=o>`</span><span class=n>avatar</span><span class=o>`</span><span class=w> </span><span class=nb>VARCHAR</span><span class=p>(</span><span class=mi>100</span><span class=p>)</span><span class=w> </span><span class=k>NULL</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>   </span><span class=o>`</span><span class=n>title</span><span class=o>`</span><span class=w> </span><span class=nb>VARCHAR</span><span class=p>(</span><span class=mi>40</span><span class=p>)</span><span class=w> </span><span class=k>NOT</span><span class=w> </span><span class=k>NULL</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>   </span><span class=o>`</span><span class=n>author</span><span class=o>`</span><span class=w> </span><span class=nb>VARCHAR</span><span class=p>(</span><span class=mi>40</span><span class=p>)</span><span class=w> </span><span class=k>NOT</span><span class=w> </span><span class=k>NULL</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>   </span><span class=o>`</span><span class=nb>date</span><span class=o>`</span><span class=w> </span><span class=n>datetime</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>   </span><span class=o>`</span><span class=n>create_time</span><span class=o>`</span><span class=w> </span><span class=n>datetime</span><span class=w> </span><span class=k>DEFAULT</span><span class=w> </span><span class=k>CURRENT_TIMESTAMP</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>   </span><span class=o>`</span><span class=n>category</span><span class=o>`</span><span class=w> </span><span class=nb>VARCHAR</span><span class=p>(</span><span class=mi>40</span><span class=p>)</span><span class=w> </span><span class=k>NULL</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>   </span><span class=o>`</span><span class=n>content</span><span class=o>`</span><span class=w> </span><span class=nb>VARCHAR</span><span class=p>(</span><span class=mi>20000</span><span class=p>)</span><span class=w> </span><span class=k>NOT</span><span class=w> </span><span class=k>NULL</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>   </span><span class=o>`</span><span class=n>commentNum</span><span class=o>`</span><span class=w> </span><span class=nb>INT</span><span class=w> </span><span class=k>NULL</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>   </span><span class=o>`</span><span class=n>is_delete</span><span class=o>`</span><span class=w> </span><span class=nb>INT</span><span class=w> </span><span class=k>DEFAULT</span><span class=w> </span><span class=mi>0</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>   </span><span class=o>`</span><span class=n>is_publish</span><span class=o>`</span><span class=w> </span><span class=nb>INT</span><span class=w> </span><span class=k>DEFAULT</span><span class=w> </span><span class=mi>1</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>   </span><span class=k>PRIMARY</span><span class=w> </span><span class=k>KEY</span><span class=w> </span><span class=p>(</span><span class=w> </span><span class=o>`</span><span class=n>id</span><span class=o>`</span><span class=w> </span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>)</span><span class=n>ENGINE</span><span class=o>=</span><span class=n>InnoDB</span><span class=w> </span><span class=k>DEFAULT</span><span class=w> </span><span class=n>CHARSET</span><span class=o>=</span><span class=n>utf8</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=cm>/** 原始数据 **/</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>INSERT</span><span class=w> </span><span class=k>INTO</span><span class=w> </span><span class=n>forum_post</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>(</span><span class=n>avatar</span><span class=p>,</span><span class=w> </span><span class=n>title</span><span class=p>,</span><span class=w> </span><span class=n>author</span><span class=p>,</span><span class=w> </span><span class=nb>date</span><span class=p>,</span><span class=w> </span><span class=n>category</span><span class=p>,</span><span class=w> </span><span class=n>content</span><span class=p>,</span><span class=w> </span><span class=n>commentNum</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>VALUES</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>(</span><span class=s1>&#39;http://ourcia6f4.bkt.clouddn.com/avatar3.jpg&#39;</span><span class=p>,</span><span class=s1>&#39;基于Spring Cloud的微服务设计&#39;</span><span class=p>,</span><span class=s1>&#39;wangzhenzhong&#39;</span><span class=p>,</span><span class=s1>&#39;2018-08-27&#39;</span><span class=p>,</span><span class=s1>&#39;微服务&#39;</span><span class=p>,</span><span class=s1>&#39;微服务这个词大家应该都不陌生，是最近几年技术发展的热门词汇之一。在当前系统需求越来越复杂，实现和维护成本越来越高的背景下，微服务确实是未来的发展趋势之一。由于工作的需要，最近花了半个月左右的时间研究了基于Spring Cloud的微服务设计与实现，颇有收获，本文就来对这半个月的成果进行一个总结，并聊一聊在我对微服务的一些思考。&#39;</span><span class=p>,</span><span class=s1>&#39;64&#39;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>),</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>(</span><span class=s1>&#39;http://ourcia6f4.bkt.clouddn.com/avatar4.jpg&#39;</span><span class=p>,</span><span class=s1>&#39;再品Git, 深度解读&#39;</span><span class=p>,</span><span class=s1>&#39;Taikoo&#39;</span><span class=p>,</span><span class=s1>&#39;2018-08-23&#39;</span><span class=p>,</span><span class=s1>&#39;git&#39;</span><span class=p>,</span><span class=s1>&#39;和一个长期使用IDE(eclipse)集成git进行代码版本管理的人交流项目，博文内容将采用类似《大话设计模式》的对话体进行，场景真实，有代入感，正文部门前面是对方参照我写的readme搭建基于vue-cli的demo项目，安装node并通过npm安装项目依赖并本地启动项目等等，由于对方为后端Java开发，对新前端技术栈了解比较少，在搭建环境和启动项目过程中滋生一些趣事，比如使用npm启动项目后如何在浏览器访问项目，我为了让其醒目意识到我们的项目首页就是未经改动的Vue-cli首页，于是我将首页改动并推到远程master分支，后面便是我们的搞笑对话。&#39;</span><span class=p>,</span><span class=s1>&#39;60&#39;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>);</span><span class=w>
</span></span></span></code></pre></div><h2 id=18-后端接口服务-nginx-配置>18. 后端接口服务 nginx 配置<a hidden class=anchor aria-hidden=true href=#18-后端接口服务-nginx-配置>#</a></h2><div class=highlight><pre tabindex=0 class=chroma><code class=language-gdscript3 data-lang=gdscript3><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>server</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>     <span class=n>listen</span> <span class=mi>80</span><span class=p>;</span>
</span></span><span class=line><span class=cl>     <span class=n>server_name</span> <span class=n>xxx</span><span class=o>.</span><span class=n>com</span><span class=p>;</span>
</span></span><span class=line><span class=cl>     <span class=n>access_log</span> <span class=o>/</span><span class=k>var</span><span class=o>/</span><span class=nb>log</span><span class=o>/</span><span class=n>nginx</span><span class=o>/</span><span class=n>xxx</span><span class=o>.</span><span class=n>com</span><span class=o>-</span><span class=n>access</span><span class=o>.</span><span class=n>log</span><span class=p>;</span>
</span></span><span class=line><span class=cl>     <span class=n>error_log</span>  <span class=o>/</span><span class=k>var</span><span class=o>/</span><span class=nb>log</span><span class=o>/</span><span class=n>nginx</span><span class=o>/</span><span class=n>xxx</span><span class=o>.</span><span class=n>com</span><span class=o>-</span><span class=n>error</span><span class=o>.</span><span class=n>log</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>     <span class=n>location</span> <span class=o>/</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>             <span class=n>proxy_set_header</span> <span class=n>X</span><span class=o>-</span><span class=n>Real</span><span class=o>-</span><span class=ne>IP</span> <span class=o>$</span><span class=n>remote_addr</span><span class=p>;</span>
</span></span><span class=line><span class=cl>             <span class=n>proxy_set_header</span> <span class=n>X</span><span class=o>-</span><span class=n>Forwarded</span><span class=o>-</span><span class=n>For</span> <span class=o>$</span><span class=n>proxy_add_x_forwarded_for</span><span class=p>;</span>
</span></span><span class=line><span class=cl>             <span class=n>proxy_set_header</span> <span class=n>Host</span> <span class=o>$</span><span class=n>http_host</span><span class=p>;</span>
</span></span><span class=line><span class=cl>             <span class=n>proxy_set_header</span> <span class=n>X</span><span class=o>-</span><span class=n>NginX</span><span class=o>-</span><span class=n>Proxy</span> <span class=bp>true</span><span class=p>;</span>
</span></span><span class=line><span class=cl>             <span class=n>proxy_pass</span> <span class=n>http</span><span class=p>:</span><span class=o>//</span><span class=n>xx</span><span class=o>.</span><span class=n>xx</span><span class=o>.</span><span class=n>xx</span><span class=o>.</span><span class=n>xx</span><span class=p>:</span><span class=mi>3000</span><span class=o>/</span><span class=p>;</span>
</span></span><span class=line><span class=cl>             <span class=n>proxy_redirect</span> <span class=n>off</span><span class=p>;</span>
</span></span><span class=line><span class=cl>     <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><h2 id=19-发布后端服务到服务器指定目录>19. 发布后端服务到服务器指定目录<a hidden class=anchor aria-hidden=true href=#19-发布后端服务到服务器指定目录>#</a></h2><div class=highlight><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>npm run deploy_setup
</span></span></code></pre></div><blockquote><p>会在指定目录生成三个目录</p></blockquote><div class=highlight><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>npm run deploy
</span></span></code></pre></div><blockquote><p>会将后端项目部署到指定目录</p></blockquote><h2 id=20-启动后端项目在服务器后端运行>20. 启动后端项目在服务器后端运行<a hidden class=anchor aria-hidden=true href=#20-启动后端项目在服务器后端运行>#</a></h2><blockquote><p>进入服务器，在后端项目目录执行</p></blockquote><div class=highlight><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>npm run start
</span></span></code></pre></div><h2 id=21-完成>21. 完成<a hidden class=anchor aria-hidden=true href=#21-完成>#</a></h2><p>即可通过浏览器访问前端项目，调用后端接口返回数据进行显示</p></div><footer class=post-footer><ul class=post-tags><li><a href=https://barnett617.github.io/wilson-blog/tags/web/>Web</a></li></ul><nav class=paginav><a class=prev href=https://barnett617.github.io/wilson-blog/posts/2018-08-27-gitlab-use/><span class=title>« 上一页</span><br><span>服务器搭建Gitlab</span>
</a><a class=next href=https://barnett617.github.io/wilson-blog/posts/2018-08-27-install-zendao-on-ubuntu/><span class=title>下一页 »</span><br><span>在Ubuntu 16.04安装禅道</span></a></nav><script defer crossorigin=anonymous src=/wilson-blog/assets/js/qrcode.a817fc490b9066afefa35cf981f6f003a76441b45cc519492334607a8cbcb264.js integrity="sha256-qBf8SQuQZq/vo1z5gfbwA6dkQbRcxRlJIzRgeoy8smQ=" onload='const wechatShareBtnFingerprint=document.getElementById("wechat-share-btn");if(wechatShareBtnFingerprint){wechatShareBtnFingerprint.style.position="relative";const e=document.createElement("div");e.id="qrcode",Object.assign(e.style,{position:"absolute",background:"#fff",padding:"8px",bottom:0,"box-sizing":"content-box","box-shadow":"rgba(0, 0, 0, 0.2) 0px 0px 10px 4px",width:"96px",height:"96px",left:"50%",transform:"translate(-50%, -43%)",visibility:"hidden"}),window.wechatShareQrCode=e,wechatShareBtnFingerprint.appendChild(e),new QRCode(document.getElementById("qrcode"),{text:window.location.href,width:128,height:128,colorDark:"#000",colorLight:"#fff",correctLevel:QRCode.CorrectLevel.H})}'></script><div class=share-buttons><a id=wechat-share-btn target=_blank rel="noopener noreferrer" aria-label="share 一周时间使用Vue+Koa全栈开发论坛项目 on wechat" href=javascript:void(0) onclick=return!1 onfocus='const shareBtnsPointer=document.getElementsByClassName("share-buttons")[0];shareBtnsPointer&&(shareBtnsPointer.style.overflowX="initial"),wechatShareQrCode.style.visibility="visible"' onblur='wechatShareQrCode.style.visibility="hidden"'><svg role="img" viewBox="0 0 24 24" height="30" width="30" fill="currentcolor"><path d="M8.691 2.188C3.891 2.188.0 5.476.0 9.53c0 2.212 1.17 4.203 3.002 5.55a.59.59.0 01.213.665l-.39 1.48c-.019.07-.048.141-.048.213.0.163.13.295.29.295a.326.326.0 00.167-.054l1.903-1.114a.864.864.0 01.717-.098 10.16 10.16.0 002.837.403c.276.0.543-.027.811-.05-.857-2.578.157-4.972 1.932-6.446 1.703-1.415 3.882-1.98 5.853-1.838-.576-3.583-4.196-6.348-8.596-6.348zM5.785 5.991c.642.0 1.162.529 1.162 1.18A1.17 1.17.0 015.785 8.349 1.17 1.17.0 014.623 7.17c0-.651.52-1.18 1.162-1.18zm5.813.0c.642.0 1.162.529 1.162 1.18a1.17 1.17.0 01-1.162 1.178 1.17 1.17.0 01-1.162-1.178c0-.651.52-1.18 1.162-1.18zm5.34 2.867c-1.797-.052-3.746.512-5.28 1.786-1.72 1.428-2.687 3.72-1.78 6.22.942 2.453 3.666 4.229 6.884 4.229.826.0 1.622-.12 2.361-.336a.722.722.0 01.598.082l1.584.926a.272.272.0 00.14.047c.134.0.24-.111.24-.247.0-.06-.023-.12-.038-.177l-.327-1.233a.582.582.0 01-.023-.156.49.49.0 01.201-.398C23.024 18.48 24 16.82 24 14.98c0-3.21-2.931-5.837-6.656-6.088V8.89c-.135-.01-.27-.027-.407-.03zm-2.53 3.274c.535.0.969.44.969.982a.976.976.0 01-.969.983.976.976.0 01-.969-.983c0-.542.434-.982.97-.982zm4.844.0c.535.0.969.44.969.982a.976.976.0 01-.969.983.976.976.0 01-.969-.983c0-.542.434-.982.969-.982z"/></svg></a><a target=_blank rel="noopener noreferrer" aria-label="share 一周时间使用Vue+Koa全栈开发论坛项目 on x" href="https://x.com/intent/tweet/?text=%e4%b8%80%e5%91%a8%e6%97%b6%e9%97%b4%e4%bd%bf%e7%94%a8Vue%2bKoa%e5%85%a8%e6%a0%88%e5%bc%80%e5%8f%91%e8%ae%ba%e5%9d%9b%e9%a1%b9%e7%9b%ae&amp;url=https%3a%2f%2fbarnett617.github.io%2fwilson-blog%2fposts%2f2018-08-27-koa-vue-forum%2f&amp;hashtags=Web"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M512 62.554V449.446C512 483.97 483.97 512 449.446 512H62.554C28.03 512 0 483.97.0 449.446V62.554C0 28.03 28.029.0 62.554.0H449.446C483.971.0 512 28.03 512 62.554zM269.951 190.75 182.567 75.216H56L207.216 272.95 63.9 436.783h61.366L235.9 310.383l96.667 126.4H456L298.367 228.367l134-153.151H371.033zM127.633 110h36.468l219.38 290.065H349.5z"/></svg></a></div></footer></article></main><footer class=footer><span>&copy; 2023 <a href=https://barnett617.github.io/wilson-blog/>Wilson's Blog</a></span>
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
        <a href=https://github.com/adityatelange/hugo-PaperMod/ rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg></a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script><script>document.querySelectorAll("pre > code").forEach(e=>{const n=e.parentNode.parentNode,t=document.createElement("button");t.classList.add("copy-code"),t.innerHTML="复制";function s(){t.innerHTML="已复制！",setTimeout(()=>{t.innerHTML="复制"},2e3)}t.addEventListener("click",t=>{if("clipboard"in navigator){navigator.clipboard.writeText(e.textContent),s();return}const n=document.createRange();n.selectNodeContents(e);const o=window.getSelection();o.removeAllRanges(),o.addRange(n);try{document.execCommand("copy"),s()}catch{}o.removeRange(n)}),n.classList.contains("highlight")?n.appendChild(t):n.parentNode.firstChild==n||(e.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName=="TABLE"?e.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(t):e.parentNode.appendChild(t))})</script></body></html>