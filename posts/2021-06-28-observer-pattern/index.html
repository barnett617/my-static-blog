<!doctype html><html lang=zh dir=ltr><head><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>理解【观察者模式】和【发布订阅】的区别 | Wilson's Blog</title>
<meta name=keywords content="设计模式"><meta name=description content="一、定性区别 首先，观察者是经典软件设计模式中的一种，但发布订阅只是软件架构中的一种消息范式。所以不要再被“观察者模式和发布订阅模式xxx”这样的问题误导。
二、组成区别 其次，就是实现二者所需的角色数量有着明显的区别。观察者模式本身只需要2个角色便可成型，即观察者和被观察者，其中被观察者是重点。而发布订阅需要至少3个角色来组成，包括发布者、订阅者和发布订阅中心，其中发布订阅中心是重点。
观察者模式 发布订阅 2个角色 3个角色 重点是被观察者 重点是发布订阅中心 三、各自实现 1、观察者模式实现 观察者模式一般至少有一个可被观察的对象 Subject ，可以有多个观察者去观察这个对象。二者的关系是通过被观察者主动建立的，被观察者至少要有三个方法——添加观察者、移除观察者、通知观察者。
当被观察者将某个观察者添加到自己的观察者列表后，观察者与被观察者的关联就建立起来了。此后只要被观察者在某种时机触发通知观察者方法时，观察者即可接收到来自被观察者的消息。
上图重点表示出了被观察者通知观察者的动作，省略了观察者是如何被添加到被观察者的列表内以及接收到被观察者后是具体如何拿到通知消息的。接下来我们使用 JavaScript 来实现一版，以具体展示这部分细节。
1）被观察者对象 class Subject { constructor() { this.observerList = []; } addObserver(observer) { this.observerList.push(observer); } removeObserver(observer) { const index = this.observerList.findIndex(o => o.name === observer.name); this.observerList.splice(index, 1); } notifyObservers(message) { const observers = this.observerList; observers.forEach(observer => observer.notified(message)); } } 2）观察者 class Observer { constructor(name, subject) { this.name = name; if (subject) { subject."><meta name=author content><link rel=canonical href=https://barnett617.github.io/wilson-blog/posts/2021-06-28-observer-pattern/><meta name=google-site-verification content="XYZabc"><meta name=yandex-verification content="XYZabc"><meta name=msvalidate.01 content="XYZabc"><link crossorigin=anonymous href=/wilson-blog/assets/css/stylesheet.7822ca91becd3fe515c67241030e80de043ab22dea5278258d676181168c3c52.css integrity="sha256-eCLKkb7NP+UVxnJBAw6A3gQ6si3qUngljWdhgRaMPFI=" rel="preload stylesheet" as=style><link rel=icon href=https://barnett617.github.io/wilson-blog/favicon_io/favicon.ico><link rel=icon type=image/png sizes=16x16 href=https://barnett617.github.io/wilson-blog/favicon_io/favicon16x16.png><link rel=icon type=image/png sizes=32x32 href=https://barnett617.github.io/wilson-blog/favicon_io/favicon32x32.png><link rel=apple-touch-icon href=https://barnett617.github.io/wilson-blog/favicon_io/apple-touch-icon.png><link rel=mask-icon href=https://barnett617.github.io/wilson-blog/favicon_io/apple-touch-icon.png><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><link rel=alternate hreflang=zh href=https://barnett617.github.io/wilson-blog/posts/2021-06-28-observer-pattern/><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--hljs-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><meta property="og:title" content="理解【观察者模式】和【发布订阅】的区别"><meta property="og:description" content="一、定性区别 首先，观察者是经典软件设计模式中的一种，但发布订阅只是软件架构中的一种消息范式。所以不要再被“观察者模式和发布订阅模式xxx”这样的问题误导。
二、组成区别 其次，就是实现二者所需的角色数量有着明显的区别。观察者模式本身只需要2个角色便可成型，即观察者和被观察者，其中被观察者是重点。而发布订阅需要至少3个角色来组成，包括发布者、订阅者和发布订阅中心，其中发布订阅中心是重点。
观察者模式 发布订阅 2个角色 3个角色 重点是被观察者 重点是发布订阅中心 三、各自实现 1、观察者模式实现 观察者模式一般至少有一个可被观察的对象 Subject ，可以有多个观察者去观察这个对象。二者的关系是通过被观察者主动建立的，被观察者至少要有三个方法——添加观察者、移除观察者、通知观察者。
当被观察者将某个观察者添加到自己的观察者列表后，观察者与被观察者的关联就建立起来了。此后只要被观察者在某种时机触发通知观察者方法时，观察者即可接收到来自被观察者的消息。
上图重点表示出了被观察者通知观察者的动作，省略了观察者是如何被添加到被观察者的列表内以及接收到被观察者后是具体如何拿到通知消息的。接下来我们使用 JavaScript 来实现一版，以具体展示这部分细节。
1）被观察者对象 class Subject { constructor() { this.observerList = []; } addObserver(observer) { this.observerList.push(observer); } removeObserver(observer) { const index = this.observerList.findIndex(o => o.name === observer.name); this.observerList.splice(index, 1); } notifyObservers(message) { const observers = this.observerList; observers.forEach(observer => observer.notified(message)); } } 2）观察者 class Observer { constructor(name, subject) { this.name = name; if (subject) { subject."><meta property="og:type" content="article"><meta property="og:url" content="https://barnett617.github.io/wilson-blog/posts/2021-06-28-observer-pattern/"><meta property="article:section" content="posts"><meta property="article:published_time" content="2021-06-28T15:31:00+00:00"><meta property="article:modified_time" content="2021-06-28T15:31:00+00:00"><meta property="og:site_name" content="Wilson's Blog"><meta name=twitter:card content="summary"><meta name=twitter:title content="理解【观察者模式】和【发布订阅】的区别"><meta name=twitter:description content="一、定性区别 首先，观察者是经典软件设计模式中的一种，但发布订阅只是软件架构中的一种消息范式。所以不要再被“观察者模式和发布订阅模式xxx”这样的问题误导。
二、组成区别 其次，就是实现二者所需的角色数量有着明显的区别。观察者模式本身只需要2个角色便可成型，即观察者和被观察者，其中被观察者是重点。而发布订阅需要至少3个角色来组成，包括发布者、订阅者和发布订阅中心，其中发布订阅中心是重点。
观察者模式 发布订阅 2个角色 3个角色 重点是被观察者 重点是发布订阅中心 三、各自实现 1、观察者模式实现 观察者模式一般至少有一个可被观察的对象 Subject ，可以有多个观察者去观察这个对象。二者的关系是通过被观察者主动建立的，被观察者至少要有三个方法——添加观察者、移除观察者、通知观察者。
当被观察者将某个观察者添加到自己的观察者列表后，观察者与被观察者的关联就建立起来了。此后只要被观察者在某种时机触发通知观察者方法时，观察者即可接收到来自被观察者的消息。
上图重点表示出了被观察者通知观察者的动作，省略了观察者是如何被添加到被观察者的列表内以及接收到被观察者后是具体如何拿到通知消息的。接下来我们使用 JavaScript 来实现一版，以具体展示这部分细节。
1）被观察者对象 class Subject { constructor() { this.observerList = []; } addObserver(observer) { this.observerList.push(observer); } removeObserver(observer) { const index = this.observerList.findIndex(o => o.name === observer.name); this.observerList.splice(index, 1); } notifyObservers(message) { const observers = this.observerList; observers.forEach(observer => observer.notified(message)); } } 2）观察者 class Observer { constructor(name, subject) { this.name = name; if (subject) { subject."><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Posts","item":"https://barnett617.github.io/wilson-blog/posts/"},{"@type":"ListItem","position":2,"name":"理解【观察者模式】和【发布订阅】的区别","item":"https://barnett617.github.io/wilson-blog/posts/2021-06-28-observer-pattern/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"理解【观察者模式】和【发布订阅】的区别","name":"理解【观察者模式】和【发布订阅】的区别","description":"一、定性区别 首先，观察者是经典软件设计模式中的一种，但发布订阅只是软件架构中的一种消息范式。所以不要再被“观察者模式和发布订阅模式xxx”这样的问题误导。\n二、组成区别 其次，就是实现二者所需的角色数量有着明显的区别。观察者模式本身只需要2个角色便可成型，即观察者和被观察者，其中被观察者是重点。而发布订阅需要至少3个角色来组成，包括发布者、订阅者和发布订阅中心，其中发布订阅中心是重点。\n观察者模式 发布订阅 2个角色 3个角色 重点是被观察者 重点是发布订阅中心 三、各自实现 1、观察者模式实现 观察者模式一般至少有一个可被观察的对象 Subject ，可以有多个观察者去观察这个对象。二者的关系是通过被观察者主动建立的，被观察者至少要有三个方法——添加观察者、移除观察者、通知观察者。\n当被观察者将某个观察者添加到自己的观察者列表后，观察者与被观察者的关联就建立起来了。此后只要被观察者在某种时机触发通知观察者方法时，观察者即可接收到来自被观察者的消息。\n上图重点表示出了被观察者通知观察者的动作，省略了观察者是如何被添加到被观察者的列表内以及接收到被观察者后是具体如何拿到通知消息的。接下来我们使用 JavaScript 来实现一版，以具体展示这部分细节。\n1）被观察者对象 class Subject { constructor() { this.observerList = []; } addObserver(observer) { this.observerList.push(observer); } removeObserver(observer) { const index = this.observerList.findIndex(o =\u0026gt; o.name === observer.name); this.observerList.splice(index, 1); } notifyObservers(message) { const observers = this.observerList; observers.forEach(observer =\u0026gt; observer.notified(message)); } } 2）观察者 class Observer { constructor(name, subject) { this.name = name; if (subject) { subject.","keywords":["设计模式"],"articleBody":"一、定性区别 首先，观察者是经典软件设计模式中的一种，但发布订阅只是软件架构中的一种消息范式。所以不要再被“观察者模式和发布订阅模式xxx”这样的问题误导。\n二、组成区别 其次，就是实现二者所需的角色数量有着明显的区别。观察者模式本身只需要2个角色便可成型，即观察者和被观察者，其中被观察者是重点。而发布订阅需要至少3个角色来组成，包括发布者、订阅者和发布订阅中心，其中发布订阅中心是重点。\n观察者模式 发布订阅 2个角色 3个角色 重点是被观察者 重点是发布订阅中心 三、各自实现 1、观察者模式实现 观察者模式一般至少有一个可被观察的对象 Subject ，可以有多个观察者去观察这个对象。二者的关系是通过被观察者主动建立的，被观察者至少要有三个方法——添加观察者、移除观察者、通知观察者。\n当被观察者将某个观察者添加到自己的观察者列表后，观察者与被观察者的关联就建立起来了。此后只要被观察者在某种时机触发通知观察者方法时，观察者即可接收到来自被观察者的消息。\n上图重点表示出了被观察者通知观察者的动作，省略了观察者是如何被添加到被观察者的列表内以及接收到被观察者后是具体如何拿到通知消息的。接下来我们使用 JavaScript 来实现一版，以具体展示这部分细节。\n1）被观察者对象 class Subject { constructor() { this.observerList = []; } addObserver(observer) { this.observerList.push(observer); } removeObserver(observer) { const index = this.observerList.findIndex(o =\u003e o.name === observer.name); this.observerList.splice(index, 1); } notifyObservers(message) { const observers = this.observerList; observers.forEach(observer =\u003e observer.notified(message)); } } 2）观察者 class Observer { constructor(name, subject) { this.name = name; if (subject) { subject.addObserver(this); } } notified(message) { console.log(this.name, 'got message', message); } } 3）使用 const subject = new Subject(); const observerA = new Observer('observerA', subject); const observerB = new Observer('observerB'); subject.addObserver(observerB); subject.notifyObservers('Hello from subject'); subject.removeObserver(observerA); subject.notifyObservers('Hello again'); 完整代码见附录\n4）解析 上面的代码分别实现了观察者和被观察者的逻辑，其中二者的关联有两种方式：\n观察者主动申请加入被观察者的列表 被观察者主动将观察者加入列表 前者会在观察者对象创建之初显式声明要被加入到被观察者的通知列表内，后者则是在观察者创建实例后由被观察者主动将其添加进列表。\n2、发布订阅 与观察者模式相比，发布订阅核心基于一个中心来建立整个体系。其中发布者和订阅者不直接进行通信，而是发布者将要发布的消息交由中心管理，订阅者也是根据自己的情况，按需订阅中心中的消息。\n让我们来想象一下邮件系统，你可以作为订阅者订阅某个网站的通知，邮件系统在其中充当发布订阅中心的角色，而发布者则是你订阅的网站。\n整个链路是从你的订阅开始，虽然在你订阅之前，别人可能已经订阅过某些网站并不断接收来自网站更新所发出的消息。你的订阅动作是在某个你想订阅的网站填入自己的邮箱，如果这一步以邮件系统为中心，那么则是在的邮箱内记录这个网站信息，后续当网站有内容更新时，邮件系统会及时接收到并向你发送邮件，以达到通知你这个订阅者的目的。\n1）降级为观察者模式 这里说的是以邮件系统为中心，假如以网站为中心，那么你对于网站就相当于一个观察者，你希望观察网站的一举一动，即网站内容的更新。那么订阅动作本身便成了你让网站将你的邮箱加入网站维护的观察者列表。这样当网站有内容更新后，便会通知所有观察者，也就是订阅者，这时发布订阅模型则退化成了观察者模式。\n2）升级为发布订阅 可以看出，此时网站和用户间其实是有耦合的，也就是网站除了要维护自身功能外，还需要维护订阅者列表，并且在内容更新后完成通知工作。这样在用户和网站之间有一部分关系是维护在网站内部的。如果网站想把这部分任务抽离出来，自然便恢复至发布订阅模型，即建立单独的消息中心来管理发布者和订阅者之间的关系以及接收变化和通知消息的工作。\n经过这样的对比，我们可以知道为什么要区分观察者模式和发布订阅，以及它们之间的差别。\n3）与观察者模式的关联 但是发布订阅真的和观察者模式是割裂开来的吗？并不是\n其实发布订阅的实现内部利用了观察者模式，让我们回顾一下观察者模式的核心，观察者模式由观察者和被观察者组成，其中被观察者是重点。二者的关联可以是在创建被观察者后，调用其添加观察者方法主动建立和某个观察者的关系，或是在创建观察者时即声明要观察的对象，即被观察者。其中观察者和被观察者一般为一对多关系，即一个被观察者可以被多个观察者观察。\n那么分析发布订阅模型即可发现，其中订阅者和发布订阅中心的关系类似观察者和被观察者的关系。注意只是类似，因为虽然其中订阅者和观察者都是消费的一方，期待能够即时接收到其他方的变化。\n但区别在于观察者模式中的被观察者需要在每次自身改变后都绑定式地触发对观察者的通知，因为这是观察者模式这一模式所要实现的核心，也就是类似事件处理系统的机制，被观察者有义务针对自身的变化给出响应式的反馈到观察者们，这就是为什么说观察者模式是松耦合的，因为被观察者的功能不纯粹，要包含一部分观察者和自身关系的逻辑。\n而发布订阅与之的区别在于，因为发布者把消息通知的权限交由发布订阅中心管理，发布者只需关心自身的发布逻辑，而不会直接和其所发布内容的订阅者直接通信。订阅者也如此，其只关心向发布订阅中心注册自己想要接收通知的栏目，并实现自己在接收到通知后的逻辑，而无需关心消息来自何方，发布者是谁。因此发布者和订阅者由于发布订阅中心的出现而完全解耦。\n由于发布订阅中心这一中间层的出现，对于生产方和消费方的通信管理变得更加的可管理和可拓展。比如这样同样可以实现通过观察者模式实现的事件机制，即消息中心在接收到新的消息发布后即时通知到该类目下的所有订阅者，只不过此时的发布者与消息中心的关系为一对一，并且消息中心与订阅者为一对多，消息中心只相当于发布者的一层代理。\n4）发布订阅实现 发布订阅中心 class PubSub { constructor() { this.messages = {}; this.listeners = {}; } publish(type, content) { const existContent = this.messages[type]; if (!existContent) { this.messages[type] = []; } this.messages[type].push(content); } subscribe(type, cb) { const existListener = this.listeners[type]; if (!existListener) { this.listeners[type] = []; } this.listeners[type].push(cb); } notify(type) { const messages = this.messages[type]; const subscribers = this.listeners[type] || []; subscribers.forEach((cb) =\u003e cb(messages)); } } 发布者 class Publisher { constructor(name, context) { this.name = name; this.context = context; } publish(type, content) { this.context.publish(type, content); } } 订阅者 class Subscriber { constructor(name, context) { this.name = name; this.context = context; } subscribe(type, cb) { this.context.subscribe(type, cb); } } 5）使用 const TYPE_A = 'music'; const TYPE_B = 'movie'; const TYPE_C = 'novel'; const pubsub = new PubSub(); const publisherA = new Publisher('publisherA', pubsub); publisherA.publish(TYPE_A, 'we are young'); publisherA.publish(TYPE_B, 'the silicon valley'); const publisherB = new Publisher('publisherB', pubsub); publisherB.publish(TYPE_A, 'stronger'); const publisherC = new Publisher('publisherC', pubsub); publisherC.publish(TYPE_B, 'imitation game'); const subscriberA = new Subscriber('subscriberA', pubsub); subscriberA.subscribe(TYPE_A, (res) =\u003e { console.log('subscriberA received', res); }); const subscriberB = new Subscriber('subscriberB', pubsub); subscriberB.subscribe(TYPE_C, (res) =\u003e { console.log('subscriberB received', res); }); const subscriberC = new Subscriber('subscriberC', pubsub); subscriberC.subscribe(TYPE_B, (res) =\u003e { console.log('subscriberC received', res); }); pubsub.notify(TYPE_A); pubsub.notify(TYPE_B); pubsub.notify(TYPE_C); 完整代码见附录\n6）解析 以上发布订阅中心、发布者和订阅者三者有各自的实现，其中发布者和订阅者实现比较简单，只需完成各自发布、订阅的任务即可。其中订阅者可以在接收到消息后做后续处理。重点在于二者需要确保在与同一个发布订阅中心进行关联，否则两者之间的通信无从关联。\n发布者的发布动作和订阅者的订阅动作相互独立，无需关注对方，消息派发由发布订阅中心负责。\n四、实际应用 在实际应用中，对于以上二者的实现可能会更加的复杂，同时也会根据各自的场景进行变形，所以大可不必拘泥于二者的标准实现。因为不论是设计模式还是技术模型大多都只是前人根据经验总结而成的编程思想，知道它们可能会对某些复杂问题的解决有启发性的帮助，进而借助这类思想巧妙地解决特定场景的问题。\n至于具体应用实例我能想到的有如下实践，欢迎补充。\nNode.js中自带的EventEmiter模块 Vue.js中数据响应式的实现 其他比如你在代码中发现有watch、watcher、observe、observer、listen、listener、dispatch、trigger、emit、on、event、eventbus、EventEmitter这类单词出现的地方，很有可能是在使用观察者模式或发布订阅的思想。等下次你发现有这些词的时候，不妨点进它的源码实现看看其他coder在实现观察者模式或发布订阅时有哪些巧妙的细节。\n五、声明 本文为个人学习观察者模式和发布订阅过程时的理解整理，如有错误请及时指出。同时本文内容为原创内容，如需转载请注明出处。\n六、参考资料 维基百科-设计模式 维基百科-观察者模式 维基百科-发布订阅 附录 observer-model.js\nclass Subject { constructor() { this.observerList = []; } addObserver(observer) { this.observerList.push(observer); } removeObserver(observer) { const index = this.observerList.findIndex(o =\u003e o.name === observer.name); this.observerList.splice(index, 1); } notifyObservers(message) { const observers = this.observerList; observers.forEach(observer =\u003e observer.notified(message)); } } class Observer { constructor(name, subject) { this.name = name; if (subject) { subject.addObserver(this); } } notified(message) { console.log(this.name, 'got message', message); } } function main() { const subject = new Subject(); const observerA = new Observer('observerA', subject); const observerB = new Observer('observerB', subject); subject.notifyObservers(`Hello from subject at ${new Date()}`); console.log('------------------------') setTimeout(() =\u003e { const observerC = new Observer('observerC'); const observerD = new Observer('observerD'); subject.addObserver(observerC); subject.addObserver(observerD); subject.notifyObservers(`Hello from subject at ${new Date()}`); console.log('------------------------') }, 1000) setTimeout(() =\u003e { subject.removeObserver(observerA); subject.notifyObservers(`Hello from subject at ${new Date()}`); console.log('------------------------') }, 2000) } main(); // observerA got message Hello from subject at Fri Jun 25 2021 16:25:09 GMT+0800 (GMT+08:00) // observerB got message Hello from subject at Fri Jun 25 2021 16:25:09 GMT+0800 (GMT+08:00) // ------------------------ // observerA got message Hello from subject at Fri Jun 25 2021 16:25:10 GMT+0800 (GMT+08:00) // observerB got message Hello from subject at Fri Jun 25 2021 16:25:10 GMT+0800 (GMT+08:00) // observerC got message Hello from subject at Fri Jun 25 2021 16:25:10 GMT+0800 (GMT+08:00) // observerD got message Hello from subject at Fri Jun 25 2021 16:25:10 GMT+0800 (GMT+08:00) // ------------------------ // observerB got message Hello from subject at Fri Jun 25 2021 16:25:11 GMT+0800 (GMT+08:00) // observerC got message Hello from subject at Fri Jun 25 2021 16:25:11 GMT+0800 (GMT+08:00) // observerD got message Hello from subject at Fri Jun 25 2021 16:25:11 GMT+0800 (GMT+08:00) // ------------------------ pub-sub.js\nclass PubSub { constructor() { this.messages = {}; this.listeners = {}; } publish(type, content) { const existContent = this.messages[type]; if (!existContent) { this.messages[type] = []; } this.messages[type].push(content); } subscribe(type, cb) { const existListener = this.listeners[type]; if (!existListener) { this.listeners[type] = []; } this.listeners[type].push(cb); } notify(type) { const messages = this.messages[type]; const subscribers = this.listeners[type] || []; subscribers.forEach((cb) =\u003e cb(messages)); } } class Publisher { constructor(name, context) { this.name = name; this.context = context; } publish(type, content) { this.context.publish(type, content); } } class Subscriber { constructor(name, context) { this.name = name; this.context = context; } subscribe(type, cb) { this.context.subscribe(type, cb); } } function main() { const TYPE_A = 'music'; const TYPE_B = 'movie'; const TYPE_C = 'novel'; const pubsub = new PubSub(); const publisherA = new Publisher('publisherA', pubsub); publisherA.publish(TYPE_A, 'we are young'); publisherA.publish(TYPE_B, 'the silicon valley'); const publisherB = new Publisher('publisherB', pubsub); publisherB.publish(TYPE_A, 'stronger'); const publisherC = new Publisher('publisherC', pubsub); publisherC.publish(TYPE_B, 'imitation game'); const subscriberA = new Subscriber('subscriberA', pubsub); subscriberA.subscribe(TYPE_A, (res) =\u003e { console.log('subscriberA received', res); }); const subscriberB = new Subscriber('subscriberB', pubsub); subscriberB.subscribe(TYPE_C, (res) =\u003e { console.log('subscriberB received', res); }); const subscriberC = new Subscriber('subscriberC', pubsub); subscriberC.subscribe(TYPE_B, (res) =\u003e { console.log('subscriberC received', res); }); pubsub.notify(TYPE_A); pubsub.notify(TYPE_B); pubsub.notify(TYPE_C); } main(); // subscriberA received [ 'we are young', 'stronger' ] // subscriberC received [ 'the silicon valley', 'imitation game' ] // subscriberB received undefined 本文原发布于 掘金\n","wordCount":"836","inLanguage":"zh","datePublished":"2021-06-28T15:31:00Z","dateModified":"2021-06-28T15:31:00Z","mainEntityOfPage":{"@type":"WebPage","@id":"https://barnett617.github.io/wilson-blog/posts/2021-06-28-observer-pattern/"},"publisher":{"@type":"Organization","name":"Wilson's Blog","logo":{"@type":"ImageObject","url":"https://barnett617.github.io/wilson-blog/favicon_io/favicon.ico"}}}</script></head><body id=top><script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add("dark"):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove("dark"):window.matchMedia("(prefers-color-scheme: dark)").matches&&document.body.classList.add("dark")</script><header class=header><nav class=nav><div class=logo><a href=https://barnett617.github.io/wilson-blog/ accesskey=h title="Wilson's Blog (Alt + H)"><img src=https://barnett617.github.io/wilson-blog/favicon_io/apple-touch-icon.png alt aria-label=logo height=35>Wilson's Blog</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button><ul class=lang-switch><li>|</li><li><a href=https://barnett617.github.io/wilson-blog/en/ title=English aria-label=English>En</a></li></ul></div></div><ul id=menu><li><a href=https://barnett617.github.io/wilson-blog/archives title=时间线><span>时间线</span></a></li><li><a href=https://barnett617.github.io/wilson-blog/search/ title=搜索><span>搜索</span></a></li><li><a href=https://barnett617.github.io/wilson-blog/tags/ title=标签分类><span>标签分类</span></a></li><li><a href=https://barnett617.github.io/wilson-blog/about/ title=关于我><span>关于我</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><h1 class="post-title entry-hint-parent">理解【观察者模式】和【发布订阅】的区别</h1><div class=post-meta><span title='2021-06-28 15:31:00 +0000 UTC'>2021-06-28 15:31:00</span>&nbsp;·&nbsp;4 分钟&nbsp;·&nbsp;836 字&nbsp;|&nbsp;<a href=https://github.com/barnett617/wilson-blog/tree/main/content//posts/2021-06-28-observer-pattern/index.md rel="noopener noreferrer" target=_blank>修改建议</a></div></header><div class=toc><details><summary accesskey=c title="(Alt + C)"><span class=details>目录</span></summary><div class=inner><nav id=TableOfContents><ul><li><a href=#一定性区别>一、定性区别</a></li><li><a href=#二组成区别>二、组成区别</a></li><li><a href=#三各自实现>三、各自实现</a><ul><li><a href=#1观察者模式实现>1、观察者模式实现</a></li><li><a href=#2发布订阅>2、发布订阅</a></li></ul></li><li><a href=#四实际应用>四、实际应用</a></li><li><a href=#五声明>五、声明</a></li><li><a href=#六参考资料>六、参考资料</a></li><li><a href=#附录>附录</a></li></ul></nav></div></details></div><div class=post-content><h2 id=一定性区别>一、定性区别<a hidden class=anchor aria-hidden=true href=#一定性区别>#</a></h2><p>首先，观察者是经典软件<code>设计模式</code>中的一种，但发布订阅只是软件架构中的一种<code>消息范式</code>。所以不要再被“观察者模式和发布订阅模式xxx”这样的问题误导。</p><h2 id=二组成区别>二、组成区别<a hidden class=anchor aria-hidden=true href=#二组成区别>#</a></h2><p>其次，就是实现二者所需的角色数量有着明显的区别。观察者模式本身只需要<code>2个</code>角色便可成型，即<code>观察者</code>和<code>被观察者</code>，其中<code>被观察者</code>是重点。而发布订阅需要至少<code>3个</code>角色来组成，包括<code>发布者</code>、<code>订阅者</code>和<code>发布订阅中心</code>，其中<code>发布订阅中心</code>是重点。</p><table><thead><tr><th style=text-align:center>观察者模式</th><th style=text-align:center>发布订阅</th></tr></thead><tbody><tr><td style=text-align:center>2个角色</td><td style=text-align:center>3个角色</td></tr><tr><td style=text-align:center>重点是被观察者</td><td style=text-align:center>重点是发布订阅中心</td></tr></tbody></table><h2 id=三各自实现>三、各自实现<a hidden class=anchor aria-hidden=true href=#三各自实现>#</a></h2><h3 id=1观察者模式实现>1、观察者模式实现<a hidden class=anchor aria-hidden=true href=#1观察者模式实现>#</a></h3><p>观察者模式一般至少有一个可被观察的对象 Subject ，可以有多个<code>观察者</code>去观察这个对象。二者的关系是通过<code>被观察者主动</code>建立的，<code>被观察者</code>至少要有三个方法——添加观察者、移除观察者、通知观察者。</p><p>当被观察者将某个观察者添加到自己的<code>观察者列表</code>后，观察者与被观察者的关联就建立起来了。此后只要被观察者在某种时机触发<code>通知观察者</code>方法时，观察者即可接收到来自被观察者的消息。</p><p><img loading=lazy src=567e4179118647d59f000763a3bc5046~tplv-k3u1fbpfcp-watermark.png alt=观察者.jpg></p><p>上图重点表示出了<code>被观察者</code>通知<code>观察者</code>的动作，省略了<code>观察者</code>是如何被添加到<code>被观察者</code>的列表内以及接收到被观察者后是具体如何拿到通知消息的。接下来我们使用 JavaScript 来实现一版，以具体展示这部分细节。</p><h4 id=1被观察者对象>1）被观察者对象<a hidden class=anchor aria-hidden=true href=#1被观察者对象>#</a></h4><div class=highlight><pre tabindex=0 class=chroma><code class=language-js data-lang=js><span class=line><span class=cl><span class=kr>class</span> <span class=nx>Subject</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=nx>constructor</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>this</span><span class=p>.</span><span class=nx>observerList</span> <span class=o>=</span> <span class=p>[];</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=nx>addObserver</span><span class=p>(</span><span class=nx>observer</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>this</span><span class=p>.</span><span class=nx>observerList</span><span class=p>.</span><span class=nx>push</span><span class=p>(</span><span class=nx>observer</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=nx>removeObserver</span><span class=p>(</span><span class=nx>observer</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=kr>const</span> <span class=nx>index</span> <span class=o>=</span> <span class=k>this</span><span class=p>.</span><span class=nx>observerList</span><span class=p>.</span><span class=nx>findIndex</span><span class=p>(</span><span class=nx>o</span> <span class=p>=&gt;</span> <span class=nx>o</span><span class=p>.</span><span class=nx>name</span> <span class=o>===</span> <span class=nx>observer</span><span class=p>.</span><span class=nx>name</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=k>this</span><span class=p>.</span><span class=nx>observerList</span><span class=p>.</span><span class=nx>splice</span><span class=p>(</span><span class=nx>index</span><span class=p>,</span> <span class=mi>1</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=nx>notifyObservers</span><span class=p>(</span><span class=nx>message</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=kr>const</span> <span class=nx>observers</span> <span class=o>=</span> <span class=k>this</span><span class=p>.</span><span class=nx>observerList</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=nx>observers</span><span class=p>.</span><span class=nx>forEach</span><span class=p>(</span><span class=nx>observer</span> <span class=p>=&gt;</span> <span class=nx>observer</span><span class=p>.</span><span class=nx>notified</span><span class=p>(</span><span class=nx>message</span><span class=p>));</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><h4 id=2观察者>2）观察者<a hidden class=anchor aria-hidden=true href=#2观察者>#</a></h4><div class=highlight><pre tabindex=0 class=chroma><code class=language-js data-lang=js><span class=line><span class=cl><span class=kr>class</span> <span class=nx>Observer</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=nx>constructor</span><span class=p>(</span><span class=nx>name</span><span class=p>,</span> <span class=nx>subject</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>this</span><span class=p>.</span><span class=nx>name</span> <span class=o>=</span> <span class=nx>name</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=p>(</span><span class=nx>subject</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=nx>subject</span><span class=p>.</span><span class=nx>addObserver</span><span class=p>(</span><span class=k>this</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=nx>notified</span><span class=p>(</span><span class=nx>message</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=k>this</span><span class=p>.</span><span class=nx>name</span><span class=p>,</span> <span class=s1>&#39;got message&#39;</span><span class=p>,</span> <span class=nx>message</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><h4 id=3使用>3）使用<a hidden class=anchor aria-hidden=true href=#3使用>#</a></h4><div class=highlight><pre tabindex=0 class=chroma><code class=language-js data-lang=js><span class=line><span class=cl><span class=kr>const</span> <span class=nx>subject</span> <span class=o>=</span> <span class=k>new</span> <span class=nx>Subject</span><span class=p>();</span>
</span></span><span class=line><span class=cl><span class=kr>const</span> <span class=nx>observerA</span> <span class=o>=</span> <span class=k>new</span> <span class=nx>Observer</span><span class=p>(</span><span class=s1>&#39;observerA&#39;</span><span class=p>,</span> <span class=nx>subject</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=kr>const</span> <span class=nx>observerB</span> <span class=o>=</span> <span class=k>new</span> <span class=nx>Observer</span><span class=p>(</span><span class=s1>&#39;observerB&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=nx>subject</span><span class=p>.</span><span class=nx>addObserver</span><span class=p>(</span><span class=nx>observerB</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=nx>subject</span><span class=p>.</span><span class=nx>notifyObservers</span><span class=p>(</span><span class=s1>&#39;Hello from subject&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=nx>subject</span><span class=p>.</span><span class=nx>removeObserver</span><span class=p>(</span><span class=nx>observerA</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=nx>subject</span><span class=p>.</span><span class=nx>notifyObservers</span><span class=p>(</span><span class=s1>&#39;Hello again&#39;</span><span class=p>);</span>
</span></span></code></pre></div><blockquote><p>完整代码见附录</p></blockquote><h4 id=4解析>4）解析<a hidden class=anchor aria-hidden=true href=#4解析>#</a></h4><p>上面的代码分别实现了观察者和被观察者的逻辑，其中二者的关联有两种方式：</p><ol><li>观察者主动申请加入被观察者的列表</li><li>被观察者主动将观察者加入列表</li></ol><p>前者会在观察者对象创建之初显式声明要被加入到被观察者的<code>通知列表</code>内，后者则是在观察者创建实例后由被观察者主动将其添加进列表。</p><h3 id=2发布订阅>2、发布订阅<a hidden class=anchor aria-hidden=true href=#2发布订阅>#</a></h3><p>与<code>观察者模式</code>相比，发布订阅核心基于一个中心来建立整个体系。其中<code>发布者</code>和<code>订阅者</code>不直接进行通信，而是发布者将要发布的消息交由中心管理，订阅者也是根据自己的情况，按需订阅中心中的消息。</p><p><img loading=lazy src=19b670df6cb54c4ebdc17a114b5dc97c~tplv-k3u1fbpfcp-watermark.png alt=发布订阅.jpg></p><p>让我们来想象一下<code>邮件系统</code>，你可以作为<code>订阅者</code>订阅某个网站的通知，邮件系统在其中充当发布订阅中心的角色，而<code>发布者</code>则是你订阅的网站。</p><p>整个链路是从你的<code>订阅</code>开始，虽然在你订阅之前，别人可能已经订阅过某些网站并不断接收来自网站更新所发出的消息。你的订阅动作是在某个你想订阅的网站填入自己的邮箱，如果这一步以邮件系统为中心，那么则是在的邮箱内记录这个网站信息，后续当网站有内容更新时，邮件系统会及时接收到并向你发送邮件，以达到通知你这个订阅者的目的。</p><h4 id=1降级为观察者模式>1）降级为观察者模式<a hidden class=anchor aria-hidden=true href=#1降级为观察者模式>#</a></h4><p>这里说的是以邮件系统为中心，假如以网站为中心，那么你对于网站就相当于一个<code>观察者</code>，你希望<code>观察</code>网站的一举一动，即网站内容的更新。那么订阅动作本身便成了你让网站将你的邮箱加入网站维护的<code>观察者列表</code>。这样当网站有内容更新后，便会通知所有观察者，也就是订阅者，这时发布订阅模型则退化成了观察者模式。</p><h4 id=2升级为发布订阅>2）升级为发布订阅<a hidden class=anchor aria-hidden=true href=#2升级为发布订阅>#</a></h4><p>可以看出，此时网站和用户间其实是有<code>耦合</code>的，也就是网站除了要维护自身功能外，还需要维护订阅者列表，并且在内容更新后完成通知工作。这样在用户和网站之间有一部分关系是维护在网站内部的。如果网站想把这部分任务抽离出来，自然便恢复至发布订阅模型，即建立单独的<code>消息中心</code>来管理发布者和订阅者之间的关系以及接收变化和通知消息的工作。</p><blockquote><p>经过这样的对比，我们可以知道为什么要区分观察者模式和发布订阅，以及它们之间的差别。</p></blockquote><h4 id=3与观察者模式的关联>3）与观察者模式的关联<a hidden class=anchor aria-hidden=true href=#3与观察者模式的关联>#</a></h4><p>但是发布订阅真的和观察者模式是割裂开来的吗？并不是</p><p>其实发布订阅的实现内部利用了<code>观察者模式</code>，让我们回顾一下观察者模式的核心，观察者模式由观察者和被观察者组成，其中被观察者是重点。二者的关联可以是在创建<code>被观察者</code>后，调用其<code>添加观察者</code>方法主动建立和某个<code>观察者</code>的关系，或是在创建<code>观察者</code>时即声明要观察的对象，即<code>被观察者</code>。其中观察者和被观察者一般为一对多关系，即一个被观察者可以被多个观察者观察。</p><p>那么分析发布订阅模型即可发现，其中<code>订阅者</code>和<code>发布订阅中心</code>的关系类似<code>观察者</code>和<code>被观察者</code>的关系。注意只是<code>类似</code>，因为虽然其中<code>订阅者</code>和<code>观察者</code>都是消费的一方，期待能够即时接收到其他方的变化。</p><p>但区别在于<code>观察者模式</code>中的<code>被观察者</code>需要在每次自身改变后都绑定式地触发对<code>观察者</code>的通知，因为这是<code>观察者模式</code>这一模式所要实现的核心，也就是类似事件处理系统的机制，被观察者有义务针对自身的变化给出响应式的反馈到观察者们，这就是为什么说<code>观察者模式</code>是松耦合的，因为<code>被观察者</code>的功能不纯粹，要包含一部分<code>观察者</code>和自身关系的逻辑。</p><p>而<code>发布订阅</code>与之的区别在于，因为<code>发布者</code>把消息通知的权限交由<code>发布订阅中心</code>管理，<code>发布者</code>只需关心自身的<code>发布</code>逻辑，而不会直接和其所发布内容的<code>订阅者</code>直接通信。<code>订阅者</code>也如此，其只关心向<code>发布订阅中心</code>注册自己想要接收通知的栏目，并实现自己在接收到通知后的逻辑，而无需关心消息来自何方，发布者是谁。因此<code>发布者</code>和<code>订阅者</code>由于<code>发布订阅中心</code>的出现而完全解耦。</p><p>由于<code>发布订阅中心</code>这一中间层的出现，对于生产方和消费方的通信管理变得更加的可管理和可拓展。比如这样同样可以实现通过观察者模式实现的事件机制，即消息中心在接收到新的消息发布后即时通知到该类目下的所有订阅者，只不过此时的<code>发布者</code>与<code>消息中心</code>的关系为<code>一对一</code>，并且<code>消息中心</code>与<code>订阅者</code>为<code>一对多</code>，消息中心只相当于发布者的一层代理。</p><p><img loading=lazy src=74f06fb7a35143b798b010b0481d853f~tplv-k3u1fbpfcp-watermark.png alt=发布订阅模拟观察者模式.jpg></p><h4 id=4发布订阅实现>4）发布订阅实现<a hidden class=anchor aria-hidden=true href=#4发布订阅实现>#</a></h4><h5 id=发布订阅中心>发布订阅中心<a hidden class=anchor aria-hidden=true href=#发布订阅中心>#</a></h5><div class=highlight><pre tabindex=0 class=chroma><code class=language-js data-lang=js><span class=line><span class=cl><span class=kr>class</span> <span class=nx>PubSub</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nx>constructor</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>this</span><span class=p>.</span><span class=nx>messages</span> <span class=o>=</span> <span class=p>{};</span>
</span></span><span class=line><span class=cl>    <span class=k>this</span><span class=p>.</span><span class=nx>listeners</span> <span class=o>=</span> <span class=p>{};</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=nx>publish</span><span class=p>(</span><span class=nx>type</span><span class=p>,</span> <span class=nx>content</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=kr>const</span> <span class=nx>existContent</span> <span class=o>=</span> <span class=k>this</span><span class=p>.</span><span class=nx>messages</span><span class=p>[</span><span class=nx>type</span><span class=p>];</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=p>(</span><span class=o>!</span><span class=nx>existContent</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=k>this</span><span class=p>.</span><span class=nx>messages</span><span class=p>[</span><span class=nx>type</span><span class=p>]</span> <span class=o>=</span> <span class=p>[];</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=k>this</span><span class=p>.</span><span class=nx>messages</span><span class=p>[</span><span class=nx>type</span><span class=p>].</span><span class=nx>push</span><span class=p>(</span><span class=nx>content</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=nx>subscribe</span><span class=p>(</span><span class=nx>type</span><span class=p>,</span> <span class=nx>cb</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=kr>const</span> <span class=nx>existListener</span> <span class=o>=</span> <span class=k>this</span><span class=p>.</span><span class=nx>listeners</span><span class=p>[</span><span class=nx>type</span><span class=p>];</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=p>(</span><span class=o>!</span><span class=nx>existListener</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=k>this</span><span class=p>.</span><span class=nx>listeners</span><span class=p>[</span><span class=nx>type</span><span class=p>]</span> <span class=o>=</span> <span class=p>[];</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=k>this</span><span class=p>.</span><span class=nx>listeners</span><span class=p>[</span><span class=nx>type</span><span class=p>].</span><span class=nx>push</span><span class=p>(</span><span class=nx>cb</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=nx>notify</span><span class=p>(</span><span class=nx>type</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=kr>const</span> <span class=nx>messages</span> <span class=o>=</span> <span class=k>this</span><span class=p>.</span><span class=nx>messages</span><span class=p>[</span><span class=nx>type</span><span class=p>];</span>
</span></span><span class=line><span class=cl>    <span class=kr>const</span> <span class=nx>subscribers</span> <span class=o>=</span> <span class=k>this</span><span class=p>.</span><span class=nx>listeners</span><span class=p>[</span><span class=nx>type</span><span class=p>]</span> <span class=o>||</span> <span class=p>[];</span>
</span></span><span class=line><span class=cl>    <span class=nx>subscribers</span><span class=p>.</span><span class=nx>forEach</span><span class=p>((</span><span class=nx>cb</span><span class=p>)</span> <span class=p>=&gt;</span> <span class=nx>cb</span><span class=p>(</span><span class=nx>messages</span><span class=p>));</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><h5 id=发布者>发布者<a hidden class=anchor aria-hidden=true href=#发布者>#</a></h5><div class=highlight><pre tabindex=0 class=chroma><code class=language-js data-lang=js><span class=line><span class=cl><span class=kr>class</span> <span class=nx>Publisher</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nx>constructor</span><span class=p>(</span><span class=nx>name</span><span class=p>,</span> <span class=nx>context</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>this</span><span class=p>.</span><span class=nx>name</span> <span class=o>=</span> <span class=nx>name</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=k>this</span><span class=p>.</span><span class=nx>context</span> <span class=o>=</span> <span class=nx>context</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=nx>publish</span><span class=p>(</span><span class=nx>type</span><span class=p>,</span> <span class=nx>content</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>this</span><span class=p>.</span><span class=nx>context</span><span class=p>.</span><span class=nx>publish</span><span class=p>(</span><span class=nx>type</span><span class=p>,</span> <span class=nx>content</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><h5 id=订阅者>订阅者<a hidden class=anchor aria-hidden=true href=#订阅者>#</a></h5><div class=highlight><pre tabindex=0 class=chroma><code class=language-js data-lang=js><span class=line><span class=cl><span class=kr>class</span> <span class=nx>Subscriber</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nx>constructor</span><span class=p>(</span><span class=nx>name</span><span class=p>,</span> <span class=nx>context</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>this</span><span class=p>.</span><span class=nx>name</span> <span class=o>=</span> <span class=nx>name</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=k>this</span><span class=p>.</span><span class=nx>context</span> <span class=o>=</span> <span class=nx>context</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=nx>subscribe</span><span class=p>(</span><span class=nx>type</span><span class=p>,</span> <span class=nx>cb</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>this</span><span class=p>.</span><span class=nx>context</span><span class=p>.</span><span class=nx>subscribe</span><span class=p>(</span><span class=nx>type</span><span class=p>,</span> <span class=nx>cb</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><h4 id=5使用>5）使用<a hidden class=anchor aria-hidden=true href=#5使用>#</a></h4><div class=highlight><pre tabindex=0 class=chroma><code class=language-js data-lang=js><span class=line><span class=cl><span class=kr>const</span> <span class=nx>TYPE_A</span> <span class=o>=</span> <span class=s1>&#39;music&#39;</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=kr>const</span> <span class=nx>TYPE_B</span> <span class=o>=</span> <span class=s1>&#39;movie&#39;</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=kr>const</span> <span class=nx>TYPE_C</span> <span class=o>=</span> <span class=s1>&#39;novel&#39;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kr>const</span> <span class=nx>pubsub</span> <span class=o>=</span> <span class=k>new</span> <span class=nx>PubSub</span><span class=p>();</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kr>const</span> <span class=nx>publisherA</span> <span class=o>=</span> <span class=k>new</span> <span class=nx>Publisher</span><span class=p>(</span><span class=s1>&#39;publisherA&#39;</span><span class=p>,</span> <span class=nx>pubsub</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=nx>publisherA</span><span class=p>.</span><span class=nx>publish</span><span class=p>(</span><span class=nx>TYPE_A</span><span class=p>,</span> <span class=s1>&#39;we are young&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=nx>publisherA</span><span class=p>.</span><span class=nx>publish</span><span class=p>(</span><span class=nx>TYPE_B</span><span class=p>,</span> <span class=s1>&#39;the silicon valley&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=kr>const</span> <span class=nx>publisherB</span> <span class=o>=</span> <span class=k>new</span> <span class=nx>Publisher</span><span class=p>(</span><span class=s1>&#39;publisherB&#39;</span><span class=p>,</span> <span class=nx>pubsub</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=nx>publisherB</span><span class=p>.</span><span class=nx>publish</span><span class=p>(</span><span class=nx>TYPE_A</span><span class=p>,</span> <span class=s1>&#39;stronger&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=kr>const</span> <span class=nx>publisherC</span> <span class=o>=</span> <span class=k>new</span> <span class=nx>Publisher</span><span class=p>(</span><span class=s1>&#39;publisherC&#39;</span><span class=p>,</span> <span class=nx>pubsub</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=nx>publisherC</span><span class=p>.</span><span class=nx>publish</span><span class=p>(</span><span class=nx>TYPE_B</span><span class=p>,</span> <span class=s1>&#39;imitation game&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kr>const</span> <span class=nx>subscriberA</span> <span class=o>=</span> <span class=k>new</span> <span class=nx>Subscriber</span><span class=p>(</span><span class=s1>&#39;subscriberA&#39;</span><span class=p>,</span> <span class=nx>pubsub</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=nx>subscriberA</span><span class=p>.</span><span class=nx>subscribe</span><span class=p>(</span><span class=nx>TYPE_A</span><span class=p>,</span> <span class=p>(</span><span class=nx>res</span><span class=p>)</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl><span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=s1>&#39;subscriberA received&#39;</span><span class=p>,</span> <span class=nx>res</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=p>});</span>
</span></span><span class=line><span class=cl><span class=kr>const</span> <span class=nx>subscriberB</span> <span class=o>=</span> <span class=k>new</span> <span class=nx>Subscriber</span><span class=p>(</span><span class=s1>&#39;subscriberB&#39;</span><span class=p>,</span> <span class=nx>pubsub</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=nx>subscriberB</span><span class=p>.</span><span class=nx>subscribe</span><span class=p>(</span><span class=nx>TYPE_C</span><span class=p>,</span> <span class=p>(</span><span class=nx>res</span><span class=p>)</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl><span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=s1>&#39;subscriberB received&#39;</span><span class=p>,</span> <span class=nx>res</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=p>});</span>
</span></span><span class=line><span class=cl><span class=kr>const</span> <span class=nx>subscriberC</span> <span class=o>=</span> <span class=k>new</span> <span class=nx>Subscriber</span><span class=p>(</span><span class=s1>&#39;subscriberC&#39;</span><span class=p>,</span> <span class=nx>pubsub</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=nx>subscriberC</span><span class=p>.</span><span class=nx>subscribe</span><span class=p>(</span><span class=nx>TYPE_B</span><span class=p>,</span> <span class=p>(</span><span class=nx>res</span><span class=p>)</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl><span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=s1>&#39;subscriberC received&#39;</span><span class=p>,</span> <span class=nx>res</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=p>});</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nx>pubsub</span><span class=p>.</span><span class=nx>notify</span><span class=p>(</span><span class=nx>TYPE_A</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=nx>pubsub</span><span class=p>.</span><span class=nx>notify</span><span class=p>(</span><span class=nx>TYPE_B</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=nx>pubsub</span><span class=p>.</span><span class=nx>notify</span><span class=p>(</span><span class=nx>TYPE_C</span><span class=p>);</span>
</span></span></code></pre></div><blockquote><p>完整代码见附录</p></blockquote><h4 id=6解析>6）解析<a hidden class=anchor aria-hidden=true href=#6解析>#</a></h4><p>以上<code>发布订阅中心</code>、<code>发布者</code>和<code>订阅者</code>三者有各自的实现，其中<code>发布者</code>和<code>订阅者</code>实现比较简单，只需完成各自<code>发布</code>、<code>订阅</code>的任务即可。其中<code>订阅者</code>可以在接收到消息后做后续处理。重点在于二者需要确保在与同一个<code>发布订阅中心</code>进行关联，否则两者之间的通信无从关联。</p><p>发布者的发布动作和订阅者的订阅动作相互独立，无需关注对方，消息派发由发布订阅中心负责。</p><h2 id=四实际应用>四、实际应用<a hidden class=anchor aria-hidden=true href=#四实际应用>#</a></h2><p>在实际应用中，对于以上二者的实现可能会更加的复杂，同时也会根据各自的场景进行变形，所以大可不必拘泥于二者的标准实现。因为不论是设计模式还是技术模型大多都只是前人根据经验总结而成的编程思想，知道它们可能会对某些复杂问题的解决有启发性的帮助，进而借助这类思想巧妙地解决特定场景的问题。</p><p>至于具体应用实例我能想到的有如下实践，欢迎补充。</p><ul><li>Node.js中自带的EventEmiter模块</li><li>Vue.js中数据响应式的实现</li></ul><p>其他比如你在代码中发现有<code>watch、watcher、observe、observer、listen、listener、dispatch、trigger、emit、on、event、eventbus、EventEmitter</code>这类单词出现的地方，很有可能是在使用<code>观察者模式</code>或<code>发布订阅</code>的思想。等下次你发现有这些词的时候，不妨点进它的源码实现看看其他coder在实现<code>观察者模式</code>或<code>发布订阅</code>时有哪些巧妙的细节。</p><h2 id=五声明>五、声明<a hidden class=anchor aria-hidden=true href=#五声明>#</a></h2><p>本文为个人学习观察者模式和发布订阅过程时的理解整理，如有错误请及时指出。同时本文内容为原创内容，如需转载请注明出处。</p><h2 id=六参考资料>六、参考资料<a hidden class=anchor aria-hidden=true href=#六参考资料>#</a></h2><ul><li><a href=https://zh.wikipedia.org/wiki/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F_(%E8%AE%A1%E7%AE%97%E6%9C%BA)>维基百科-设计模式</a></li><li><a href=https://zh.wikipedia.org/zh-hans/%E8%A7%82%E5%AF%9F%E8%80%85%E6%A8%A1%E5%BC%8F>维基百科-观察者模式</a></li><li><a href=https://zh.wikipedia.org/wiki/%E5%8F%91%E5%B8%83/%E8%AE%A2%E9%98%85>维基百科-发布订阅</a></li></ul><h2 id=附录>附录<a hidden class=anchor aria-hidden=true href=#附录>#</a></h2><p>observer-model.js</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-js data-lang=js><span class=line><span class=cl><span class=kr>class</span> <span class=nx>Subject</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=nx>constructor</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>this</span><span class=p>.</span><span class=nx>observerList</span> <span class=o>=</span> <span class=p>[];</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=nx>addObserver</span><span class=p>(</span><span class=nx>observer</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>this</span><span class=p>.</span><span class=nx>observerList</span><span class=p>.</span><span class=nx>push</span><span class=p>(</span><span class=nx>observer</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=nx>removeObserver</span><span class=p>(</span><span class=nx>observer</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=kr>const</span> <span class=nx>index</span> <span class=o>=</span> <span class=k>this</span><span class=p>.</span><span class=nx>observerList</span><span class=p>.</span><span class=nx>findIndex</span><span class=p>(</span><span class=nx>o</span> <span class=p>=&gt;</span> <span class=nx>o</span><span class=p>.</span><span class=nx>name</span> <span class=o>===</span> <span class=nx>observer</span><span class=p>.</span><span class=nx>name</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=k>this</span><span class=p>.</span><span class=nx>observerList</span><span class=p>.</span><span class=nx>splice</span><span class=p>(</span><span class=nx>index</span><span class=p>,</span> <span class=mi>1</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=nx>notifyObservers</span><span class=p>(</span><span class=nx>message</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=kr>const</span> <span class=nx>observers</span> <span class=o>=</span> <span class=k>this</span><span class=p>.</span><span class=nx>observerList</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=nx>observers</span><span class=p>.</span><span class=nx>forEach</span><span class=p>(</span><span class=nx>observer</span> <span class=p>=&gt;</span> <span class=nx>observer</span><span class=p>.</span><span class=nx>notified</span><span class=p>(</span><span class=nx>message</span><span class=p>));</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kr>class</span> <span class=nx>Observer</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=nx>constructor</span><span class=p>(</span><span class=nx>name</span><span class=p>,</span> <span class=nx>subject</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>this</span><span class=p>.</span><span class=nx>name</span> <span class=o>=</span> <span class=nx>name</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=p>(</span><span class=nx>subject</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=nx>subject</span><span class=p>.</span><span class=nx>addObserver</span><span class=p>(</span><span class=k>this</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=nx>notified</span><span class=p>(</span><span class=nx>message</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=k>this</span><span class=p>.</span><span class=nx>name</span><span class=p>,</span> <span class=s1>&#39;got message&#39;</span><span class=p>,</span> <span class=nx>message</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>function</span> <span class=nx>main</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=kr>const</span> <span class=nx>subject</span> <span class=o>=</span> <span class=k>new</span> <span class=nx>Subject</span><span class=p>();</span>
</span></span><span class=line><span class=cl>  <span class=kr>const</span> <span class=nx>observerA</span> <span class=o>=</span> <span class=k>new</span> <span class=nx>Observer</span><span class=p>(</span><span class=s1>&#39;observerA&#39;</span><span class=p>,</span> <span class=nx>subject</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=kr>const</span> <span class=nx>observerB</span> <span class=o>=</span> <span class=k>new</span> <span class=nx>Observer</span><span class=p>(</span><span class=s1>&#39;observerB&#39;</span><span class=p>,</span> <span class=nx>subject</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=nx>subject</span><span class=p>.</span><span class=nx>notifyObservers</span><span class=p>(</span><span class=sb>`Hello from subject at </span><span class=si>${</span><span class=k>new</span> <span class=nb>Date</span><span class=p>()</span><span class=si>}</span><span class=sb>`</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=s1>&#39;------------------------&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=nx>setTimeout</span><span class=p>(()</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=kr>const</span> <span class=nx>observerC</span> <span class=o>=</span> <span class=k>new</span> <span class=nx>Observer</span><span class=p>(</span><span class=s1>&#39;observerC&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=kr>const</span> <span class=nx>observerD</span> <span class=o>=</span> <span class=k>new</span> <span class=nx>Observer</span><span class=p>(</span><span class=s1>&#39;observerD&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=nx>subject</span><span class=p>.</span><span class=nx>addObserver</span><span class=p>(</span><span class=nx>observerC</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=nx>subject</span><span class=p>.</span><span class=nx>addObserver</span><span class=p>(</span><span class=nx>observerD</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=nx>subject</span><span class=p>.</span><span class=nx>notifyObservers</span><span class=p>(</span><span class=sb>`Hello from subject at </span><span class=si>${</span><span class=k>new</span> <span class=nb>Date</span><span class=p>()</span><span class=si>}</span><span class=sb>`</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=s1>&#39;------------------------&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>  <span class=p>},</span> <span class=mi>1000</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=nx>setTimeout</span><span class=p>(()</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>subject</span><span class=p>.</span><span class=nx>removeObserver</span><span class=p>(</span><span class=nx>observerA</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=nx>subject</span><span class=p>.</span><span class=nx>notifyObservers</span><span class=p>(</span><span class=sb>`Hello from subject at </span><span class=si>${</span><span class=k>new</span> <span class=nb>Date</span><span class=p>()</span><span class=si>}</span><span class=sb>`</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=s1>&#39;------------------------&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>  <span class=p>},</span> <span class=mi>2000</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nx>main</span><span class=p>();</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// observerA got message Hello from subject at Fri Jun 25 2021 16:25:09 GMT+0800 (GMT+08:00)
</span></span></span><span class=line><span class=cl><span class=c1>// observerB got message Hello from subject at Fri Jun 25 2021 16:25:09 GMT+0800 (GMT+08:00)
</span></span></span><span class=line><span class=cl><span class=c1>// ------------------------
</span></span></span><span class=line><span class=cl><span class=c1>// observerA got message Hello from subject at Fri Jun 25 2021 16:25:10 GMT+0800 (GMT+08:00)
</span></span></span><span class=line><span class=cl><span class=c1>// observerB got message Hello from subject at Fri Jun 25 2021 16:25:10 GMT+0800 (GMT+08:00)
</span></span></span><span class=line><span class=cl><span class=c1>// observerC got message Hello from subject at Fri Jun 25 2021 16:25:10 GMT+0800 (GMT+08:00)
</span></span></span><span class=line><span class=cl><span class=c1>// observerD got message Hello from subject at Fri Jun 25 2021 16:25:10 GMT+0800 (GMT+08:00)
</span></span></span><span class=line><span class=cl><span class=c1>// ------------------------
</span></span></span><span class=line><span class=cl><span class=c1>// observerB got message Hello from subject at Fri Jun 25 2021 16:25:11 GMT+0800 (GMT+08:00)
</span></span></span><span class=line><span class=cl><span class=c1>// observerC got message Hello from subject at Fri Jun 25 2021 16:25:11 GMT+0800 (GMT+08:00)
</span></span></span><span class=line><span class=cl><span class=c1>// observerD got message Hello from subject at Fri Jun 25 2021 16:25:11 GMT+0800 (GMT+08:00)
</span></span></span><span class=line><span class=cl><span class=c1>// ------------------------
</span></span></span></code></pre></div><p>pub-sub.js</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-js data-lang=js><span class=line><span class=cl><span class=kr>class</span> <span class=nx>PubSub</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nx>constructor</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>this</span><span class=p>.</span><span class=nx>messages</span> <span class=o>=</span> <span class=p>{};</span>
</span></span><span class=line><span class=cl>    <span class=k>this</span><span class=p>.</span><span class=nx>listeners</span> <span class=o>=</span> <span class=p>{};</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=nx>publish</span><span class=p>(</span><span class=nx>type</span><span class=p>,</span> <span class=nx>content</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=kr>const</span> <span class=nx>existContent</span> <span class=o>=</span> <span class=k>this</span><span class=p>.</span><span class=nx>messages</span><span class=p>[</span><span class=nx>type</span><span class=p>];</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=p>(</span><span class=o>!</span><span class=nx>existContent</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=k>this</span><span class=p>.</span><span class=nx>messages</span><span class=p>[</span><span class=nx>type</span><span class=p>]</span> <span class=o>=</span> <span class=p>[];</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=k>this</span><span class=p>.</span><span class=nx>messages</span><span class=p>[</span><span class=nx>type</span><span class=p>].</span><span class=nx>push</span><span class=p>(</span><span class=nx>content</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=nx>subscribe</span><span class=p>(</span><span class=nx>type</span><span class=p>,</span> <span class=nx>cb</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=kr>const</span> <span class=nx>existListener</span> <span class=o>=</span> <span class=k>this</span><span class=p>.</span><span class=nx>listeners</span><span class=p>[</span><span class=nx>type</span><span class=p>];</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=p>(</span><span class=o>!</span><span class=nx>existListener</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=k>this</span><span class=p>.</span><span class=nx>listeners</span><span class=p>[</span><span class=nx>type</span><span class=p>]</span> <span class=o>=</span> <span class=p>[];</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=k>this</span><span class=p>.</span><span class=nx>listeners</span><span class=p>[</span><span class=nx>type</span><span class=p>].</span><span class=nx>push</span><span class=p>(</span><span class=nx>cb</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=nx>notify</span><span class=p>(</span><span class=nx>type</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=kr>const</span> <span class=nx>messages</span> <span class=o>=</span> <span class=k>this</span><span class=p>.</span><span class=nx>messages</span><span class=p>[</span><span class=nx>type</span><span class=p>];</span>
</span></span><span class=line><span class=cl>    <span class=kr>const</span> <span class=nx>subscribers</span> <span class=o>=</span> <span class=k>this</span><span class=p>.</span><span class=nx>listeners</span><span class=p>[</span><span class=nx>type</span><span class=p>]</span> <span class=o>||</span> <span class=p>[];</span>
</span></span><span class=line><span class=cl>    <span class=nx>subscribers</span><span class=p>.</span><span class=nx>forEach</span><span class=p>((</span><span class=nx>cb</span><span class=p>)</span> <span class=p>=&gt;</span> <span class=nx>cb</span><span class=p>(</span><span class=nx>messages</span><span class=p>));</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kr>class</span> <span class=nx>Publisher</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nx>constructor</span><span class=p>(</span><span class=nx>name</span><span class=p>,</span> <span class=nx>context</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>this</span><span class=p>.</span><span class=nx>name</span> <span class=o>=</span> <span class=nx>name</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=k>this</span><span class=p>.</span><span class=nx>context</span> <span class=o>=</span> <span class=nx>context</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=nx>publish</span><span class=p>(</span><span class=nx>type</span><span class=p>,</span> <span class=nx>content</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>this</span><span class=p>.</span><span class=nx>context</span><span class=p>.</span><span class=nx>publish</span><span class=p>(</span><span class=nx>type</span><span class=p>,</span> <span class=nx>content</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kr>class</span> <span class=nx>Subscriber</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nx>constructor</span><span class=p>(</span><span class=nx>name</span><span class=p>,</span> <span class=nx>context</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>this</span><span class=p>.</span><span class=nx>name</span> <span class=o>=</span> <span class=nx>name</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=k>this</span><span class=p>.</span><span class=nx>context</span> <span class=o>=</span> <span class=nx>context</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=nx>subscribe</span><span class=p>(</span><span class=nx>type</span><span class=p>,</span> <span class=nx>cb</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>this</span><span class=p>.</span><span class=nx>context</span><span class=p>.</span><span class=nx>subscribe</span><span class=p>(</span><span class=nx>type</span><span class=p>,</span> <span class=nx>cb</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>function</span> <span class=nx>main</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=kr>const</span> <span class=nx>TYPE_A</span> <span class=o>=</span> <span class=s1>&#39;music&#39;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=kr>const</span> <span class=nx>TYPE_B</span> <span class=o>=</span> <span class=s1>&#39;movie&#39;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=kr>const</span> <span class=nx>TYPE_C</span> <span class=o>=</span> <span class=s1>&#39;novel&#39;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=kr>const</span> <span class=nx>pubsub</span> <span class=o>=</span> <span class=k>new</span> <span class=nx>PubSub</span><span class=p>();</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=kr>const</span> <span class=nx>publisherA</span> <span class=o>=</span> <span class=k>new</span> <span class=nx>Publisher</span><span class=p>(</span><span class=s1>&#39;publisherA&#39;</span><span class=p>,</span> <span class=nx>pubsub</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=nx>publisherA</span><span class=p>.</span><span class=nx>publish</span><span class=p>(</span><span class=nx>TYPE_A</span><span class=p>,</span> <span class=s1>&#39;we are young&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=nx>publisherA</span><span class=p>.</span><span class=nx>publish</span><span class=p>(</span><span class=nx>TYPE_B</span><span class=p>,</span> <span class=s1>&#39;the silicon valley&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=kr>const</span> <span class=nx>publisherB</span> <span class=o>=</span> <span class=k>new</span> <span class=nx>Publisher</span><span class=p>(</span><span class=s1>&#39;publisherB&#39;</span><span class=p>,</span> <span class=nx>pubsub</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=nx>publisherB</span><span class=p>.</span><span class=nx>publish</span><span class=p>(</span><span class=nx>TYPE_A</span><span class=p>,</span> <span class=s1>&#39;stronger&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=kr>const</span> <span class=nx>publisherC</span> <span class=o>=</span> <span class=k>new</span> <span class=nx>Publisher</span><span class=p>(</span><span class=s1>&#39;publisherC&#39;</span><span class=p>,</span> <span class=nx>pubsub</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=nx>publisherC</span><span class=p>.</span><span class=nx>publish</span><span class=p>(</span><span class=nx>TYPE_B</span><span class=p>,</span> <span class=s1>&#39;imitation game&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=kr>const</span> <span class=nx>subscriberA</span> <span class=o>=</span> <span class=k>new</span> <span class=nx>Subscriber</span><span class=p>(</span><span class=s1>&#39;subscriberA&#39;</span><span class=p>,</span> <span class=nx>pubsub</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=nx>subscriberA</span><span class=p>.</span><span class=nx>subscribe</span><span class=p>(</span><span class=nx>TYPE_A</span><span class=p>,</span> <span class=p>(</span><span class=nx>res</span><span class=p>)</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=s1>&#39;subscriberA received&#39;</span><span class=p>,</span> <span class=nx>res</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=p>});</span>
</span></span><span class=line><span class=cl>  <span class=kr>const</span> <span class=nx>subscriberB</span> <span class=o>=</span> <span class=k>new</span> <span class=nx>Subscriber</span><span class=p>(</span><span class=s1>&#39;subscriberB&#39;</span><span class=p>,</span> <span class=nx>pubsub</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=nx>subscriberB</span><span class=p>.</span><span class=nx>subscribe</span><span class=p>(</span><span class=nx>TYPE_C</span><span class=p>,</span> <span class=p>(</span><span class=nx>res</span><span class=p>)</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=s1>&#39;subscriberB received&#39;</span><span class=p>,</span> <span class=nx>res</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=p>});</span>
</span></span><span class=line><span class=cl>  <span class=kr>const</span> <span class=nx>subscriberC</span> <span class=o>=</span> <span class=k>new</span> <span class=nx>Subscriber</span><span class=p>(</span><span class=s1>&#39;subscriberC&#39;</span><span class=p>,</span> <span class=nx>pubsub</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=nx>subscriberC</span><span class=p>.</span><span class=nx>subscribe</span><span class=p>(</span><span class=nx>TYPE_B</span><span class=p>,</span> <span class=p>(</span><span class=nx>res</span><span class=p>)</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=s1>&#39;subscriberC received&#39;</span><span class=p>,</span> <span class=nx>res</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=p>});</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=nx>pubsub</span><span class=p>.</span><span class=nx>notify</span><span class=p>(</span><span class=nx>TYPE_A</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=nx>pubsub</span><span class=p>.</span><span class=nx>notify</span><span class=p>(</span><span class=nx>TYPE_B</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=nx>pubsub</span><span class=p>.</span><span class=nx>notify</span><span class=p>(</span><span class=nx>TYPE_C</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nx>main</span><span class=p>();</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// subscriberA received [ &#39;we are young&#39;, &#39;stronger&#39; ]
</span></span></span><span class=line><span class=cl><span class=c1>// subscriberC received [ &#39;the silicon valley&#39;, &#39;imitation game&#39; ]
</span></span></span><span class=line><span class=cl><span class=c1>// subscriberB received undefined
</span></span></span></code></pre></div><blockquote><p>本文原发布于 <a href=https://juejin.cn/post/6978728619782701087>掘金</a></p></blockquote></div><footer class=post-footer><ul class=post-tags><li><a href=https://barnett617.github.io/wilson-blog/tags/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/>设计模式</a></li></ul><nav class=paginav><a class=prev href=https://barnett617.github.io/wilson-blog/posts/2021-07-24-webapp-based-on-bs-arch/><span class=title>« 上一页</span><br><span>基于B/S架构的webapp开发</span>
</a><a class=next href=https://barnett617.github.io/wilson-blog/posts/2020-08-19-ci-with-github/><span class=title>下一页 »</span><br><span>如何使用github进行持续集成</span></a></nav><script defer crossorigin=anonymous src=/wilson-blog/assets/js/qrcode.a817fc490b9066afefa35cf981f6f003a76441b45cc519492334607a8cbcb264.js integrity="sha256-qBf8SQuQZq/vo1z5gfbwA6dkQbRcxRlJIzRgeoy8smQ=" onload='const wechatShareBtnFingerprint=document.getElementById("wechat-share-btn");if(wechatShareBtnFingerprint){wechatShareBtnFingerprint.style.position="relative";const e=document.createElement("div");e.id="qrcode",Object.assign(e.style,{position:"absolute",background:"#fff",padding:"8px",bottom:0,"box-sizing":"content-box","box-shadow":"rgba(0, 0, 0, 0.2) 0px 0px 10px 4px",width:"96px",height:"96px",left:"50%",transform:"translate(-50%, -43%)",visibility:"hidden"}),window.wechatShareQrCode=e,wechatShareBtnFingerprint.appendChild(e),new QRCode(document.getElementById("qrcode"),{text:window.location.href,width:128,height:128,colorDark:"#000",colorLight:"#fff",correctLevel:QRCode.CorrectLevel.H})}'></script><div class=share-buttons><a id=wechat-share-btn target=_blank rel="noopener noreferrer" aria-label="share 理解【观察者模式】和【发布订阅】的区别 on wechat" href=javascript:void(0) onclick=return!1 onfocus='const shareBtnsPointer=document.getElementsByClassName("share-buttons")[0];shareBtnsPointer&&(shareBtnsPointer.style.overflowX="initial"),wechatShareQrCode.style.visibility="visible"' onblur='wechatShareQrCode.style.visibility="hidden"'><svg role="img" viewBox="0 0 24 24" height="30" width="30" fill="currentcolor"><path d="M8.691 2.188C3.891 2.188.0 5.476.0 9.53c0 2.212 1.17 4.203 3.002 5.55a.59.59.0 01.213.665l-.39 1.48c-.019.07-.048.141-.048.213.0.163.13.295.29.295a.326.326.0 00.167-.054l1.903-1.114a.864.864.0 01.717-.098 10.16 10.16.0 002.837.403c.276.0.543-.027.811-.05-.857-2.578.157-4.972 1.932-6.446 1.703-1.415 3.882-1.98 5.853-1.838-.576-3.583-4.196-6.348-8.596-6.348zM5.785 5.991c.642.0 1.162.529 1.162 1.18A1.17 1.17.0 015.785 8.349 1.17 1.17.0 014.623 7.17c0-.651.52-1.18 1.162-1.18zm5.813.0c.642.0 1.162.529 1.162 1.18a1.17 1.17.0 01-1.162 1.178 1.17 1.17.0 01-1.162-1.178c0-.651.52-1.18 1.162-1.18zm5.34 2.867c-1.797-.052-3.746.512-5.28 1.786-1.72 1.428-2.687 3.72-1.78 6.22.942 2.453 3.666 4.229 6.884 4.229.826.0 1.622-.12 2.361-.336a.722.722.0 01.598.082l1.584.926a.272.272.0 00.14.047c.134.0.24-.111.24-.247.0-.06-.023-.12-.038-.177l-.327-1.233a.582.582.0 01-.023-.156.49.49.0 01.201-.398C23.024 18.48 24 16.82 24 14.98c0-3.21-2.931-5.837-6.656-6.088V8.89c-.135-.01-.27-.027-.407-.03zm-2.53 3.274c.535.0.969.44.969.982a.976.976.0 01-.969.983.976.976.0 01-.969-.983c0-.542.434-.982.97-.982zm4.844.0c.535.0.969.44.969.982a.976.976.0 01-.969.983.976.976.0 01-.969-.983c0-.542.434-.982.969-.982z"/></svg></a><a target=_blank rel="noopener noreferrer" aria-label="share 理解【观察者模式】和【发布订阅】的区别 on x" href="https://x.com/intent/tweet/?text=%e7%90%86%e8%a7%a3%e3%80%90%e8%a7%82%e5%af%9f%e8%80%85%e6%a8%a1%e5%bc%8f%e3%80%91%e5%92%8c%e3%80%90%e5%8f%91%e5%b8%83%e8%ae%a2%e9%98%85%e3%80%91%e7%9a%84%e5%8c%ba%e5%88%ab&amp;url=https%3a%2f%2fbarnett617.github.io%2fwilson-blog%2fposts%2f2021-06-28-observer-pattern%2f&amp;hashtags=%e8%ae%be%e8%ae%a1%e6%a8%a1%e5%bc%8f"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M512 62.554V449.446C512 483.97 483.97 512 449.446 512H62.554C28.03 512 0 483.97.0 449.446V62.554C0 28.03 28.029.0 62.554.0H449.446C483.971.0 512 28.03 512 62.554zM269.951 190.75 182.567 75.216H56L207.216 272.95 63.9 436.783h61.366L235.9 310.383l96.667 126.4H456L298.367 228.367l134-153.151H371.033zM127.633 110h36.468l219.38 290.065H349.5z"/></svg></a></div></footer></article></main><footer class=footer><span>&copy; 2023 <a href=https://barnett617.github.io/wilson-blog/>Wilson's Blog</a></span>
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
        <a href=https://github.com/adityatelange/hugo-PaperMod/ rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg></a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script><script>document.querySelectorAll("pre > code").forEach(e=>{const n=e.parentNode.parentNode,t=document.createElement("button");t.classList.add("copy-code"),t.innerHTML="复制";function s(){t.innerHTML="已复制！",setTimeout(()=>{t.innerHTML="复制"},2e3)}t.addEventListener("click",t=>{if("clipboard"in navigator){navigator.clipboard.writeText(e.textContent),s();return}const n=document.createRange();n.selectNodeContents(e);const o=window.getSelection();o.removeAllRanges(),o.addRange(n);try{document.execCommand("copy"),s()}catch{}o.removeRange(n)}),n.classList.contains("highlight")?n.appendChild(t):n.parentNode.firstChild==n||(e.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName=="TABLE"?e.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(t):e.parentNode.appendChild(t))})</script></body></html>