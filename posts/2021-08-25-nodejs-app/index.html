<!doctype html><html lang=zh dir=ltr><head><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>如何基于 Node.js 开发一个完整的项目 | Wilson's Blog</title>
<meta name=keywords content="Node.js"><meta name=description content="本文我们将围绕Node.js为核心，开发一个具有前端页面和后端存储，前后端通过API进行数据通信的完整项目。"><meta name=author content><link rel=canonical href=https://fexapp.org/posts/2021-08-25-nodejs-app/><meta name=google-site-verification content="XYZabc"><meta name=yandex-verification content="XYZabc"><meta name=msvalidate.01 content="XYZabc"><link crossorigin=anonymous href=/assets/css/stylesheet.7822ca91becd3fe515c67241030e80de043ab22dea5278258d676181168c3c52.css integrity="sha256-eCLKkb7NP+UVxnJBAw6A3gQ6si3qUngljWdhgRaMPFI=" rel="preload stylesheet" as=style><link rel=icon href=https://fexapp.org/favicon_io/favicon.ico><link rel=icon type=image/png sizes=16x16 href=https://fexapp.org/favicon_io/favicon16x16.png><link rel=icon type=image/png sizes=32x32 href=https://fexapp.org/favicon_io/favicon32x32.png><link rel=apple-touch-icon href=https://fexapp.org/favicon_io/apple-touch-icon.png><link rel=mask-icon href=https://fexapp.org/favicon_io/apple-touch-icon.png><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><link rel=alternate hreflang=zh href=https://fexapp.org/posts/2021-08-25-nodejs-app/><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--hljs-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><meta property="og:title" content="如何基于 Node.js 开发一个完整的项目"><meta property="og:description" content="本文我们将围绕Node.js为核心，开发一个具有前端页面和后端存储，前后端通过API进行数据通信的完整项目。"><meta property="og:type" content="article"><meta property="og:url" content="https://fexapp.org/posts/2021-08-25-nodejs-app/"><meta property="article:section" content="posts"><meta property="article:published_time" content="2021-08-25T15:31:00+00:00"><meta property="article:modified_time" content="2021-08-25T15:31:00+00:00"><meta property="og:site_name" content="Wilson's Blog"><meta name=twitter:card content="summary"><meta name=twitter:title content="如何基于 Node.js 开发一个完整的项目"><meta name=twitter:description content="本文我们将围绕Node.js为核心，开发一个具有前端页面和后端存储，前后端通过API进行数据通信的完整项目。"><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Posts","item":"https://fexapp.org/posts/"},{"@type":"ListItem","position":2,"name":"如何基于 Node.js 开发一个完整的项目","item":"https://fexapp.org/posts/2021-08-25-nodejs-app/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"如何基于 Node.js 开发一个完整的项目","name":"如何基于 Node.js 开发一个完整的项目","description":"本文我们将围绕Node.js为核心，开发一个具有前端页面和后端存储，前后端通过API进行数据通信的完整项目。","keywords":["Node.js"],"articleBody":"后端服务 首先，Node.js的http模块支持创建一个服务器，我们使用它来进行服务器的初始化如下\nconst http = require('http'); const host = '127.0.0.1'; const port = '8090'; http.createServer((req, res) =\u003e { console.log(req.url, 'requested at', new Date()); res.end('hello') }).listen(port, host, () =\u003e { console.log(`server running at http://${host}:${port}`); }) 随后，使用Node.js执行该文件，我们可以在控制看到listen方法中的回调函数的输出如下\nserver running at http://127.0.0.1:8090 点击该服务地址，或手动在浏览器内访问该服务地址，会得到我们刚刚创建的服务器返回的hello\n并且服务端接收到两个来自客户端（浏览器）的请求，分别为\"/“和”/favicon.icon\"，这是浏览器的默认行为，同时可以看到服务端在接收到以上两个请求后按照预期，输出了两条请求记录如下\n/ requested at 2021-08-25T01:16:33.143Z /favicon.ico requested at 2021-08-25T01:16:33.808Z 这就是我们后端服务的雏形，接着我们对其进行优化，做以下两件事情：\n对服务根路径’/‘请求返回网页index.html 将服务端接收到的请求记录在服务端的日志文件log.json内 如果想做以上两件事，最好的方式是使用Node.js框架进行开发，比如Express或koa，我们这里使用Express进行实现。\n安装Express 首先，我们通过以下命令在当前项目中增加npm配置，并安装express模块\nnpm init -y npm install express 重构服务 接着，我们将原有的Node.js服务改造为Express实现的方式\nconst express = require('express'); const app = express(); const host = '127.0.0.1'; const port = '8090'; app.get('/', (req, res) =\u003e { res.end('hello') }) app.listen(port, host, () =\u003e { console.log(`server running at http://${host}:${port}`); }) 我们引入的express模块，其本身也是一个函数，执行这个函数会返回一个服务器实例，这个实例你可以简单理解为是对Node.js中http模块的封装。\n可以看到它也有listen方法，并且同样可以传入服务监听的主机地址和端口，并且拥有同样的监听回调函数。并且该实例还具备get方法可以接收来自客户端的请求，并给出对应的反馈。\n返回网页 使用Express的优势在这里就可以体现出来，因为Node.js的http所创建的服务器只可以直接返回数据，而经过Express实现的服务器实例对象，可以直接返回文件。我们使用该能力来对根路径请求返回网页文件如下\napp.get('/', (req, res) =\u003e { res.sendFile('./index.html') }) 但这样控制台会报以下错误\nserver running at http://127.0.0.1:8090 TypeError: path must be absolute or specify root to res.sendFile 这就是告诉我们，使用sendFile方法，必须要使用绝对路径指定文件，或者声明sendFile方法返回文件的基准路径。因此我们可以任选其一方式进行文件返回，两种方式的使用如下\nconst path = require('path'); const htmlRoot = path.resolve(__dirname, 'index.html') res.sendFile(htmlRoot) res.sendFile('index.html', { root: '.' }) 前端网页我们使用CDN版的Vue.js进行页面的快速搭建，如下\n\u003c!DOCTYPE html\u003e \u003chtml lang=\"en\"\u003e \u003chead\u003e \u003cmeta charset=\"UTF-8\"\u003e \u003cmeta http-equiv=\"X-UA-Compatible\" content=\"IE=edge\"\u003e \u003cmeta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\"\u003e \u003ctitle\u003eDocument\u003c/title\u003e \u003cscript src=\"https://unpkg.com/vue\"\u003e\u003c/script\u003e \u003c/head\u003e \u003cbody\u003e \u003cdiv id=\"app\"\u003e {{message}} \u003c/div\u003e \u003cscript\u003e var app = new Vue({ el: '#app', data: { message: 'Hello Vue!' } }) \u003c/script\u003e \u003c/body\u003e \u003c/html\u003e 至此，我们便实现了后端服务返回前端页面的功能，效果如下\n记录日志 目前我们只是能够将每个请求输出在服务端控制台，但一旦我们的服务终止，或者控制台清空，历史的请求记录就访问不到了，因此我们可以利用Node.js的文件读写能力（详见Node.js 开发必备基础知识一文）来将每一条请求记录存储在服务端的文件内。\n核心实现逻辑如下\nfunction log(msg) { const logMsg = msg + '\\n'; const logPath = `./${logName}`; const existLog = fs.existsSync(logName); if (existLog) { fs.appendFileSync(logPath, logMsg); } else { fs.createWriteStream(logPath).write(logMsg); } } 我们这里会先判断服务器是否已经存在日志文件，如果存在，我们只需向日志文件追加记录即可，如果不存在，那么我们就创建一个写数据流，将记录写入日志文件。\n这个操作会创建一个日志文件，这样下次启动服务器时如果读取到已有的日志文件则会直接向该文件写入内容即可。\n对于“日志记录”函数的使用我们只需要在需要的地方调用即可\napp.get('/', (req, res) =\u003e { const logMsg = `${req.url} requested at, ${new Date()}` console.log(logMsg); log(logMsg); res.sendFile('index.html', { root: '.' }); }) 这样，我们就实现了记录日志的功能。\n前端页面 页面提交数据 接着，我们在前端页面实现一些基本的常用功能，比如新增备忘，核心逻辑如下\n\u003cdiv id=\"app\"\u003e \u003cdiv class=\"history\"\u003e \u003cdiv class=\"history-item\" v-for=\"(item, index) of history\" :key=\"index\"\u003e{{item}}\u003c/div\u003e \u003c/div\u003e \u003cdiv clas=\"item-add-wrap\"\u003e \u003cinput v-model=\"newItem\" type=\"text\"\u003e \u003cbutton @click=\"add\"\u003e添加\u003c/button\u003e \u003c/div\u003e \u003c/div\u003e \u003cscript\u003e var app = new Vue({ el: '#app', data: { history: [], newItem: '' }, methods: { add() { const api = 'http://127.0.0.1:8090/add'; const params = { content: this.newItem } const option = { method: 'POST', body: JSON.stringify(params), headers: new Headers({ 'Content-Type': 'application/json' }) } console.log('option', option) fetch(api, option).then(res =\u003e { if (res \u0026\u0026 res.status === 200) { console.log('res', res) } }) } } }) \u003c/script\u003e 我们这里使用浏览器自带的fetch方法进行网络数据请求，其中第一个参数为要请求的接口地址，第二个参数为网络请求的基础配置，比如这里我们声明了请求体格式为JSON，并且发送POST请求，参数为一个JSON字符串。页面显示如下\n后端接收数据 随后我们需要在后端服务增加对add方法的处理如下\napp.use(express.json()); function storeData(content, callback) { const data = content + '\\n'; const existed = fs.existsSync(dataName); const dataPath = `./${dataName}`; if (existed) { fs.appendFileSync(dataPath, data); } else { fs.createWriteStream(dataPath).write(data); } callback(); } app.post('/add', (req, res) =\u003e { const params = req.body; const logMsg = `POST ${req.url} | ${JSON.stringify(params)} | ${new Date()}` console.log(logMsg); log(logMsg); if (params) { const { content = '' } = params; if (content) { storeData(content, function() { res.json({ errno: 0, data: null }) }) } else { res.json({ errno: 400, errmsg: '内容为空' }) } } }) 其中第一行我们使用express内置的中间件函数对网络请求中的参数进行JSON化处理，这样方便我们在post方法的请求体中成功解析出页面传递来的JSON参数。\n另外，我们定义了storeData函数用于将页面提交的数据存储到服务端的文件内，这个过程是在对数据进行持久化存储。\n最后，我们使用服务器实例监听post方法，根据指定的API名称add，我们接收到来自页面的请求，并且可以对传递而来的数据做处理以及响应返回。\n页面查询数据 既然我们已经可以通过页面向服务端存储数据，那么接下来我们需要在页面内增加从服务端读取已有数据的能力，实现如下\nvar app = new Vue({ el: '#app', data: { history: [], newItem: '' }, created() { this.getData(); }, methods: { add() { const api = 'http://127.0.0.1:8090/add'; const params = { content: this.newItem } const option = { method: 'POST', body: JSON.stringify(params), headers: new Headers({ 'Content-Type': 'application/json' }) } fetch(api, option).then(res =\u003e { if (res \u0026\u0026 res.status === 200) { res.json().then(jsonRes =\u003e { if (jsonRes.errno === 0) { this.getData(); this.newItem = ''; } }) } }) }, getData() { fetch('http://127.0.0.1:8090/list').then(res =\u003e { if (res \u0026\u0026 res.status === 200) { res.json().then(jsonRes =\u003e { if (jsonRes.errno === 0 \u0026\u0026 jsonRes.data) { this.history = jsonRes.data; } }) } }) } } }) 服务端响应数据查询 function readData(callback) { const dataPath = `./${dataName}`; const existed = fs.existsSync(dataPath); let result; if (existed) { const content = fs.readFileSync(dataPath); result = content.toString(); } callback(result); } app.get('/list', (req, res) =\u003e { const logMsg = `GET ${req.url} | ${new Date()}` console.log(logMsg); log(logMsg); readData(data =\u003e { if (data) { const jsonData = data.split('\\n').filter(str =\u003e str.length); res.json({ errno: 0, data: jsonData }) } else { res.json({ errno: 400, errmsg: '没有内容' }) } }) }) 至此，我们完成了页面从服务端读取数据的能力，并且优化了新添加内容后的交互，即新读取最新内容和清空输入框。整体效果如下：\n客户端展示\n服务端展示\n总结 这样我们就基于Node.js为核心开发了一个可以查询服务器数据，并且能向服务器新增数据的完整应用，其中核心利用了Node.js的文件读写能力以及成熟的Node.js框架——Express。真正的Web应用或许还有以下工作需要完成：\n服务端增加路由中间件 服务端数据持久化方法封装 服务端日志中间件封装 前端网络请求方法封装 前端页面增加路由中间件 … 而这一切都基于我们本例中实现的基本雏形，所以如果你想开始使用Node.js进行项目开发，可以按照本示例进行逐步实现并继续完善。\n本文原发布于 掘金\n","wordCount":"618","inLanguage":"zh","datePublished":"2021-08-25T15:31:00Z","dateModified":"2021-08-25T15:31:00Z","mainEntityOfPage":{"@type":"WebPage","@id":"https://fexapp.org/posts/2021-08-25-nodejs-app/"},"publisher":{"@type":"Organization","name":"Wilson's Blog","logo":{"@type":"ImageObject","url":"https://fexapp.org/favicon_io/favicon.ico"}}}</script></head><body id=top><script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add("dark"):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove("dark"):window.matchMedia("(prefers-color-scheme: dark)").matches&&document.body.classList.add("dark")</script><header class=header><nav class=nav><div class=logo><a href=https://fexapp.org/ accesskey=h title="Wilson's Blog (Alt + H)"><img src=https://fexapp.org/favicon_io/apple-touch-icon.png alt aria-label=logo height=35>Wilson's Blog</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button><ul class=lang-switch><li>|</li><li><a href=https://fexapp.org/en/ title=English aria-label=English>En</a></li></ul></div></div><ul id=menu><li><a href=https://fexapp.org/archives title=时间线><span>时间线</span></a></li><li><a href=https://fexapp.org/search/ title=搜索><span>搜索</span></a></li><li><a href=https://fexapp.org/tags/ title=标签分类><span>标签分类</span></a></li><li><a href=https://fexapp.org/about/ title=关于我><span>关于我</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><h1 class="post-title entry-hint-parent">如何基于 Node.js 开发一个完整的项目</h1><div class=post-meta><span title='2021-08-25 15:31:00 +0000 UTC'>2021-08-25 15:31:00</span>&nbsp;·&nbsp;3 分钟&nbsp;·&nbsp;618 字&nbsp;|&nbsp;<a href=https://github.com/barnett617/wilson-blog/tree/main/content//posts/2021-08-25-nodejs-app/index.md rel="noopener noreferrer" target=_blank>修改建议</a></div></header><div class=toc><details><summary accesskey=c title="(Alt + C)"><span class=details>目录</span></summary><div class=inner><nav id=TableOfContents><ul><li><a href=#后端服务>后端服务</a><ul><li><a href=#安装express>安装Express</a></li><li><a href=#重构服务>重构服务</a></li><li><a href=#返回网页>返回网页</a></li><li><a href=#记录日志>记录日志</a></li></ul></li><li><a href=#前端页面>前端页面</a><ul><li><a href=#页面提交数据>页面提交数据</a></li><li><a href=#后端接收数据>后端接收数据</a></li><li><a href=#页面查询数据>页面查询数据</a></li><li><a href=#服务端响应数据查询>服务端响应数据查询</a></li></ul></li><li><a href=#总结>总结</a></li></ul></nav></div></details></div><div class=post-content><h2 id=后端服务>后端服务<a hidden class=anchor aria-hidden=true href=#后端服务>#</a></h2><p>首先，Node.js的http模块支持创建一个服务器，我们使用它来进行服务器的初始化如下</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-js data-lang=js><span class=line><span class=cl><span class=kr>const</span> <span class=nx>http</span> <span class=o>=</span> <span class=nx>require</span><span class=p>(</span><span class=s1>&#39;http&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kr>const</span> <span class=nx>host</span> <span class=o>=</span> <span class=s1>&#39;127.0.0.1&#39;</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=kr>const</span> <span class=nx>port</span> <span class=o>=</span> <span class=s1>&#39;8090&#39;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nx>http</span><span class=p>.</span><span class=nx>createServer</span><span class=p>((</span><span class=nx>req</span><span class=p>,</span> <span class=nx>res</span><span class=p>)</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=nx>req</span><span class=p>.</span><span class=nx>url</span><span class=p>,</span> <span class=s1>&#39;requested at&#39;</span><span class=p>,</span> <span class=k>new</span> <span class=nb>Date</span><span class=p>());</span>
</span></span><span class=line><span class=cl>  <span class=nx>res</span><span class=p>.</span><span class=nx>end</span><span class=p>(</span><span class=s1>&#39;hello&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>}).</span><span class=nx>listen</span><span class=p>(</span><span class=nx>port</span><span class=p>,</span> <span class=nx>host</span><span class=p>,</span> <span class=p>()</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=sb>`server running at http://</span><span class=si>${</span><span class=nx>host</span><span class=si>}</span><span class=sb>:</span><span class=si>${</span><span class=nx>port</span><span class=si>}</span><span class=sb>`</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=p>})</span>
</span></span></code></pre></div><p>随后，使用Node.js执行该文件，我们可以在控制看到<code>listen</code>方法中的回调函数的输出如下</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>server running at http://127.0.0.1:8090
</span></span></code></pre></div><p>点击该服务地址，或手动在浏览器内访问该服务地址，会得到我们刚刚创建的服务器返回的hello</p><p><img loading=lazy src=f75a8fd47f194453a5d1b60e6aa4853a~tplv-k3u1fbpfcp-watermark.png alt=image.png></p><p>并且服务端接收到两个来自客户端（浏览器）的请求，分别为"/&ldquo;和&rdquo;/favicon.icon"，这是浏览器的默认行为，同时可以看到服务端在接收到以上两个请求后按照预期，输出了两条请求记录如下</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>/ requested at 2021-08-25T01:16:33.143Z
</span></span><span class=line><span class=cl>/favicon.ico requested at 2021-08-25T01:16:33.808Z
</span></span></code></pre></div><p>这就是我们后端服务的雏形，接着我们对其进行优化，做以下两件事情：</p><ol><li>对服务根路径&rsquo;/&lsquo;请求返回网页index.html</li><li>将服务端接收到的请求记录在服务端的日志文件log.json内</li></ol><p>如果想做以上两件事，最好的方式是使用Node.js框架进行开发，比如<a href=https://expressjs.com/zh-cn/>Express</a>或<a href=https://koajs.com/#>koa</a>，我们这里使用Express进行实现。</p><h3 id=安装express>安装Express<a hidden class=anchor aria-hidden=true href=#安装express>#</a></h3><p>首先，我们通过以下命令在当前项目中增加npm配置，并安装express模块</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>npm init -y
</span></span><span class=line><span class=cl>npm install express
</span></span></code></pre></div><h3 id=重构服务>重构服务<a hidden class=anchor aria-hidden=true href=#重构服务>#</a></h3><p>接着，我们将原有的Node.js服务改造为Express实现的方式</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-js data-lang=js><span class=line><span class=cl><span class=kr>const</span> <span class=nx>express</span> <span class=o>=</span> <span class=nx>require</span><span class=p>(</span><span class=s1>&#39;express&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=kr>const</span> <span class=nx>app</span> <span class=o>=</span> <span class=nx>express</span><span class=p>();</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kr>const</span> <span class=nx>host</span> <span class=o>=</span> <span class=s1>&#39;127.0.0.1&#39;</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=kr>const</span> <span class=nx>port</span> <span class=o>=</span> <span class=s1>&#39;8090&#39;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nx>app</span><span class=p>.</span><span class=nx>get</span><span class=p>(</span><span class=s1>&#39;/&#39;</span><span class=p>,</span> <span class=p>(</span><span class=nx>req</span><span class=p>,</span> <span class=nx>res</span><span class=p>)</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nx>res</span><span class=p>.</span><span class=nx>end</span><span class=p>(</span><span class=s1>&#39;hello&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>})</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nx>app</span><span class=p>.</span><span class=nx>listen</span><span class=p>(</span><span class=nx>port</span><span class=p>,</span> <span class=nx>host</span><span class=p>,</span> <span class=p>()</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=sb>`server running at http://</span><span class=si>${</span><span class=nx>host</span><span class=si>}</span><span class=sb>:</span><span class=si>${</span><span class=nx>port</span><span class=si>}</span><span class=sb>`</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=p>})</span>
</span></span></code></pre></div><p>我们引入的express模块，其本身也是一个函数，执行这个函数会返回一个服务器实例，这个实例你可以简单理解为是对Node.js中http模块的封装。</p><p>可以看到它也有listen方法，并且同样可以传入服务监听的主机地址和端口，并且拥有同样的监听回调函数。并且该实例还具备get方法可以接收来自客户端的请求，并给出对应的反馈。</p><h3 id=返回网页>返回网页<a hidden class=anchor aria-hidden=true href=#返回网页>#</a></h3><p>使用Express的优势在这里就可以体现出来，因为Node.js的http所创建的服务器只可以直接返回数据，而经过Express实现的服务器实例对象，可以直接返回文件。我们使用该能力来对根路径请求返回网页文件如下</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-js data-lang=js><span class=line><span class=cl><span class=nx>app</span><span class=p>.</span><span class=nx>get</span><span class=p>(</span><span class=s1>&#39;/&#39;</span><span class=p>,</span> <span class=p>(</span><span class=nx>req</span><span class=p>,</span> <span class=nx>res</span><span class=p>)</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nx>res</span><span class=p>.</span><span class=nx>sendFile</span><span class=p>(</span><span class=s1>&#39;./index.html&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>})</span>
</span></span></code></pre></div><p>但这样控制台会报以下错误</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>server running at http://127.0.0.1:8090
</span></span><span class=line><span class=cl>TypeError: path must be absolute or specify root to res.sendFile
</span></span></code></pre></div><p>这就是告诉我们，使用sendFile方法，必须要使用绝对路径指定文件，或者声明sendFile方法返回文件的基准路径。因此我们可以任选其一方式进行文件返回，两种方式的使用如下</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-js data-lang=js><span class=line><span class=cl><span class=kr>const</span> <span class=nx>path</span> <span class=o>=</span> <span class=nx>require</span><span class=p>(</span><span class=s1>&#39;path&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=kr>const</span> <span class=nx>htmlRoot</span> <span class=o>=</span> <span class=nx>path</span><span class=p>.</span><span class=nx>resolve</span><span class=p>(</span><span class=nx>__dirname</span><span class=p>,</span> <span class=s1>&#39;index.html&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=nx>res</span><span class=p>.</span><span class=nx>sendFile</span><span class=p>(</span><span class=nx>htmlRoot</span><span class=p>)</span>
</span></span></code></pre></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-js data-lang=js><span class=line><span class=cl><span class=nx>res</span><span class=p>.</span><span class=nx>sendFile</span><span class=p>(</span><span class=s1>&#39;index.html&#39;</span><span class=p>,</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>root</span><span class=o>:</span> <span class=s1>&#39;.&#39;</span>
</span></span><span class=line><span class=cl><span class=p>})</span>
</span></span></code></pre></div><p>前端网页我们使用CDN版的Vue.js进行页面的快速搭建，如下</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-html data-lang=html><span class=line><span class=cl><span class=cp>&lt;!DOCTYPE html&gt;</span>
</span></span><span class=line><span class=cl><span class=p>&lt;</span><span class=nt>html</span> <span class=na>lang</span><span class=o>=</span><span class=s>&#34;en&#34;</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl><span class=p>&lt;</span><span class=nt>head</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>  <span class=p>&lt;</span><span class=nt>meta</span> <span class=na>charset</span><span class=o>=</span><span class=s>&#34;UTF-8&#34;</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>  <span class=p>&lt;</span><span class=nt>meta</span> <span class=na>http-equiv</span><span class=o>=</span><span class=s>&#34;X-UA-Compatible&#34;</span> <span class=na>content</span><span class=o>=</span><span class=s>&#34;IE=edge&#34;</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>  <span class=p>&lt;</span><span class=nt>meta</span> <span class=na>name</span><span class=o>=</span><span class=s>&#34;viewport&#34;</span> <span class=na>content</span><span class=o>=</span><span class=s>&#34;width=device-width, initial-scale=1.0&#34;</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>  <span class=p>&lt;</span><span class=nt>title</span><span class=p>&gt;</span>Document<span class=p>&lt;/</span><span class=nt>title</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>  <span class=p>&lt;</span><span class=nt>script</span> <span class=na>src</span><span class=o>=</span><span class=s>&#34;https://unpkg.com/vue&#34;</span><span class=p>&gt;&lt;/</span><span class=nt>script</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl><span class=p>&lt;/</span><span class=nt>head</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl><span class=p>&lt;</span><span class=nt>body</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>  <span class=p>&lt;</span><span class=nt>div</span> <span class=na>id</span><span class=o>=</span><span class=s>&#34;app&#34;</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>    {{message}}
</span></span><span class=line><span class=cl>  <span class=p>&lt;/</span><span class=nt>div</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>  <span class=p>&lt;</span><span class=nt>script</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>    <span class=kd>var</span> <span class=nx>app</span> <span class=o>=</span> <span class=k>new</span> <span class=nx>Vue</span><span class=p>({</span>
</span></span><span class=line><span class=cl>      <span class=nx>el</span><span class=o>:</span> <span class=s1>&#39;#app&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=nx>data</span><span class=o>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nx>message</span><span class=o>:</span> <span class=s1>&#39;Hello Vue!&#39;</span>
</span></span><span class=line><span class=cl>      <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=p>})</span>
</span></span><span class=line><span class=cl>  <span class=p>&lt;/</span><span class=nt>script</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl><span class=p>&lt;/</span><span class=nt>body</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl><span class=p>&lt;/</span><span class=nt>html</span><span class=p>&gt;</span>
</span></span></code></pre></div><p>至此，我们便实现了后端服务返回前端页面的功能，效果如下</p><p><img loading=lazy src=9d6c06951a24417e96979422b7087d86~tplv-k3u1fbpfcp-watermark.png alt=image.png></p><h3 id=记录日志>记录日志<a hidden class=anchor aria-hidden=true href=#记录日志>#</a></h3><p>目前我们只是能够将每个请求输出在服务端控制台，但一旦我们的服务终止，或者控制台清空，历史的请求记录就访问不到了，因此我们可以利用Node.js的文件读写能力（详见<a href=../2021-08-25-nodejs-basic/>Node.js 开发必备基础知识</a>一文）来将每一条请求记录存储在服务端的文件内。</p><p>核心实现逻辑如下</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-js data-lang=js><span class=line><span class=cl><span class=kd>function</span> <span class=nx>log</span><span class=p>(</span><span class=nx>msg</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=kr>const</span> <span class=nx>logMsg</span> <span class=o>=</span> <span class=nx>msg</span> <span class=o>+</span> <span class=s1>&#39;\n&#39;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=kr>const</span> <span class=nx>logPath</span> <span class=o>=</span> <span class=sb>`./</span><span class=si>${</span><span class=nx>logName</span><span class=si>}</span><span class=sb>`</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=kr>const</span> <span class=nx>existLog</span> <span class=o>=</span> <span class=nx>fs</span><span class=p>.</span><span class=nx>existsSync</span><span class=p>(</span><span class=nx>logName</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=k>if</span> <span class=p>(</span><span class=nx>existLog</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>fs</span><span class=p>.</span><span class=nx>appendFileSync</span><span class=p>(</span><span class=nx>logPath</span><span class=p>,</span> <span class=nx>logMsg</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span> <span class=k>else</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>fs</span><span class=p>.</span><span class=nx>createWriteStream</span><span class=p>(</span><span class=nx>logPath</span><span class=p>).</span><span class=nx>write</span><span class=p>(</span><span class=nx>logMsg</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><p>我们这里会先判断服务器是否已经存在日志文件，如果存在，我们只需向日志文件追加记录即可，如果不存在，那么我们就创建一个写数据流，将记录写入日志文件。</p><p>这个操作会创建一个日志文件，这样下次启动服务器时如果读取到已有的日志文件则会直接向该文件写入内容即可。</p><p>对于“日志记录”函数的使用我们只需要在需要的地方调用即可</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-js data-lang=js><span class=line><span class=cl><span class=nx>app</span><span class=p>.</span><span class=nx>get</span><span class=p>(</span><span class=s1>&#39;/&#39;</span><span class=p>,</span> <span class=p>(</span><span class=nx>req</span><span class=p>,</span> <span class=nx>res</span><span class=p>)</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=kr>const</span> <span class=nx>logMsg</span> <span class=o>=</span> <span class=sb>`</span><span class=si>${</span><span class=nx>req</span><span class=p>.</span><span class=nx>url</span><span class=si>}</span><span class=sb> requested at, </span><span class=si>${</span><span class=k>new</span> <span class=nb>Date</span><span class=p>()</span><span class=si>}</span><span class=sb>`</span>
</span></span><span class=line><span class=cl>  <span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=nx>logMsg</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  
</span></span><span class=line><span class=cl>  <span class=nx>log</span><span class=p>(</span><span class=nx>logMsg</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=nx>res</span><span class=p>.</span><span class=nx>sendFile</span><span class=p>(</span><span class=s1>&#39;index.html&#39;</span><span class=p>,</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>root</span><span class=o>:</span> <span class=s1>&#39;.&#39;</span>
</span></span><span class=line><span class=cl>  <span class=p>});</span>
</span></span><span class=line><span class=cl><span class=p>})</span>
</span></span></code></pre></div><p>这样，我们就实现了记录日志的功能。</p><h2 id=前端页面>前端页面<a hidden class=anchor aria-hidden=true href=#前端页面>#</a></h2><h3 id=页面提交数据>页面提交数据<a hidden class=anchor aria-hidden=true href=#页面提交数据>#</a></h3><p>接着，我们在前端页面实现一些基本的常用功能，比如新增备忘，核心逻辑如下</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-html data-lang=html><span class=line><span class=cl><span class=p>&lt;</span><span class=nt>div</span> <span class=na>id</span><span class=o>=</span><span class=s>&#34;app&#34;</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl><span class=p>&lt;</span><span class=nt>div</span> <span class=na>class</span><span class=o>=</span><span class=s>&#34;history&#34;</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>  <span class=p>&lt;</span><span class=nt>div</span> <span class=na>class</span><span class=o>=</span><span class=s>&#34;history-item&#34;</span> <span class=na>v-for</span><span class=o>=</span><span class=s>&#34;(item, index) of history&#34;</span> <span class=na>:key</span><span class=o>=</span><span class=s>&#34;index&#34;</span><span class=p>&gt;</span>{{item}}<span class=p>&lt;/</span><span class=nt>div</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl><span class=p>&lt;/</span><span class=nt>div</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl><span class=p>&lt;</span><span class=nt>div</span> <span class=na>clas</span><span class=o>=</span><span class=s>&#34;item-add-wrap&#34;</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>  <span class=p>&lt;</span><span class=nt>input</span> <span class=na>v-model</span><span class=o>=</span><span class=s>&#34;newItem&#34;</span> <span class=na>type</span><span class=o>=</span><span class=s>&#34;text&#34;</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>  <span class=p>&lt;</span><span class=nt>button</span> <span class=err>@</span><span class=na>click</span><span class=o>=</span><span class=s>&#34;add&#34;</span><span class=p>&gt;</span>添加<span class=p>&lt;/</span><span class=nt>button</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl><span class=p>&lt;/</span><span class=nt>div</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl><span class=p>&lt;/</span><span class=nt>div</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl><span class=p>&lt;</span><span class=nt>script</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl><span class=kd>var</span> <span class=nx>app</span> <span class=o>=</span> <span class=k>new</span> <span class=nx>Vue</span><span class=p>({</span>
</span></span><span class=line><span class=cl>  <span class=nx>el</span><span class=o>:</span> <span class=s1>&#39;#app&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nx>data</span><span class=o>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>history</span><span class=o>:</span> <span class=p>[],</span>
</span></span><span class=line><span class=cl>    <span class=nx>newItem</span><span class=o>:</span> <span class=s1>&#39;&#39;</span>
</span></span><span class=line><span class=cl>  <span class=p>},</span>
</span></span><span class=line><span class=cl>  <span class=nx>methods</span><span class=o>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>add</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=kr>const</span> <span class=nx>api</span> <span class=o>=</span> <span class=s1>&#39;http://127.0.0.1:8090/add&#39;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>      <span class=kr>const</span> <span class=nx>params</span> <span class=o>=</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nx>content</span><span class=o>:</span> <span class=k>this</span><span class=p>.</span><span class=nx>newItem</span>
</span></span><span class=line><span class=cl>      <span class=p>}</span>
</span></span><span class=line><span class=cl>      <span class=kr>const</span> <span class=nx>option</span> <span class=o>=</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nx>method</span><span class=o>:</span> <span class=s1>&#39;POST&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=nx>body</span><span class=o>:</span> <span class=nx>JSON</span><span class=p>.</span><span class=nx>stringify</span><span class=p>(</span><span class=nx>params</span><span class=p>),</span>
</span></span><span class=line><span class=cl>        <span class=nx>headers</span><span class=o>:</span> <span class=k>new</span> <span class=nx>Headers</span><span class=p>({</span>
</span></span><span class=line><span class=cl>          <span class=s1>&#39;Content-Type&#39;</span><span class=o>:</span> <span class=s1>&#39;application/json&#39;</span>
</span></span><span class=line><span class=cl>        <span class=p>})</span>
</span></span><span class=line><span class=cl>      <span class=p>}</span>
</span></span><span class=line><span class=cl>      <span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=s1>&#39;option&#39;</span><span class=p>,</span> <span class=nx>option</span><span class=p>)</span>
</span></span><span class=line><span class=cl>      <span class=nx>fetch</span><span class=p>(</span><span class=nx>api</span><span class=p>,</span> <span class=nx>option</span><span class=p>).</span><span class=nx>then</span><span class=p>(</span><span class=nx>res</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=p>(</span><span class=nx>res</span> <span class=o>&amp;&amp;</span> <span class=nx>res</span><span class=p>.</span><span class=nx>status</span> <span class=o>===</span> <span class=mi>200</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>          <span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=s1>&#39;res&#39;</span><span class=p>,</span> <span class=nx>res</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>      <span class=p>})</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>})</span>
</span></span><span class=line><span class=cl><span class=p>&lt;/</span><span class=nt>script</span><span class=p>&gt;</span>
</span></span></code></pre></div><p>我们这里使用浏览器自带的<code>fetch</code>方法进行网络数据请求，其中第一个参数为要请求的<code>接口地址</code>，第二个参数为网络请求的基础配置，比如这里我们声明了请求体格式为<code>JSON</code>，并且发送<code>POST</code>请求，参数为一个<code>JSON字符串</code>。页面显示如下</p><p><img loading=lazy src=7e2e8f7e13774c6b9fa37a6740b3a892~tplv-k3u1fbpfcp-watermark.png alt=image.png></p><h3 id=后端接收数据>后端接收数据<a hidden class=anchor aria-hidden=true href=#后端接收数据>#</a></h3><p>随后我们需要在后端服务增加对<code>add</code>方法的处理如下</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-js data-lang=js><span class=line><span class=cl><span class=nx>app</span><span class=p>.</span><span class=nx>use</span><span class=p>(</span><span class=nx>express</span><span class=p>.</span><span class=nx>json</span><span class=p>());</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>function</span> <span class=nx>storeData</span><span class=p>(</span><span class=nx>content</span><span class=p>,</span> <span class=nx>callback</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=kr>const</span> <span class=nx>data</span> <span class=o>=</span> <span class=nx>content</span> <span class=o>+</span> <span class=s1>&#39;\n&#39;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=kr>const</span> <span class=nx>existed</span> <span class=o>=</span> <span class=nx>fs</span><span class=p>.</span><span class=nx>existsSync</span><span class=p>(</span><span class=nx>dataName</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=kr>const</span> <span class=nx>dataPath</span> <span class=o>=</span> <span class=sb>`./</span><span class=si>${</span><span class=nx>dataName</span><span class=si>}</span><span class=sb>`</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=k>if</span> <span class=p>(</span><span class=nx>existed</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>fs</span><span class=p>.</span><span class=nx>appendFileSync</span><span class=p>(</span><span class=nx>dataPath</span><span class=p>,</span> <span class=nx>data</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span> <span class=k>else</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>fs</span><span class=p>.</span><span class=nx>createWriteStream</span><span class=p>(</span><span class=nx>dataPath</span><span class=p>).</span><span class=nx>write</span><span class=p>(</span><span class=nx>data</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=nx>callback</span><span class=p>();</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nx>app</span><span class=p>.</span><span class=nx>post</span><span class=p>(</span><span class=s1>&#39;/add&#39;</span><span class=p>,</span> <span class=p>(</span><span class=nx>req</span><span class=p>,</span> <span class=nx>res</span><span class=p>)</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=kr>const</span> <span class=nx>params</span> <span class=o>=</span> <span class=nx>req</span><span class=p>.</span><span class=nx>body</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=kr>const</span> <span class=nx>logMsg</span> <span class=o>=</span> <span class=sb>`POST </span><span class=si>${</span><span class=nx>req</span><span class=p>.</span><span class=nx>url</span><span class=si>}</span><span class=sb> | </span><span class=si>${</span><span class=nx>JSON</span><span class=p>.</span><span class=nx>stringify</span><span class=p>(</span><span class=nx>params</span><span class=p>)</span><span class=si>}</span><span class=sb> | </span><span class=si>${</span><span class=k>new</span> <span class=nb>Date</span><span class=p>()</span><span class=si>}</span><span class=sb>`</span>
</span></span><span class=line><span class=cl>  <span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=nx>logMsg</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=nx>log</span><span class=p>(</span><span class=nx>logMsg</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=k>if</span> <span class=p>(</span><span class=nx>params</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=kr>const</span> <span class=p>{</span> <span class=nx>content</span> <span class=o>=</span> <span class=s1>&#39;&#39;</span> <span class=p>}</span> <span class=o>=</span> <span class=nx>params</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=p>(</span><span class=nx>content</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=nx>storeData</span><span class=p>(</span><span class=nx>content</span><span class=p>,</span> <span class=kd>function</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nx>res</span><span class=p>.</span><span class=nx>json</span><span class=p>({</span>
</span></span><span class=line><span class=cl>          <span class=nx>errno</span><span class=o>:</span> <span class=mi>0</span><span class=p>,</span>
</span></span><span class=line><span class=cl>          <span class=nx>data</span><span class=o>:</span> <span class=kc>null</span>
</span></span><span class=line><span class=cl>        <span class=p>})</span>
</span></span><span class=line><span class=cl>      <span class=p>})</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span> <span class=k>else</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=nx>res</span><span class=p>.</span><span class=nx>json</span><span class=p>({</span>
</span></span><span class=line><span class=cl>        <span class=nx>errno</span><span class=o>:</span> <span class=mi>400</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=nx>errmsg</span><span class=o>:</span> <span class=s1>&#39;内容为空&#39;</span>
</span></span><span class=line><span class=cl>      <span class=p>})</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>})</span>
</span></span></code></pre></div><p>其中第一行我们使用express内置的中间件函数对网络请求中的参数进行<code>JSON化</code>处理，这样方便我们在<code>post</code>方法的请求体中成功解析出页面传递来的JSON参数。</p><p>另外，我们定义了storeData函数用于将页面提交的数据存储到服务端的文件内，这个过程是在对数据进行<code>持久化</code>存储。</p><p>最后，我们使用服务器实例监听post方法，根据指定的API名称<code>add</code>，我们接收到来自页面的请求，并且可以对传递而来的数据做处理以及响应返回。</p><h3 id=页面查询数据>页面查询数据<a hidden class=anchor aria-hidden=true href=#页面查询数据>#</a></h3><p>既然我们已经可以通过页面向服务端存储数据，那么接下来我们需要在页面内增加从服务端读取已有数据的能力，实现如下</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-js data-lang=js><span class=line><span class=cl><span class=kd>var</span> <span class=nx>app</span> <span class=o>=</span> <span class=k>new</span> <span class=nx>Vue</span><span class=p>({</span>
</span></span><span class=line><span class=cl>  <span class=nx>el</span><span class=o>:</span> <span class=s1>&#39;#app&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nx>data</span><span class=o>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>history</span><span class=o>:</span> <span class=p>[],</span>
</span></span><span class=line><span class=cl>    <span class=nx>newItem</span><span class=o>:</span> <span class=s1>&#39;&#39;</span>
</span></span><span class=line><span class=cl>  <span class=p>},</span>
</span></span><span class=line><span class=cl>  <span class=nx>created</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>this</span><span class=p>.</span><span class=nx>getData</span><span class=p>();</span>
</span></span><span class=line><span class=cl>  <span class=p>},</span>
</span></span><span class=line><span class=cl>  <span class=nx>methods</span><span class=o>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>add</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=kr>const</span> <span class=nx>api</span> <span class=o>=</span> <span class=s1>&#39;http://127.0.0.1:8090/add&#39;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>      <span class=kr>const</span> <span class=nx>params</span> <span class=o>=</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nx>content</span><span class=o>:</span> <span class=k>this</span><span class=p>.</span><span class=nx>newItem</span>
</span></span><span class=line><span class=cl>      <span class=p>}</span>
</span></span><span class=line><span class=cl>      <span class=kr>const</span> <span class=nx>option</span> <span class=o>=</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nx>method</span><span class=o>:</span> <span class=s1>&#39;POST&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=nx>body</span><span class=o>:</span> <span class=nx>JSON</span><span class=p>.</span><span class=nx>stringify</span><span class=p>(</span><span class=nx>params</span><span class=p>),</span>
</span></span><span class=line><span class=cl>        <span class=nx>headers</span><span class=o>:</span> <span class=k>new</span> <span class=nx>Headers</span><span class=p>({</span>
</span></span><span class=line><span class=cl>          <span class=s1>&#39;Content-Type&#39;</span><span class=o>:</span> <span class=s1>&#39;application/json&#39;</span>
</span></span><span class=line><span class=cl>        <span class=p>})</span>
</span></span><span class=line><span class=cl>      <span class=p>}</span>
</span></span><span class=line><span class=cl>      <span class=nx>fetch</span><span class=p>(</span><span class=nx>api</span><span class=p>,</span> <span class=nx>option</span><span class=p>).</span><span class=nx>then</span><span class=p>(</span><span class=nx>res</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=p>(</span><span class=nx>res</span> <span class=o>&amp;&amp;</span> <span class=nx>res</span><span class=p>.</span><span class=nx>status</span> <span class=o>===</span> <span class=mi>200</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>          <span class=nx>res</span><span class=p>.</span><span class=nx>json</span><span class=p>().</span><span class=nx>then</span><span class=p>(</span><span class=nx>jsonRes</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=k>if</span> <span class=p>(</span><span class=nx>jsonRes</span><span class=p>.</span><span class=nx>errno</span> <span class=o>===</span> <span class=mi>0</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>              <span class=k>this</span><span class=p>.</span><span class=nx>getData</span><span class=p>();</span>
</span></span><span class=line><span class=cl>              <span class=k>this</span><span class=p>.</span><span class=nx>newItem</span> <span class=o>=</span> <span class=s1>&#39;&#39;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>            <span class=p>}</span>
</span></span><span class=line><span class=cl>          <span class=p>})</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>      <span class=p>})</span>
</span></span><span class=line><span class=cl>    <span class=p>},</span>
</span></span><span class=line><span class=cl>    <span class=nx>getData</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=nx>fetch</span><span class=p>(</span><span class=s1>&#39;http://127.0.0.1:8090/list&#39;</span><span class=p>).</span><span class=nx>then</span><span class=p>(</span><span class=nx>res</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=p>(</span><span class=nx>res</span> <span class=o>&amp;&amp;</span> <span class=nx>res</span><span class=p>.</span><span class=nx>status</span> <span class=o>===</span> <span class=mi>200</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>          <span class=nx>res</span><span class=p>.</span><span class=nx>json</span><span class=p>().</span><span class=nx>then</span><span class=p>(</span><span class=nx>jsonRes</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=k>if</span> <span class=p>(</span><span class=nx>jsonRes</span><span class=p>.</span><span class=nx>errno</span> <span class=o>===</span> <span class=mi>0</span> <span class=o>&amp;&amp;</span> <span class=nx>jsonRes</span><span class=p>.</span><span class=nx>data</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>              <span class=k>this</span><span class=p>.</span><span class=nx>history</span> <span class=o>=</span> <span class=nx>jsonRes</span><span class=p>.</span><span class=nx>data</span><span class=p>;</span>
</span></span><span class=line><span class=cl>            <span class=p>}</span>
</span></span><span class=line><span class=cl>          <span class=p>})</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>      <span class=p>})</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>})</span>
</span></span></code></pre></div><h3 id=服务端响应数据查询>服务端响应数据查询<a hidden class=anchor aria-hidden=true href=#服务端响应数据查询>#</a></h3><div class=highlight><pre tabindex=0 class=chroma><code class=language-js data-lang=js><span class=line><span class=cl><span class=kd>function</span> <span class=nx>readData</span><span class=p>(</span><span class=nx>callback</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=kr>const</span> <span class=nx>dataPath</span> <span class=o>=</span> <span class=sb>`./</span><span class=si>${</span><span class=nx>dataName</span><span class=si>}</span><span class=sb>`</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=kr>const</span> <span class=nx>existed</span> <span class=o>=</span> <span class=nx>fs</span><span class=p>.</span><span class=nx>existsSync</span><span class=p>(</span><span class=nx>dataPath</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=kd>let</span> <span class=nx>result</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=k>if</span> <span class=p>(</span><span class=nx>existed</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=kr>const</span> <span class=nx>content</span> <span class=o>=</span> <span class=nx>fs</span><span class=p>.</span><span class=nx>readFileSync</span><span class=p>(</span><span class=nx>dataPath</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=nx>result</span> <span class=o>=</span> <span class=nx>content</span><span class=p>.</span><span class=nx>toString</span><span class=p>();</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=nx>callback</span><span class=p>(</span><span class=nx>result</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nx>app</span><span class=p>.</span><span class=nx>get</span><span class=p>(</span><span class=s1>&#39;/list&#39;</span><span class=p>,</span> <span class=p>(</span><span class=nx>req</span><span class=p>,</span> <span class=nx>res</span><span class=p>)</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=kr>const</span> <span class=nx>logMsg</span> <span class=o>=</span> <span class=sb>`GET </span><span class=si>${</span><span class=nx>req</span><span class=p>.</span><span class=nx>url</span><span class=si>}</span><span class=sb> | </span><span class=si>${</span><span class=k>new</span> <span class=nb>Date</span><span class=p>()</span><span class=si>}</span><span class=sb>`</span>
</span></span><span class=line><span class=cl>  <span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=nx>logMsg</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  
</span></span><span class=line><span class=cl>  <span class=nx>log</span><span class=p>(</span><span class=nx>logMsg</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=nx>readData</span><span class=p>(</span><span class=nx>data</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=p>(</span><span class=nx>data</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=kr>const</span> <span class=nx>jsonData</span> <span class=o>=</span> <span class=nx>data</span><span class=p>.</span><span class=nx>split</span><span class=p>(</span><span class=s1>&#39;\n&#39;</span><span class=p>).</span><span class=nx>filter</span><span class=p>(</span><span class=nx>str</span> <span class=p>=&gt;</span> <span class=nx>str</span><span class=p>.</span><span class=nx>length</span><span class=p>);</span>
</span></span><span class=line><span class=cl>      <span class=nx>res</span><span class=p>.</span><span class=nx>json</span><span class=p>({</span>
</span></span><span class=line><span class=cl>        <span class=nx>errno</span><span class=o>:</span> <span class=mi>0</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=nx>data</span><span class=o>:</span> <span class=nx>jsonData</span>
</span></span><span class=line><span class=cl>      <span class=p>})</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span> <span class=k>else</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=nx>res</span><span class=p>.</span><span class=nx>json</span><span class=p>({</span>
</span></span><span class=line><span class=cl>        <span class=nx>errno</span><span class=o>:</span> <span class=mi>400</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=nx>errmsg</span><span class=o>:</span> <span class=s1>&#39;没有内容&#39;</span>
</span></span><span class=line><span class=cl>      <span class=p>})</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=p>})</span>
</span></span><span class=line><span class=cl><span class=p>})</span>
</span></span></code></pre></div><p>至此，我们完成了页面从服务端读取数据的能力，并且优化了新添加内容后的交互，即新读取最新内容和清空输入框。整体效果如下：</p><p>客户端展示</p><p><img loading=lazy src=43fbc31c50b14401846a1d6d28b3036f~tplv-k3u1fbpfcp-watermark.png alt=image.png></p><p>服务端展示</p><p><img loading=lazy src=2638938f514441dc8a2551dac2b224bd~tplv-k3u1fbpfcp-watermark.png alt=image.png></p><h2 id=总结>总结<a hidden class=anchor aria-hidden=true href=#总结>#</a></h2><p>这样我们就基于Node.js为核心开发了一个可以查询服务器数据，并且能向服务器新增数据的完整应用，其中核心利用了Node.js的文件读写能力以及成熟的Node.js框架——Express。真正的Web应用或许还有以下工作需要完成：</p><ul><li>服务端增加路由中间件</li><li>服务端数据持久化方法封装</li><li>服务端日志中间件封装</li><li>前端网络请求方法封装</li><li>前端页面增加路由中间件</li><li>&mldr;</li></ul><p>而这一切都基于我们本例中实现的基本雏形，所以如果你想开始使用Node.js进行项目开发，可以按照本示例进行逐步实现并继续完善。</p><blockquote><p>本文原发布于 <a href=https://juejin.cn/post/7000303653940641828>掘金</a></p></blockquote></div><footer class=post-footer><ul class=post-tags><li><a href=https://fexapp.org/tags/node.js/>Node.js</a></li></ul><nav class=paginav><a class=prev href=https://fexapp.org/notes/2022-09-21-2022-projects/><span class=title>« 上一页</span><br><span>2022年项目总结</span>
</a><a class=next href=https://fexapp.org/posts/2021-08-25-nodejs-basic/><span class=title>下一页 »</span><br><span>Node.js 开发必备基础知识</span></a></nav><script async crossorigin=anonymous src=/assets/js/qrcode.a817fc490b9066afefa35cf981f6f003a76441b45cc519492334607a8cbcb264.js integrity="sha256-qBf8SQuQZq/vo1z5gfbwA6dkQbRcxRlJIzRgeoy8smQ=" onload='const wechatShareBtnFingerprint=document.getElementById("wechat-share-btn");if(wechatShareBtnFingerprint){wechatShareBtnFingerprint.style.position="relative";const e=document.createElement("div");e.id="qrcode",Object.assign(e.style,{position:"absolute",background:"#fff",padding:"8px",bottom:0,"box-sizing":"content-box","box-shadow":"rgba(0, 0, 0, 0.2) 0px 0px 10px 4px",width:"96px",height:"96px",left:"50%",transform:"translate(-50%, -43%)",visibility:"hidden"}),window.wechatShareQrCode=e,wechatShareBtnFingerprint.appendChild(e),new QRCode(document.getElementById("qrcode"),{text:window.location.href,width:128,height:128,colorDark:"#000",colorLight:"#fff",correctLevel:QRCode.CorrectLevel.H})}'></script><div class=share-buttons><a id=wechat-share-btn target=_blank rel="noopener noreferrer" aria-label="share 如何基于 Node.js 开发一个完整的项目 on wechat" href=javascript:void(0) onclick=return!1 onfocus='const shareBtnsPointer=document.getElementsByClassName("share-buttons")[0];shareBtnsPointer&&(shareBtnsPointer.style.overflowX="initial"),wechatShareQrCode.style.visibility="visible"' onblur='wechatShareQrCode.style.visibility="hidden"'><svg role="img" viewBox="0 0 24 24" height="30" width="30" fill="currentcolor"><path d="M8.691 2.188C3.891 2.188.0 5.476.0 9.53c0 2.212 1.17 4.203 3.002 5.55a.59.59.0 01.213.665l-.39 1.48c-.019.07-.048.141-.048.213.0.163.13.295.29.295a.326.326.0 00.167-.054l1.903-1.114a.864.864.0 01.717-.098 10.16 10.16.0 002.837.403c.276.0.543-.027.811-.05-.857-2.578.157-4.972 1.932-6.446 1.703-1.415 3.882-1.98 5.853-1.838-.576-3.583-4.196-6.348-8.596-6.348zM5.785 5.991c.642.0 1.162.529 1.162 1.18A1.17 1.17.0 015.785 8.349 1.17 1.17.0 014.623 7.17c0-.651.52-1.18 1.162-1.18zm5.813.0c.642.0 1.162.529 1.162 1.18a1.17 1.17.0 01-1.162 1.178 1.17 1.17.0 01-1.162-1.178c0-.651.52-1.18 1.162-1.18zm5.34 2.867c-1.797-.052-3.746.512-5.28 1.786-1.72 1.428-2.687 3.72-1.78 6.22.942 2.453 3.666 4.229 6.884 4.229.826.0 1.622-.12 2.361-.336a.722.722.0 01.598.082l1.584.926a.272.272.0 00.14.047c.134.0.24-.111.24-.247.0-.06-.023-.12-.038-.177l-.327-1.233a.582.582.0 01-.023-.156.49.49.0 01.201-.398C23.024 18.48 24 16.82 24 14.98c0-3.21-2.931-5.837-6.656-6.088V8.89c-.135-.01-.27-.027-.407-.03zm-2.53 3.274c.535.0.969.44.969.982a.976.976.0 01-.969.983.976.976.0 01-.969-.983c0-.542.434-.982.97-.982zm4.844.0c.535.0.969.44.969.982a.976.976.0 01-.969.983.976.976.0 01-.969-.983c0-.542.434-.982.969-.982z"/></svg></a><a target=_blank rel="noopener noreferrer" aria-label="share 如何基于 Node.js 开发一个完整的项目 on x" href="https://x.com/intent/tweet/?text=%e5%a6%82%e4%bd%95%e5%9f%ba%e4%ba%8e%20Node.js%20%e5%bc%80%e5%8f%91%e4%b8%80%e4%b8%aa%e5%ae%8c%e6%95%b4%e7%9a%84%e9%a1%b9%e7%9b%ae&amp;url=https%3a%2f%2ffexapp.org%2fposts%2f2021-08-25-nodejs-app%2f&amp;hashtags=Node.js"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M512 62.554V449.446C512 483.97 483.97 512 449.446 512H62.554C28.03 512 0 483.97.0 449.446V62.554C0 28.03 28.029.0 62.554.0H449.446C483.971.0 512 28.03 512 62.554zM269.951 190.75 182.567 75.216H56L207.216 272.95 63.9 436.783h61.366L235.9 310.383l96.667 126.4H456L298.367 228.367l134-153.151H371.033zM127.633 110h36.468l219.38 290.065H349.5z"/></svg></a></div></footer></article></main><footer class=footer><span>&copy; 2024 <a href=https://fexapp.org/>Wilson's Blog</a></span>
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
        <a href=https://github.com/adityatelange/hugo-PaperMod/ rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg></a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script><script>document.querySelectorAll("pre > code").forEach(e=>{const n=e.parentNode.parentNode,t=document.createElement("button");t.classList.add("copy-code"),t.innerHTML="复制";function s(){t.innerHTML="已复制！",setTimeout(()=>{t.innerHTML="复制"},2e3)}t.addEventListener("click",t=>{if("clipboard"in navigator){navigator.clipboard.writeText(e.textContent),s();return}const n=document.createRange();n.selectNodeContents(e);const o=window.getSelection();o.removeAllRanges(),o.addRange(n);try{document.execCommand("copy"),s()}catch{}o.removeRange(n)}),n.classList.contains("highlight")?n.appendChild(t):n.parentNode.firstChild==n||(e.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName=="TABLE"?e.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(t):e.parentNode.appendChild(t))})</script></body></html>